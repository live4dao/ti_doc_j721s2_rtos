

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>8.1. Run a Application from DDR on R5 Cores &mdash; Platform Development Kit (PDK) - J721S2 User Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Platform Development Kit (PDK) - J721S2 User Guide" href="../index.html"/>
        <link rel="up" title="8. How to Guides" href="../family_cfg/j721s2/index_howto_j721s2.html"/>
        <link rel="next" title="8.2. Relocation of sections at runtime" href="run_time_placement_sections.html"/>
        <link rel="prev" title="8. How to Guides" href="../family_cfg/j721s2/index_howto_j721s2.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index_j721s2.html" class="icon icon-home"> Platform Development Kit (PDK) - J721S2 User Guide
          

          
          </a>

          
            
            
              <div class="version">
                08_06_01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_release_notes_j721s2.html">2. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ccs_setup_j721s2.html">4. CCS Setup for J721S2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_modules_j721s2.html">5. Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_boot_j721s2.html">6. Bootloader (SBL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_board_j721s2.html">7. Board/EVM Abstraction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../family_cfg/j721s2/index_howto_j721s2.html">8. How to Guides</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">8.1. Run a Application from DDR on R5 Cores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">8.1.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-freertos-applications-from-ddr-on-r5">8.1.2. Run FreeRTOS Applications from DDR on R5</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-baremetal-applications-from-ddr-on-r5">8.1.3. Run Baremetal Applications from DDR on R5</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="run_time_placement_sections.html">8.2. Relocation of sections at runtime</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_memory_benchmarking_app.html">8.3. Building and Running Memory Benchmarking Configurations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_faq_j721s2.html">9. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_developer_notes_j721s2.html">10. Developer Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index_j721s2.html">Platform Development Kit (PDK) - J721S2 User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index_j721s2.html">Docs</a> &raquo;</li>
      
          <li><a href="../family_cfg/j721s2/index_howto_j721s2.html">8. How to Guides</a> &raquo;</li>
      
    <li>8.1. Run a Application from DDR on R5 Cores</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="run-a-application-from-ddr-on-r5-cores">
<h1>8.1. Run a Application from DDR on R5 Cores<a class="headerlink" href="#run-a-application-from-ddr-on-r5-cores" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<span id="run-apps-from-ddr-on-r5-cores"></span><h2>8.1.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Once the R5 core is out of reset, the R5 defaults to no execute permissions for
the DDR memory space. The side effect of this is,  that all code, from entry point
till the code that sets up the MPU (Memory Protection Unit), has to be run from
internal memory.</p>
</div>
<div class="section" id="run-freertos-applications-from-ddr-on-r5">
<span id="run-app-from-ddr-on-r5"></span><h2>8.1.2. Run FreeRTOS Applications from DDR on R5<a class="headerlink" href="#run-freertos-applications-from-ddr-on-r5" title="Permalink to this headline">¶</a></h2>
<p>Application sets up the MPU as per the memory configuration set for <strong>gCslR5MpuCfg</strong>.
The default weak structure is present in csl/arch/r5/startup.c, and applications can override this if required.
Once the MPU is setup by the startUpCode (<strong>__mpu_init function</strong>), the rest of the code can run from DDR.</p>
<p>To ensure that all code from entry point to MPU setup is run from internal memory, following
sections must be placed in internal memory using the application&#8217;s linker
command file.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">.</span><span class="nl">freertosrstvectors</span>      <span class="p">:</span> <span class="p">{}</span> <span class="n">palign</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="o">&gt;</span> <span class="n">R5F_TCMA</span>
<span class="p">.</span><span class="nl">bootCode</span>                <span class="p">:</span> <span class="p">{}</span> <span class="n">palign</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="o">&gt;</span> <span class="n">OCMC_RAM</span>
<span class="p">.</span><span class="nl">startupCode</span>             <span class="p">:</span> <span class="p">{}</span> <span class="n">palign</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="o">&gt;</span> <span class="n">OCMC_RAM</span>
<span class="p">.</span><span class="nl">startupData</span>             <span class="p">:</span> <span class="p">{}</span> <span class="n">palign</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>      <span class="o">&gt;</span> <span class="n">OCMC_RAM</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="n">NOINIT</span>
</pre></div>
</div>
<p>You also need to make sure that the DDR has execute privileges in the gCslR5MpuCfg structure.
Refer the default structure in csl/arch/r5/startup.c</p>
</div>
<div class="section" id="run-baremetal-applications-from-ddr-on-r5">
<span id="run-baremetal-app-from-ddr-on-r5"></span><h2>8.1.3. Run Baremetal Applications from DDR on R5<a class="headerlink" href="#run-baremetal-applications-from-ddr-on-r5" title="Permalink to this headline">¶</a></h2>
<p>Baremetal applications have similar restrictions on running code from
internal memory till the MPU is configured.
For best comaptibility, however, make sure that the entry point is
always the reset vector, and that the code that sets up the DDR access
permissions in the MPU resides completely within 0x100 bytes of the
entry point.</p>
<p>For applications that find the default R5 configuration setup by the
CSL sufficient, there is another method that can be used to execute
an application from DDR. If the bootloader (SBL) is re-built using the
SBL_SKIP_MCU_RESET compile option (by enabling the corresponding line
in <a class="reference external" href="https://git.ti.com/keystone-rtos/sbl/blobs/master/sbl_component.mk#line399">sbl_component.mk</a>,
then SBL will branch to the application entry point without resetting the R5 core.</p>
<p>In this scenario, as the  R5 core was already setup when the SBL
invoked CSL init, the app can execute directly from DDR, right from its
entry point. However, the app must take care not to redo the R5 initialization
using CSL init, as the CSL initialization code assumes that the R5 registers are at their
reset default values. This can be done by simply defining an empty __mpu_init function in the
baremetal application. Refer <a class="reference external" href="https://git.ti.com/keystone-rtos/sbl/blobs/master/example/k3MulticoreApp/sbl_smp_r5.asm">sbl_smp_r5.asm</a>
for an example.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="run_time_placement_sections.html" class="btn btn-neutral float-right" title="8.2. Relocation of sections at runtime" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../family_cfg/j721s2/index_howto_j721s2.html" class="btn btn-neutral" title="8. How to Guides" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'08_06_01',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>