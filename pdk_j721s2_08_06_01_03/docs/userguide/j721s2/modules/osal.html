

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.4. OSAL &mdash; Platform Development Kit (PDK) - J721S2 User Guide</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  

  
    <link rel="top" title="Platform Development Kit (PDK) - J721S2 User Guide" href="../index.html"/>
        <link rel="up" title="5. Modules" href="../family_cfg/j721s2/index_modules_j721s2.html"/>
        <link rel="next" title="5.5. ENET" href="enet.html"/>
        <link rel="prev" title="5.3. SafeRTOS" href="../family_cfg/j721s2/index_modules_safertos_j721s2.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">
  <header id="tiHeader">
    <div class="top">
      <ul>
        <li id="top_logo">
          <a href="http://www.ti.com">
            <img src="../_static/img/ti_logo.png"/>
          </a>
        </li>
      </ul>
    </div>
    <div class="nav"></div>
  </header>
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index_j721s2.html" class="icon icon-home"> Platform Development Kit (PDK) - J721S2 User Guide
          

          
          </a>

          
            
            
              <div class="version">
                08_06_01
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_release_notes_j721s2.html">2. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ccs_setup_j721s2.html">4. CCS Setup for J721S2</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../family_cfg/j721s2/index_modules_j721s2.html">5. Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="csl.html">5.1. CSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="freertos.html">5.2. FreeRTOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../family_cfg/j721s2/index_modules_safertos_j721s2.html">5.3. SafeRTOS</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">5.4. OSAL</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">5.4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#user-interface">5.4.2. User Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#apis">5.4.2.1. APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-integration-details">5.4.2.2. Application Integration Details</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#application">5.4.3. Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#examples">5.4.3.1. Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="enet.html">5.5. ENET</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpio.html">5.6. GPIO</a></li>
<li class="toctree-l2"><a class="reference internal" href="i2c.html">5.7. I2C</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipc.html">5.8. IPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="mcasp.html">5.9. McASP</a></li>
<li class="toctree-l2"><a class="reference internal" href="pm.html">5.10. PM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../family_cfg/j721s2/index_modules_sciclient_j721s2.html">5.11. SCICLIENT</a></li>
<li class="toctree-l2"><a class="reference internal" href="spi.html">5.12. SPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="uart.html">5.13. UART</a></li>
<li class="toctree-l2"><a class="reference internal" href="../family_cfg/j721s2/index_modules_udma_j721s2.html">5.14. UDMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="pmic.html">5.15. PMIC</a></li>
<li class="toctree-l2"><a class="reference internal" href="mmcsd.html">5.16. MMCSD</a></li>
<li class="toctree-l2"><a class="reference internal" href="dss.html">5.17. DSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="fvid2.html">5.18. FVID2 User Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_boot_j721s2.html">6. Bootloader (SBL)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_board_j721s2.html">7. Board/EVM Abstraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_howto_j721s2.html">8. How to Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_faq_j721s2.html">9. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../family_cfg/j721s2/index_developer_notes_j721s2.html">10. Developer Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index_j721s2.html">Platform Development Kit (PDK) - J721S2 User Guide</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index_j721s2.html">Docs</a> &raquo;</li>
      
          <li><a href="../family_cfg/j721s2/index_modules_j721s2.html">5. Modules</a> &raquo;</li>
      
    <li>5.4. OSAL</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="osal">
<h1>5.4. OSAL<a class="headerlink" href="#osal" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>5.4.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The OSAL library provides operating system abstraction layer API sample
implementations that are required for processor SDK drivers. Scope of
APIs supported in the module is limited to support OS services required
for RTOS or bare metal drivers</p>
<ul class="simple">
<li>Supported Operating Systems<ul>
<li>FreeRTOS</li>
<li>Non-OS (Baremetal)</li>
</ul>
</li>
<li>Supported SOCs<ul>
<li>Please refer to component release notes</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="user-interface">
<h2>5.4.2. User Interface<a class="headerlink" href="#user-interface" title="Permalink to this headline">¶</a></h2>
<p>For details about individual fields of this library structure, see the
PDK doxygen documentation / <a class="reference external" href="../../../apiguide/j721e/html/group__DRV__OSAL__MODULE.html">OSAL API Guide</a></p>
<div class="section" id="apis">
<h3>5.4.2.1. APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h3>
<p>Porting of OSAL component will enable extending PDK components to
additional OS environment. Reference top level API header file
includes:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="cp">#include</span> <span class="cpf">&lt;ti/osal/osal.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>The following table shows which all OSAL modules are supported for FreeRTOS and Non-OS.
Using OSAL APIs that are not supported for an OS will result in linking errors.</p>
<table border="1" class="docutils">
<colgroup>
<col width="46%" />
<col width="28%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">OSAL Module</th>
<th class="head">FreeRTOS</th>
<th class="head">Non-OS(Baremetal)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Tasks (TaskP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Semaphores (SempahoreP)</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>HW Interrupts (HwiP)</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>HW Timers (TimerP)</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>Cache Ops (CahceP)</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-odd"><td>Cycle profiler (CycleProfilerP)</td>
<td>YES</td>
<td>YES</td>
</tr>
<tr class="row-even"><td>SW Timer (ClockP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Events (EventP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>SW Mailbox (MailboxP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Mutex (MutexP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Queue (QueueP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>Arbitrary Heap (HeapP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-even"><td>Task/CPU Load (LoadP)</td>
<td>YES</td>
<td>NO</td>
</tr>
<tr class="row-odd"><td>SW Interrupts (SwiP)</td>
<td>NO</td>
<td>NO</td>
</tr>
</tbody>
</table>
<p>In case of FreeRTOS/Non-OS, static memory allocation is done inside the osal library for <strong>all</strong> the modules.</p>
<p>The static memory allocation for SemaphoreP and HwiP are scalable if needed by the
application users, especially when the create APIs fail to create the SemaphoreP and HwiP handles. (Indicated by NULL handle values).</p>
<p>The application can provide a continuous segment of external memory for SemaphoreP as below.</p>
<ol class="arabic simple">
<li>Get the current OSAL attributes</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">...</span>
<span class="n">osal_ret</span> <span class="o">=</span> <span class="n">Osal_getHwAttrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hwAttrs</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Set the continuous external memory block address and size</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">...</span>
<span class="n">hwAttrs</span><span class="p">.</span><span class="n">extSemaphorePBlock</span><span class="p">.</span><span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">semPMemBlock</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">...</span>
<span class="n">hwAttrs</span><span class="p">.</span><span class="n">extSemaphorePBlock</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">SEMP_BLOCK_SIZE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">ctrlBitMap</span>                      <span class="o">=</span> <span class="n">OSAL_HWATTR_SET_SEMP_EXT_BASE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">osal_ret</span> <span class="o">=</span> <span class="n">Osal_setHwAttrs</span><span class="p">(</span><span class="n">ctrlBitMap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hwAttrs</span><span class="p">);</span>
</pre></div>
</div>
<p>The application can provide a continuous segment of external memory for HwiP as below.</p>
<ol class="arabic simple">
<li>Get the current OSAL attributes</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">...</span>
<span class="n">osal_ret</span> <span class="o">=</span> <span class="n">Osal_getHwAttrs</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hwAttrs</span><span class="p">);</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Set the continuous external memory block address and size</li>
</ol>
<div class="highlight-cpp"><div class="highlight"><pre><span class="p">...</span>
<span class="n">hwAttrs</span><span class="p">.</span><span class="n">extSemaphorePBlock</span><span class="p">.</span><span class="n">base</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uintptr_t</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">hwiPMemBlock</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">...</span>
<span class="n">hwAttrs</span><span class="p">.</span><span class="n">extSemaphorePBlock</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">HWIP_BLOCK_SIZE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">ctrlBitMap</span>                      <span class="o">=</span> <span class="n">OSAL_HWATTR_SET_HWIP_EXT_BASE</span><span class="p">;</span>
<span class="p">...</span>
<span class="n">osal_ret</span> <span class="o">=</span> <span class="n">Osal_setHwAttrs</span><span class="p">(</span><span class="n">ctrlBitMap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hwAttrs</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="application-integration-details">
<h3>5.4.2.2. Application Integration Details<a class="headerlink" href="#application-integration-details" title="Permalink to this headline">¶</a></h3>
<p><strong>Baremetal or Non-OS Use case</strong></p>
<p>Reference library path to be included in application build environment:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ti</span><span class="o">/</span><span class="n">osal</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">nonos</span><span class="o">/</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="o">/</span><span class="p">[[</span><span class="n">cpu</span><span class="p">]</span><span class="o">/&gt;</span>
</pre></div>
</div>
<p><strong>FreeRTOS based application</strong></p>
<p>Reference library path to be included in application build environment:</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">ti</span><span class="o">/</span><span class="n">osal</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">freertos</span><span class="o">/</span><span class="p">[</span><span class="n">soc</span><span class="p">]</span><span class="o">/</span><span class="p">[[</span><span class="n">cpu</span><span class="p">]</span><span class="o">/&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="application">
<h2>5.4.3. Application<a class="headerlink" href="#application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="examples">
<h3>5.4.3.1. Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p class="rubric" id="osal-unit-test">OSAL Unit Test</p>
<p><strong>Application Name</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="40%" />
<col width="41%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Example</th>
<th class="head">FreeRTOS</th>
<th class="head">Non-OS(Baremetal)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Unit Test</td>
<td>OSAL_TestApp_freertos</td>
<td>OSAL_Baremetal_TestApp</td>
</tr>
</tbody>
</table>
<p><strong>Description</strong></p>
<p>The unit testapp tests all the supported OSAL modules for an OS
and prints output on UART console.</p>
<p><strong>Expected Results</strong></p>
<p>The output for each of the tests (Hwi, Timer, Delay, Semaphores etc) can
be seen on the UART console like</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
<p>After a successful run following will also be displayed on the UART console.</p>
<div class="highlight-cpp"><div class="highlight"><pre><span class="n">All</span> <span class="n">tests</span> <span class="n">have</span> <span class="n">passed</span><span class="p">.</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="enet.html" class="btn btn-neutral float-right" title="5.5. ENET" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../family_cfg/j721s2/index_modules_safertos_j721s2.html" class="btn btn-neutral" title="5.3. SafeRTOS" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
      <a href="http://www.ti.com/corp/docs/legal/copyright.shtml">&copy; Copyright 1995-2020</a>, Texas Instruments Incorporated. All rights reserved. <br>
      <a href="http://www.ti.com/corp/docs/legal/trademark/trademrk.htm">Trademarks</a> | <a href="http://www.ti.com/corp/docs/legal/privacy.shtml">Privacy policy</a> | <a href="http://www.ti.com/corp/docs/legal/termsofuse.shtml">Terms of use</a> | <a href="http://www.ti.com/lsds/ti/legal/termsofsale.page">Terms of sale</a>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'08_06_01',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    <script src="http://www.ti.com/assets/js/headerfooter/analytics.js" type="text/javascript" charset="utf-8"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
        });

      var menuHeight = window.innerHeight;

      var contentOffset = $(".wy-nav-content-wrap").offset();
      var contentHeight = $(".wy-nav-content-wrap").height();
      var contentBottom = contentOffset.top + contentHeight;

      function setNavbarTop() {
          var scrollTop = $(window).scrollTop();
          var maxTop = scrollTop + menuHeight;

          // If past the header
          if (scrollTop > contentOffset.top && maxTop < contentBottom) {
            stickyTop = scrollTop - contentOffset.top;
          } else if (maxTop > contentBottom) {
            stickyTop = scrollTop - contentOffset.top - (maxTop - contentBottom);
          } else {
            stickyTop = 0;
          }

          $(".wy-nav-side").css("top", stickyTop);
      }

      $(document).ready(function() {
        setNavbarTop();
        $(window).scroll(function () {
          setNavbarTop();
        });
      });
  </script>
   

</body>
</html>