<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MCUSW Datasheet: Gpt Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW Datasheet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('design_gpt_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Gpt Design Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#design_gpt_intro">Introduction</a><ul><li class="level2"><a href="#design_gpt_intro_overview">Overview</a></li>
<li class="level2"><a href="#design_gpt_gpt_overview">GPT Overview</a></li>
<li class="level2"><a href="#design_gpt_references">References</a></li>
</ul>
</li>
<li class="level1"><a href="#design_gpt_req">Requirements</a><ul><li class="level2"><a href="#design_gpt_features_supported">Features Supported</a></li>
<li class="level2"><a href="#design_gpt_features_not_supported">Features Not Supported / NON Compliance</a></li>
<li class="level2"><a href="#design_gpt_assumptions">Assumptions</a></li>
<li class="level2"><a href="#design_gpt_constraints">Constraints</a></li>
</ul>
</li>
<li class="level1"><a href="#design_gpt_description">Design Description</a><ul><li class="level2"><a href="#design_gpt_desc_funda">Fundamental Operation</a></li>
<li class="level2"><a href="#design_gpt_desc_dynamic">Dynamic Behavior</a><ul><li class="level3"><a href="#design_gpt_desc_dynamic_state">States</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_desc_modes">Modes of Timer</a><ul><li class="level3"><a href="#design_gpt_desc_modes_conti">Continuous Mode</a></li>
<li class="level3"><a href="#design_gpt_desc_modes_one_shot">One Shot Mode</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_desc_deter_time_elapsed">Determination of time elapsed</a></li>
<li class="level2"><a href="#design_gpt_desc_deter_time_remain">Determination of time remaining</a></li>
<li class="level2"><a href="#design_gpt_desc_deter_dir">Directory Structure</a></li>
<li class="level2"><a href="#design_gpt_desc_cfg">Configurator</a><ul><li class="level3"><a href="#design_gpt_desc_cfg_ti">NON Standard configurable parameters</a></li>
<li class="level3"><a href="#design_gpt_desc_cfg_ti_compute">Implementation specific parameters (computed)</a></li>
<li class="level3"><a href="#design_gpt_desc_cfg_variant">Variant Support</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_desc_cfg_dependency">Dependency on other modules</a><ul><li class="level3"><a href="#design_gpt_desc_cfg_dependency_sbl">SBL</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_desc_error">Error Classification</a><ul><li class="level3"><a href="#design_gpt_desc_error_dev">Development Errors</a></li>
<li class="level3"><a href="#design_gpt_desc_error_dev_detect">Error Detection</a></li>
<li class="level3"><a href="#design_gpt_desc_error_dev_notify">Error notification (DET)</a></li>
<li class="level3"><a href="#design_gpt_desc_error_runtime">Runtime Errors</a></li>
<li class="level3"><a href="#design_gpt_desc_error_dev_notify_dem">Error notification (DEM)</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_desc_res_behave">Resource Behavior</a></li>
</ul>
</li>
<li class="level1"><a href="#design_gpt_low_level">Low Level Definitions</a><ul><li class="level2"><a href="#design_gpt_low_level_dtypes">MACROS, Data Types &amp; Structures</a><ul><li class="level3"><a href="#design_gpt_low_level_readback_type">Gpt_RegisterReadbackType</a></li>
<li class="level3"><a href="#design_gpt_low_level_channel_cfg">Gpt_ChannelConfigType</a></li>
<li class="level3"><a href="#design_gpt_low_level_cfg">Gpt_ConfigType</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_low_level_api">API&#39;s</a><ul><li class="level3"><a href="#design_gpt_low_level_api_init">Gpt_Init</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_deinit">Gpt_DeInit</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_gte">Gpt_GetTimeElapsed</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_gtr">Gpt_GetTimeRemaining</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_st">Gpt_StartTimer</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_stopT">Gpt_StopTimer</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_en">Gpt_EnableNotification</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_dn">Gpt_DisableNotification</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_sm">Gpt_SetMode</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_dw">Gpt_DisableWakeup</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_ew">Gpt_EnableWakeup</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_cw">Gpt_CheckWakeup</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_gvi">Gpt_GetVersionInfo</a></li>
<li class="level3"><a href="#design_gpt_low_level_api_rb">Gpt_RegisterReadback</a></li>
</ul>
</li>
<li class="level2"><a href="#design_gpt_low_level_api_isr">Notify ISR</a></li>
<li class="level2"><a href="#design_gpt_low_level_api_wakeup_isr">Wakeup ISR</a></li>
<li class="level2"><a href="#design_gpt_low_level_globals">Global Variables</a></li>
</ul>
</li>
<li class="level1"><a href="#design_gpt_dar_top">Decision Analysis &amp; Resolution (DAR)</a><ul><li class="level2"><a href="#design_gpt_dar_reload">Use of DM Timer Auto-Reload mode for GPT continuous mode</a></li>
<li class="level2"><a href="#design_gpt_dar_criteria">DAR Criteria</a></li>
<li class="level2"><a href="#design_gpt_dar_alternatives">Available Alternatives</a></li>
<li class="level2"><a href="#design_gpt_dar_decision">Decision</a></li>
</ul>
</li>
<li class="level1"><a href="#design_gpt_test_top">Test Criteria</a></li>
<li class="level1"><a href="#design_gpt_rev_hist">Document Revision History</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="design_gpt_intro"></a>
Introduction</h1>
<hr/>
<h2><a class="anchor" id="design_gpt_intro_overview"></a>
Overview</h2>
<p>The figure below depicts the AUTOSAR layered architecture as 3 distinct layers, Application, Runtime Environment (RTE) and Basic Software (BSW). The BSW is further divided into 4 layers, Services, Electronic Control Unit Abstraction, MicroController Abstraction (MCAL) and Complex Drivers.</p>
<div class="image">
<img src="autosar_acrhitecture_common.png" alt="autosar_acrhitecture_common.png"/>
<div class="caption">
AUTOSAR Architecture</div></div>
<p> MCAL is the lowest abstraction layer of the Basic Software. It contains software modules that interact with the Microcontroller and its internal peripherals directly. Gpt driver is part of the Microcontroller Drivers (block, show above). Below shows the position of the Gpt driver in the AUTOSAR Architecture.</p>
<div class="image">
<img src="autosar_acrhitecture_gpt.png" alt="autosar_acrhitecture_gpt.png"/>
<div class="caption">
AUTOSAR Architecture – GPT MCAL</div></div>
 <hr/>
 <h2><a class="anchor" id="design_gpt_gpt_overview"></a>
GPT Overview</h2>
<p>Gpt primarily used to generate different time bases that other modules of AUTOSAR could depend on. TDA4x, DRA80x class of devices includes multiple timers, below listed are some of the key features provided.</p>
<ul>
<li>Free running 32 bit up counter</li>
<li>Auto reload mode (can be used for continuous counter operation)</li>
<li>Support dynamic Start / Stop counter operation</li>
<li>Programmable clock dividers (2n, where n = [0-8])</li>
<li>2 timers modules could be operated in cascaded mode to provide 64bit counter</li>
<li>Programmable interrupt generation on overflow, compare and capture</li>
<li>Programmable clock source</li>
</ul>
<p>Supports 3 basic functional modes Timer mode, Capture mode &amp; Compare mode. Refer section (<a class="el" href="design_gpt_top.html#design_gpt_references">References</a>) for more details on timer operation.</p>
<hr/>
 <h2><a class="anchor" id="design_gpt_references"></a>
References</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.3.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for GPT Driver <a href="https://www.autosar.org/fileadmin/user_upload/standards/classic/4-3/AUTOSAR_SWS_GPTDriver.pdf">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">DRA80x and TDA4x TRM  </td><td class="markdownTableBodyNone">Technical Reference Manual <a href="http://www.ti.com/product/DRA80M/technicaldocuments">DRA80X</a>, <a href="http://www.ti.com/product/TDA4VM/technicaldocuments">TDA4X</a> Timer module is detailed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">BSW General Requirements / Coding guidelines  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/Coding+Guidelines">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Software Product Specification (SPS)  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/MCUSW+Software+Product+Specification">Intranet Link</a> Requirements are derived from <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>   </td></tr>
</table>
<hr/>
 <h1><a class="anchor" id="design_gpt_req"></a>
Requirements</h1>
<p>The Gpt driver shall implement as per requirements detailed in <a class="el" href="design_gpt_top.html#design_gpt_references">4</a>, <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> and <a class="el" href="design_gpt_top.html#design_gpt_references">3</a>. It’s recommended to refer <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> for clarification.</p>
<hr/>
 <h2><a class="anchor" id="design_gpt_features_supported"></a>
Features Supported</h2>
<p>Below listed are some of the key features that are expected to be supported</p>
<ul>
<li>Starting and stopping of hardware timers</li>
<li>Getting the timer values</li>
<li>Setting one shot mode or continuous mode</li>
<li>Controlling time triggered interrupt notifications</li>
<li>Controlling time triggered wakeup interrupts</li>
<li>The requirement id’s listed below shall be supported</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_001  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2123, MCAL-955, MCAL-920, MCAL-921, MCAL-922, MCAL-923, MCAL-925, MCAL-929, MCAL-930, MCAL-932, MCAL-933, MCAL-937, MCAL-938, MCAL-939, MCAL-942, MCAL-947, MCAL-980, MCAL-945, MCAL-1056   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <div class="image">
<img src="caution.png" alt="caution.png"/>
</div>
 <h2><a class="anchor" id="design_gpt_features_not_supported"></a>
Features Not Supported / NON Compliance</h2>
<ul>
<li><b>[NON Compliance]</b> Gpt PreDef Timers is not supported</li>
<li><b>[NON Compliance]</b> GptClockReference doesn’t refer to McuClockReferencePoint. Refer section (<a class="el" href="design_gpt_top.html#design_gpt_constraints">Constraints</a>) for details.</li>
<li>Standard AUTOSAR GPT specification <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>, categorizes few BSW General Requirements as non-requirements, please refer MCAL-2124 for details</li>
<li>Supports additional configuration parameters, refer section (<a class="el" href="design_gpt_top.html#design_gpt_desc_cfg_ti_compute">Implementation specific parameters (computed)</a>) &amp; (<a class="el" href="design_gpt_top.html#design_gpt_low_level_api_rb">Gpt_RegisterReadback</a>)</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_002  </td></tr>
<tr>
<td><em><b>Non Requirements</b></em> </td><td>MCAL-2124, MCAL-2080, MCAL-2079, MCAL-2110, MCAL-2109, MCAL-2108, MCAL-2107, MCAL-2106, MCAL-2105, MCAL-2104, MCAL-2103, MCAL-2102, MCAL-2101, MCAL-2007, MCAL-2001, MCAL-2001, MCAL-1991, MCAL-1983, MCAL-1982, MCAL-1981, MCAL-1980, MCAL-1979, MCAL-1948, MCAL-1947   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_gpt_assumptions"></a>
Assumptions</h2>
<p>Below listed are assumed to valid for this design/implementation, exceptions and other deviations are listed for each explicitly. Care should be taken to ensure these assumptions are addressed.</p>
<ol type="1">
<li>The functional clock to the GPT module is expected to be on before calling any GPT module API.</li>
<li>The GPT driver as such doesn’t perform any PRCM programming to get the functional clock.</li>
<li><b> The clock-source selection for GPT is not performed by the GPT driver, other entities such as SBL, MCAL module MCU shall perform the same. </b></li>
<li><b> The GTC hardware present in the SOC shall not be supported as GPT module. </b></li>
</ol>
<p>Note that assumption 1 &amp; 2 are specified by AUTOSAR GPT specification and 3 &amp; 4 are device specific assumption.</p>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_gpt_constraints"></a>
Constraints</h2>
<p>Some of the critical constraints of this design are listed below</p>
<ul>
<li>Is cases where MCU module is not employed (supported) to configure the clock source for GPT module (refer <a class="el" href="design_gpt_top.html#design_gpt_assumptions">Assumptions</a> sub-item 3). The GPT module configurator shall refer to MCU clock source as listed in specification.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_003  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1951, MCAL-1960, MCAL-1950   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h1><a class="anchor" id="design_gpt_description"></a>
Design Description</h1>
<hr/>
 <h2><a class="anchor" id="design_gpt_desc_funda"></a>
Fundamental Operation</h2>
<p>As detailed in the TRM, the timer module generates an interrupt when the counter reaches its maximum value (i.e. 0xFFFFFFFF, for a 32 bit counter). The basic idea is use “Auto Reload” mode of the timer and initial count that could be set (TCRR register). Consider an example where timer is configured to expire after reaching a count of 0x0E000000</p>
<div class="image">
<img src="gpt_design_timer_not_started.png" alt="gpt_design_timer_not_started.png"/>
<div class="caption">
Timer not yet started</div></div>
<p> Following sequence of steps shall be performed, before the timer could be started</p><ul>
<li>The initial count of the counter is set to 0xF1FFFFFF (i.e. 0xFFFFFFFF - 0x0E000000)</li>
<li>The reload register (TLDR) is set with 0xF1FFFFFF as depicted above</li>
</ul>
<div class="image">
<img src="gpt_design_timer_started.png" alt="gpt_design_timer_started.png"/>
<div class="caption">
Timer started</div></div>
<ul>
<li>Timer is programmed as configured (one shot or continuous mode)</li>
<li>The timer is started and the counter (register TCRR), starts counting on every pulse<ul>
<li>As depicted in above figure, TCRR has moved w.r.t to TLDR</li>
</ul>
</li>
</ul>
<div class="image">
<img src="gpt_design_timer_expired.png" alt="gpt_design_timer_expired.png"/>
<div class="caption">
Timer expired</div></div>
<ul>
<li>When the timer expires, the TCRR is loaded with value present in TLDR as show above</li>
<li>An interrupt can be triggered at this point</li>
<li>The timer would default to as show in figure "Timer not yet started", in continuous mode. Also note that no explicit start would be required</li>
<li>In One Shot mode, timer is halted. i.e. TCRR stop counting the count of 0xFFFFFFFF is retained by TCRR</li>
</ul>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_gpt_desc_dynamic"></a>
Dynamic Behavior</h2>
<h3><a class="anchor" id="design_gpt_desc_dynamic_state"></a>
States</h3>
<p>As detailed in section 7.1 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>, a timer would be in one of the following states. Initialized, running, stopped, expired. A variable shall be maintained on per channel basis to track and maintain the state. The diagram below shows transitions of states and it’s associated service API’s.</p>
<div class="image">
<img src="gpt_design_timer_state.png" alt="gpt_design_timer_state.png"/>
<div class="caption">
Timer States : Sourced from AUTOSAR Spec</div></div>
<p> <a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_gpt_desc_modes"></a>
Modes of Timer</h2>
<p>Refer <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> specifically section 7.1 of the specification for more details</p>
<hr/>
 <h3><a class="anchor" id="design_gpt_desc_modes_conti"></a>
Continuous Mode</h3>
<div class="image">
<img src="gpt_design_timer_mode_conti.png" alt="gpt_design_timer_mode_conti.png"/>
<div class="caption">
Mode: Continuous: Sourced from AUTOSAR GPT Driver spec</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_006  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1976, MCAL-1975, MCAL-1973   </td></tr>
</table>
<div class="image">
<img src="gpt_design_timer_mode_conti_timevalues.png" alt="gpt_design_timer_mode_conti_timevalues.png"/>
<div class="caption">
Continuous mode: expected time value Sourced from AUTOSAR GPT Driver spec</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_007  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2018, MCAL-2028   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
<h3><a class="anchor" id="design_gpt_desc_modes_one_shot"></a>
One Shot Mode</h3>
<div class="image">
<img src="gpt_design_timer_mode_oneshot.png" alt="gpt_design_timer_mode_oneshot.png"/>
<div class="caption">
Mode: One Shot: Sourced from AUTOSAR GPT Driver spec</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_008  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1974, MCAL-1973   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_deter_time_elapsed"></a>
Determination of time elapsed</h2>
<p>The elapsed time could be computed under following conditions, also Refer <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> specifically “Table 5: Summary: Return values and DET errors of Gpt_GetTimeElapsed”</p>
<ul>
<li>In continuous mode<ul>
<li>Can be obtained by subtracting Timer Reload Register value (TLDR) from current counter value (TCRR)</li>
</ul>
</li>
<li>In One Shot mode<ul>
<li>Timer is counting<ul>
<li>Same as “In Continuous mode”</li>
</ul>
</li>
<li>Timer expired<ul>
<li>Can be obtained by subtracting Timer Reload Register value from max value (i.e. 0xFFFFFFFF for 32 bit counter)</li>
</ul>
</li>
</ul>
</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_009  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2018   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_deter_time_remain"></a>
Determination of time remaining</h2>
<p>The elapsed time could be computed under following conditions, also Refer <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> section 1.5 specifically “Table 6: Summary: Return values and DET errors of Gpt_GetTimeRemaining”</p>
<ul>
<li>In continuous mode<ul>
<li>Can be obtained by subtracting current counter value (TCRR) from max value (i.e. 0xFFFFFFFF for 32 bit counter)</li>
</ul>
</li>
<li>In One Shot mode<ul>
<li>Timer is counting<ul>
<li>Same as “In Continuous mode”</li>
</ul>
</li>
<li>Timer expired<ul>
<li>Value is always 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_010  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2028   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_deter_dir"></a>
Directory Structure</h2>
<p>The directory structure is as depicted in figures below, the source files can be categorized under “Driver Implementation” and “Example Application”</p>
<p><b>Driver Implemented by </b></p><ul>
<li><a class="el" href="Gpt_8h.html" title="This file contains interface header for GPT MCAL driver. ">Gpt.h</a> and <a class="el" href="Gpt__Irq_8h.html" title="This file contains ISR function declaration for GPT MCAL driver. ">Gpt_Irq.h</a>: Shall implement the interface provided by the driver</li>
<li>Gpt.c, Gpt_Gptimer.c, Gpt_Irq.c and Gpt_Priv.h: Shall implement the driver functionality</li>
</ul>
<p><b>Example Application</b></p><ul>
<li><a class="el" href="Gpt__Cfg_8h.html" title="This file contains generated pre compile configurations for GPT MCAL driver. ">Gpt_Cfg.h</a> and Gpt_Cfg.c: Shall implement the generated configuration for pre-compile variant</li>
<li>Gpt_PBcfg.c: Shall implement the generated configuration for post-build variant</li>
<li>GptApp.c and GptApp.h: Shall implement the example application that demonstrates the use of the driver</li>
</ul>
<div class="image">
<img src="gpt_design_timer_dir.png" alt="gpt_design_timer_dir.png"/>
<div class="caption">
Directory Structure</div></div>
 <div class="image">
<img src="gpt_design_timer_dir_detailed.png" alt="gpt_design_timer_dir_detailed.png"/>
<div class="caption">
Detailed Directory Structure</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_011  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1972, MCAL-1971, MCAL-1970   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_cfg"></a>
Configurator</h2>
<p>The AUTOSAR GPT Driver Specification details mandatory parameters that shall be configurable via the configurator. Please refer section 10 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_012  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1945, MCAL-1969, MCAL-1968, MCAL-1967, MCAL-1966, MCAL-1965, MCAL-1964, MCAL-1963, MCAL-1962, MCAL-1961, MCAL-1960, MCAL-1959, MCAL-1958, MCAL-1957, MCAL-1956, MCAL-1955, MCAL-1954, MCAL-1953, MCAL-1952, MCAL-1951, MCAL-1950, MCAL-1949, MCAL-1946, MCAL-1945   </td></tr>
</table>
<hr/>
 <h3><a class="anchor" id="design_gpt_desc_cfg_ti"></a>
NON Standard configurable parameters</h3>
<p>Following lists this design’s specific configurable parameters</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Usage comment -&mdash;   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GptDefaultOSCounterId  </td><td class="markdownTableBodyNone">This shall allow integrators to specify the OS counter instance to be used in OS API GetCounterValue () The driver shall implement timed-wait for all waits (e.g. waiting for reset to complete). This timed wait shall use OS API GetCounterValue ()   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">GptDeviceVariant  </td><td class="markdownTableBodyNone">This shall allow integrators to select the device variant for which integration is being performed. This parameter shall be used by driver to impose device specific constraints. The user guide shall detail the device specific constraints   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">GptChannelPrescale  </td><td class="markdownTableBodyNone">This parameter per channel and as part of container “GptChannelConfigSet” will allow user to scale the FCLK   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_desc_cfg_ti_compute"></a>
Implementation specific parameters (computed)</h3>
<p>The configurator shall determine the maximum number of channels that are configured and generate a macro to define the same. This shall be used to perform range checks on channel configurations and channel ID provided at driver initialization time. Refer section (<a class="el" href="design_gpt_top.html#design_gpt_low_level_dtypes">MACROS, Data Types &amp; Structures</a>)</p>
<h3><a class="anchor" id="design_gpt_desc_cfg_variant"></a>
Variant Support</h3>
<p>The driver shall support both VARIANT-POST-BUILD &amp; VARIANT-PRE-COMPILE</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_014  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1945   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_cfg_dependency"></a>
Dependency on other modules</h2>
<p>In addition to dependencies listed in section 5 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>, GPT driver shall depend on these modules to realize the required functionality. GPT uses Timer hardware present in the device to realize the functionality, this peripheral requires 2 different clock to be operational, namely ICLK and FCLK.</p>
<h3><a class="anchor" id="design_gpt_desc_cfg_dependency_sbl"></a>
SBL</h3>
<ul>
<li><b>ICLK</b>: Is interface clock required for internal operation of the peripheral. This is not expected to change and typically programmed by SBL, please refer the device specific manual for details and valid value.</li>
<li><b>FCLK</b>: Is functional clock, used to drive the counter of the timer module. As per AUTOSAR GPT module specification <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>, the GPT driver shall refer MCU Clock reference point. As detailed in section (<a class="el" href="design_gpt_top.html#design_gpt_constraints">Constraints</a>), other entity would require to select the right clock source for the peripheral.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_015  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1950   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_desc_error"></a>
Error Classification</h2>
<p>Errors are classified in two categories, development error and runtime / production error.</p>
<hr/>
 <h3><a class="anchor" id="design_gpt_desc_error_dev"></a>
Development Errors</h3>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em> </td><td><em><b> Refer Req </b></em>  </td></tr>
<tr>
<td>API service called without module initialization  </td><td>GPT_E_UINIT  </td><td>0x0A  </td><td>MCAL-2512   </td></tr>
<tr>
<td>API service for initialization is called when already initialized  </td><td>GPT_E_ALREADY_INITIALIZED  </td><td>0x0D  </td><td>MCAL-2515   </td></tr>
<tr>
<td>API error return code: Init function failed  </td><td>GPT_E_INIT_FAILED  </td><td>0x0E  </td><td>MCAL-2516   </td></tr>
<tr>
<td>API parameter checking: invalid channel  </td><td>GPT_E_PARAM_CHANNEL  </td><td>0x14  </td><td>MCAL-2517   </td></tr>
<tr>
<td>API parameter checking: invalid value  </td><td>GPT_E_PARAM_VALUE  </td><td>0x15  </td><td>MCAL-2518   </td></tr>
<tr>
<td>API parameter checking: invalid pointer  </td><td>GPT_E_PARAM_POINTER  </td><td>0x16  </td><td>MCAL-2519   </td></tr>
<tr>
<td>API parameter checking: invalid mode  </td><td>GPT_E_PARAM_MODE  </td><td>0x1F  </td><td>MCAL-2520   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_037  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2512, MCAL-2515, MCAL-2516, MCAL-2517, MCAL-2518, MCAL-2519, MCAL-2520   </td></tr>
</table>
<h3><a class="anchor" id="design_gpt_desc_error_dev_detect"></a>
Error Detection</h3>
<p>The detection of development errors is configurable (ON / OFF) at pre-compile time. The switch GptDevErrorDetect will activate or deactivate the detection of all development errors.</p>
<h3><a class="anchor" id="design_gpt_desc_error_dev_notify"></a>
Error notification (DET)</h3>
<p>All detected development errors are reported to Det_ReportError service of the Development Error Tracer (DET).</p>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_desc_error_runtime"></a>
Runtime Errors</h3>
<p>The following runtime/production errors shall be detectable by Gpt driver.</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>API service is called when timer channel is still busy  </td><td>GPT_E_BUSY  </td><td>0x0B   </td></tr>
</table>
<h3><a class="anchor" id="design_gpt_desc_error_dev_notify_dem"></a>
Error notification (DEM)</h3>
<p>All detected run time errors shall be reported to Det_ReportRuntimeError () service.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_017  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2100, MCAL-2094, MCAL-2093, MCAL-2087, MCAL-2086, MCAL-2077, MCAL-2076, MCAL-2067, MCAL-2066, MCAL-2065, MCAL-2060, MCAL-2059, MCAL-2058, MCAL-2053, MCAL-2052, MCAL-2049, MCAL-2045, MCAL-2044, MCAL-2043, MCAL-2042, MCAL-2036, MCAL-2035, MCAL-2027, MCAL-2026, MCAL-2016, MCAL-2015, MCAL-2003, MCAL-1993, MCAL-1984, MCAL-2513   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
<h2><a class="anchor" id="design_gpt_desc_res_behave"></a>
Resource Behavior</h2>
<ul>
<li><b> Code Size </b>: Implementation of this driver shall not exceed 5 kilo lines of code and 1 KB of data section.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_004  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2126   </td></tr>
</table>
<ul>
<li><b> Stack Size </b>: Worst case stack utilization shall not exceed 2 kilo bytes.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_005  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2125   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
<h1><a class="anchor" id="design_gpt_low_level"></a>
Low Level Definitions</h1>
<hr/>
<p> The detailed API and interface description is available as part of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> &amp; <a class="el" href="design_gpt_top.html#design_gpt_references">4</a>. This section describes the API supported by the MCAL driver and the requirements covered by each of the API.</p>
<h2><a class="anchor" id="design_gpt_low_level_dtypes"></a>
MACROS, Data Types &amp; Structures</h2>
<p>The sections below lists some of key data structures that shall be implemented and used in driver implementation</p>
<h3>Maximum number of channels</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">GPT_MAX_CHANNELS  </td><td class="markdownTableBodyNone">Defines the maximum number of channels that are configured. Its required that configurations for all channel specified is valid.   </td></tr>
</table>
<h3>Gpt_ValueType</h3>
<p>Used to specify the timer ticks, please refer section 8.3.2 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<h3>Gpt_ModeType</h3>
<p>Enumeration, refer section 8.3.4 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<h3>Gpt_PredefTimerType</h3>
<p>Enumeration, refer section 8.3.5 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<h3>Gpt_NotifyType</h3>
<p>Is a function pointer with prototype as <b> void Gpt_Notification_&lt;channel&gt; ( void )” </b>. The “_channel” postfix is provided by integrators via the configurator. “_channel” is used by applications to uniquely identify the GPT channel. Refer section 8.7.3.1 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<h3>Gpt_ChannelMode</h3>
<p>Refer section 10.6.2 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_readback_type"></a>
Gpt_RegisterReadbackType</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Range  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gptRev  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">H/W version identifier, will not change for a given SoC   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">gptTtgr  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Shall always read 0xFFFFFFFF   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gptTimerSynCtrl  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Interface control register, will read 0x00000000   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_channel_cfg"></a>
Gpt_ChannelConfigType</h3>
<p>Used to define channel specific parameters for, one channel and the values of these are expected to be populated by configurator.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">channelId  </td><td class="markdownTableBodyNone">Used to identify the channel (instance of timer (h/w) in implementation   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gpt_ChannelMode  </td><td class="markdownTableBodyNone">channelMode  </td><td class="markdownTableBodyNone">Used to specify the mode of channel   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">tickValueMax  </td><td class="markdownTableBodyNone">Maximum value in ticks, the timer channel is able to count. With the next tick, the timer rolls over to zero   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">enableWakeupFlag  </td><td class="markdownTableBodyNone">Flag indicating, if wakeup functionality is to be supported on this channel   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gpt_NotifyType  </td><td class="markdownTableBodyNone">fnPtrNotifyFunction  </td><td class="markdownTableBodyNone">Pointer to function, which shall be called to notify. Expected to be populated by the configurator   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">wakeupSourceRef  </td><td class="markdownTableBodyNone">Value that shall be passed as function argument, when wakeup event occurs   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">prescale  </td><td class="markdownTableBodyNone">The peripheral provide ability to scale function clock (FCLK), this parameter shall define scaling factor for this clock. The value/range would be device specific, check with device TRM for details.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_018  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2119, MCAL-2114, MCAL-1990, MCAL-1989, MCAL-1988, MCAL-1961, MCAL-1959, MCAL-1958, MCAL-1955, MCAL-1953, MCAL-1952   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_cfg"></a>
Gpt_ConfigType</h3>
<p>Used to define all channels specific parameters, shall be supplied to Gpt_Init () function. Values of these are expected to be populated by configurator.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structGpt__ChannelConfigType.html" title="Configuration per channel. ">Gpt_ChannelConfigType</a> *  </td><td class="markdownTableBodyNone">channelCfgPtr  </td><td class="markdownTableBodyNone">Is a constant pointer, pointing to all channel specific parameters. For “VARIANT-PRE-COMPILE” an instance of this structure shall instantiated in Gpt_Cfg.c by the configurator and driver implementation shall refer directly. Consider naming this variable as GptChannelConfigSet_PC For “VARIANT-POST-BUILD” an pointer of this type shall be provided to Gpt_Init () function.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_019  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1987   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3>Gpt_ConfigChannelType_PC (only if implementing v AUTOSAR 4.3.1)</h3>
<p>Used to define all channels identifiers, values of these are expected to be populated by configurator.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gpt_ChannelType  </td><td class="markdownTableBodyNone">channelId[GPT_MAX_CHANNELS]  </td><td class="markdownTableBodyNone">Shall contain channel identifiers for all channels. For “VARIANT-PRE-COMPILE” an instance of this structure shall instantiated in Gpt_Cfg.c by the configurator and driver implementation shall refer directly. Consider naming this variable as GptChannelIdConfig_PC. For “VARIANT-POST-BUILD”, this shall not be used, i.e. Gpt_Init (NULL_PTR)   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_020  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1987, MCAL-1954   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_gpt_low_level_api"></a>
API's</h2>
<p>For the standard API's please refer 8.3 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a>. Sections below highlight other design considerations for the implementation.</p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_init"></a>
Gpt_Init</h3>
<p>Refer section 8.3.2 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_021  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2006, MCAL-2005, MCAL-2004, MCAL-2003, MCAL-2002, MCAL-2000, MCAL-1999, MCAL-1998, MCAL-1997, MCAL-1996, MCAL-1995, MCAL-1994   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_deinit"></a>
Gpt_DeInit</h3>
<p>Refer section 8.3.3 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_022  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2017, MCAL-2016, MCAL-2015, MCAL-2014, MCAL-2013, MCAL-2012, MCAL-2011, MCAL-2010, MCAL-2009, MCAL-2008, MCAL-1964   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_gte"></a>
Gpt_GetTimeElapsed</h3>
<p>Refer section 8.3.4 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_023  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2027, MCAL-2026, MCAL-2025, MCAL-2024, MCAL-2023, MCAL-2022, MCAL-2021, MCAL-2020, MCAL-2019, MCAL-2018, MCAL-1966   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_gtr"></a>
Gpt_GetTimeRemaining</h3>
<p>Refer section 8.3.5 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_024  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2028, MCAL-2029, MCAL-2030, MCAL-2031, MCAL-2032, MCAL-2033, MCAL-2034, MCAL-2035, MCAL-2036, MCAL-1967   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_st"></a>
Gpt_StartTimer</h3>
<p>Refer section In addition to details provided in 8.3.6 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> following design shall be implemented.</p>
<ul>
<li>Interrupt shall be enabled for channels, for which the notification or wake-enable is enabled.</li>
<li>The timer operating in ONE-SHOT mode the interrupt shall be enabled, irrespective of the enabled/disabled notification. As ISR would be right place to mark the channel as EXPIRED, otherwise the API’s like Gpt_GetTimeRemaining () and Gpt_ElapsedTime () would require special handling for EXPIRED timers.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_025  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2045, MCAL-2044, MCAL-2043, MCAL-2042, MCAL-2041, MCAL-2040, MCAL-2039, MCAL-2038, MCAL-2037   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_stopT"></a>
Gpt_StopTimer</h3>
<p>Refer section 8.3.7 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_026  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2053, MCAL-2052, MCAL-2051, MCAL-2050, MCAL-2049, MCAL-2048, MCAL-2047, MCAL-2046   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_en"></a>
Gpt_EnableNotification</h3>
<p>Refer section 8.3.8 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_027  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2060, MCAL-2059, MCAL-2058, MCAL-2057, MCAL-2056, MCAL-2055, MCAL-2054, MCAL-1977   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_dn"></a>
Gpt_DisableNotification</h3>
<p>In addition to details provided in 8.3.9 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a> following design shall be implemented.</p>
<ul>
<li>Interrupt shall be enabled for provided channel, when the channel state is in RUNNING or STOPPED or EXPIRED or INITIALIZED</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_028  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2067, MCAL-2066, MCAL-2065, MCAL-2064, MCAL-2063, MCAL-2062, MCAL-2061, MCAL-1965   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_sm"></a>
Gpt_SetMode</h3>
<p>Refer section 8.3.10 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_029  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2078, MCAL-2077, MCAL-2076, MCAL-2075, MCAL-2074, MCAL-2073, MCAL-2072, MCAL-2071, MCAL-2070, MCAL-2069, MCAL-2068   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_dw"></a>
Gpt_DisableWakeup</h3>
<p>Refer section 8.3.11 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_030  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2087, MCAL-2086, MCAL-2085, MCAL-2084, MCAL-2083, MCAL-2082, MCAL-2081, MCAL-1969   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_ew"></a>
Gpt_EnableWakeup</h3>
<p>Refer section 8.3.12 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_031  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2094, MCAL-2093, MCAL-2092, MCAL-2091, MCAL-2090, MCAL-2089, MCAL-2088, MCAL-1978, MCAL-1969   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_cw"></a>
Gpt_CheckWakeup</h3>
<p>Refer section 8.3.13 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_032  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2100, MCAL-2099, MCAL-2098, MCAL-2097, MCAL-2096, MCAL-2095, MCAL-1969   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_gvi"></a>
Gpt_GetVersionInfo</h3>
<p>Refer section 8.3.1 of <a class="el" href="design_gpt_top.html#design_gpt_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_033  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1992, MCAL-1993, MCAL-1968   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_gpt_low_level_api_rb"></a>
Gpt_RegisterReadback</h3>
<p>As noted from previous implementation, the timer configuration registers could potentially be corrupted by other entities (s/w or h/w). One of the recommended detection methods would be to periodically read-back the configuration and confirm configuration is consistent. The service API defined below shall be implemented to enable this detection.</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Gpt_RegisterReadback </td><td>Can potentially be turned OFF  </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>Std_ReturnType Gpt_RegisterReadback(Gpt_ChannelType GptChannel, <a class="el" href="structGpt__RegisterReadbackType.html" title="GPT register readback structure. ">Gpt_RegisterReadbackType</a> *RegRbPtr)  </td><td><a class="el" href="structGpt__RegisterReadbackType.html" title="GPT register readback structure. ">Gpt_RegisterReadbackType</a> defines the type, that holds critical values, refer below  </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>0x0F </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Non Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>GptChannel </td><td>Identifies a unique valid channel  </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>RegRbPtr </td><td>A pointer of type <a class="el" href="structGpt__RegisterReadbackType.html" title="GPT register readback structure. ">Gpt_RegisterReadbackType</a>, which holds the read back values   </td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Standard return type </td><td>E_OK or E_NOT_OK in case of invalid channel id  </td></tr>
</table>
<p>The critical register listed is a recommendation and implementation shall determine appropriate registers.</p>
<p>This service could potentially be turned OFF in the configurator.</p>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_low_level_api_isr"></a>
Notify ISR</h2>
<p>On elapse of configured count, the timer peripheral generates an interrupt. The implementation shall provide an ISR with prototype as “void Gpt_&lt;ChannelNum&gt;Isr (void)” The control flow shall be as depicted in flow chart figure below. Since, the function prototype dosen’t take any arguments to uniquely identify the timer channel that caused this interrupt, a separate ISR shall be implemented for each configured / enabled channel.</p>
<div class="image">
<img src="gpt_design_timer_isr.png" alt="gpt_design_timer_isr.png"/>
<div class="caption">
Notify ISR Flow chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_034  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2118, MCAL-2117, MCAL-2116, MCAL-2115, MCAL-2113, MCAL-2112   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a> </p><hr/>
<h2><a class="anchor" id="design_gpt_low_level_api_wakeup_isr"></a>
Wakeup ISR</h2>
<p>On elapse of configured count the timer peripheral generates an interrupt. The implementation shall provide an ISR with prototype as “void Gpt_&lt;ChannelNum&gt;Isr (void)” The control flow shall be as depicted in flow chart above, with following exceptions</p>
<ol type="1">
<li>Check for notify &amp; call notify shall not be implemented, instead EcuM_CheckWakeup () shall be called with configured wakeup source</li>
<li>Check for mode and its associated action for true condition shall not be implemented</li>
</ol>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_035  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2111, MCAL-2122, MCAL-1986   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_gpt_low_level_globals"></a>
Global Variables</h2>
<p>This design expects that implementation will require to use following global variables.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Default Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gpt_DrvStatus  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">Initialization status of the driver is maintained  </td><td class="markdownTableBodyNone">FALSE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gpt_DrvObj  </td><td class="markdownTableBodyNone">Gpt_DriverObjType  </td><td class="markdownTableBodyNone">GPT driver object, local to the implementation and scope shall NOT be limited to Gpt.c  </td><td class="markdownTableBodyNone">Un defined   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Gpt_WakeupSourceType  </td><td class="markdownTableBodyNone">EcuM_WakeupSourceType  </td><td class="markdownTableBodyNone">Used to store the WakeupSource Ref value for all configured channels. Local to the driver implementation and scope shall be limited to Gpt.c  </td><td class="markdownTableBodyNone">Un defined   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Gpt_IsrFxn  </td><td class="markdownTableBodyNone">Gpt_IsrRefType  </td><td class="markdownTableBodyNone">Array of pointers to the call notification and wakeup Functions  </td><td class="markdownTableBodyNone">Un defined   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_036  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>SWS_BSW_00130   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_gpt_dar_top"></a>
Decision Analysis &amp; Resolution (DAR)</h1>
<p>Sections below list some of the important design decisions and rational behind those decision.</p>
<h2><a class="anchor" id="design_gpt_dar_reload"></a>
Use of DM Timer Auto-Reload mode for GPT continuous mode</h2>
<p>The timer hardware doesn’t support continuous mode if configured timer count is less than max count of timer (0xFFFFFFFF in 32 bit timer). To implement GPT continuous mode we have to use timer interrupt to trigger timer start or tweak timer configuration during timer start to work in Continuous mode.</p>
<h2><a class="anchor" id="design_gpt_dar_criteria"></a>
DAR Criteria</h2>
<p>Implementation of GPT ‘Continuous’ mode, without timing constraints (or programming registers in ISR)</p>
<h2><a class="anchor" id="design_gpt_dar_alternatives"></a>
Available Alternatives</h2>
<ul>
<li><b> Use GPT count completion interrupt to restart timer. </b> For implementing continuous mode with this count provided to start timer function will be programmed as to match value for interrupt generation and timer will start counting from zero. Once it reaches count value it will generate match interrupt. Same will be used for notification and wake up event. Here driver will check if timer is configured in continuous mode and if yes it will trigger timer enable again.<ul>
<li><b> Advantages: </b><ul>
<li>Simple to implement. No overhead configuration.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Latency between timer interrupt generation and timer restart. This will be major issue as it will vary with Processor speed. Also will not be constant between two timer count completion cycles.</li>
<li>Dependency on ISR for timer restart</li>
</ul>
</li>
</ul>
</li>
<li><b> Use of Timer auto reload mode </b> Device timer HW supports auto-reload mode when timer overflow (max count possible for timer HW reached) occurs. In this case timer HW restarts timer with value loaded in Counter register (CR). To use this feature for GPT continuous mode we need to calculate count value with reference to max count. For example if count value is 0x10 then counter register should be programmed with (0xFFFF_FFFF – 0x10) value. This will ensure timer restarts after counting till overflow.<ul>
<li><b> Advantages: </b><ul>
<li>No dependency on ISR for timer restart. This will be taken care by hardware.</li>
<li>Independent of processor speed.</li>
</ul>
</li>
<li><b> Disadvantages: </b> Complex software implementation as software has to make sure correct value is written and also keep track of count value given by application for timer elapsed and time remaining functions.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="design_gpt_dar_decision"></a>
Decision</h2>
<p>To avoid dependency on processor and interrupt service routine, recommended to use timer hardware auto-reload feature. Software will make sure to return correct values for time elapsed and time remaining functions.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_GPT_037  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-1976, MCAL-1975, MCAL-1973   </td></tr>
</table>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_gpt_test_top"></a>
Test Criteria</h1>
<p>The sections below identify some of the aspects of design that would require emphasis during testing of this design implementation</p>
<ul>
<li><b> State Transitions </b><ul>
<li>Test cases shall exercise all state transitions as detailed in section (<a class="el" href="design_gpt_top.html#design_gpt_desc_dynamic_state">States</a>)</li>
<li>Ensure non supported API’s in a given state, returns valid error code</li>
</ul>
</li>
<li><b> Wake functionality </b><ul>
<li>Test cases shall ensure, wake up functionality is exercised on one channel at least</li>
</ul>
</li>
<li><b> Mode </b><ul>
<li>Test cases shall ensure, a timer shall be operable in all supported modes (but not concurrently, for a single channel)</li>
</ul>
</li>
<li><b> Concurrency </b><ul>
<li>Test cases shall ensure, multiple channels can be operated concurrently</li>
</ul>
</li>
<li><b> Timeout </b><ul>
<li>Test cases exercising Gpt_Start API, as perform equivalence class test on Gpt_ValueType Gpt_Start (). As a large Gpt_ValueType increase test cycle time</li>
<li>Large Gpt_ValueType shall be performed only for “Full Test Cycle”</li>
</ul>
</li>
<li><b> Elapsed / Remaining time </b><ul>
<li>Test cases shall ensure API (when available) GptTimeElapsedApi () is invoked on elapsed timer (one shot mode) and value shall not change</li>
<li>Test cases shall ensure API (when available) GptTimeRemainingApi () is invoked on elapsed timer (one shot mode) and value shall not change</li>
</ul>
</li>
</ul>
<p><a class="el" href="design_gpt_top.html#design_gpt_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_gpt_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">25 July 2018  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending Review   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">01 Oct 2018  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Format conversion and review completed  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.3  </td><td class="markdownTableBodyNone">28 Dec 2018  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Updated section "Development Errors" to include requirement mapping  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.4  </td><td class="markdownTableBodyNone">19 Jan 2020  </td><td class="markdownTableBodyNone">Sunil M S  </td><td class="markdownTableBodyNone">Updates w.r.o porting AUTOSAR 4.3.1 Version  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="design_top.html">MCAL Module Design</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
