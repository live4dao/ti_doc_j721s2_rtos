<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MCUSW Datasheet: Wdg Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW Datasheet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('design_wdg_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Wdg Design Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#design_wdg_intro">Introduction</a><ul><li class="level2"><a href="#design_wdg_intro_overview">Overview</a></li>
<li class="level2"><a href="#design_wdg_wdg_overview">WDG Overview</a></li>
<li class="level2"><a href="#design_wdg_references">References</a></li>
</ul>
</li>
<li class="level1"><a href="#design_wdg_req">Requirements</a><ul><li class="level2"><a href="#design_wdg_features_supported">Features Supported</a></li>
<li class="level2"><a href="#design_wdg_features_not_supported">Features Not Supported / NON Compliance</a></li>
<li class="level2"><a href="#design_wdg_key_notes">Key Notes</a></li>
<li class="level2"><a href="#design_wdg_assumptions">Assumptions</a></li>
<li class="level2"><a href="#design_wdg_constraints">Constraints</a></li>
</ul>
</li>
<li class="level1"><a href="#design_wdg_description">Design Description</a><ul><li class="level2"><a href="#design_wdg_desc_funda">Fundamental Operation</a></li>
<li class="level2"><a href="#design_wdg_desc_Sequence">WDG Configuration Sequence</a></li>
<li class="level2"><a href="#design_wdg_desc_dynamic">Dynamic Behavior</a><ul><li class="level3"><a href="#design_wdg_desc_dynamic_state">States</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_desc_deter_dir">Directory Structure</a></li>
<li class="level2"><a href="#design_wdg_desc_cfg">Configurator</a><ul><li class="level3"><a href="#design_wdg_desc_cfg_ti">NON Standard configurable parameters</a></li>
<li class="level3"><a href="#design_wdg_desc_cfg_ti_compute">Implementation specific parameters (computed)</a></li>
<li class="level3"><a href="#design_wdg_desc_cfg_variant">Variant Support</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_desc_cfg_dependency">Dependency on other modules</a><ul><li class="level3"><a href="#design_wdg_desc_cfg_dependency_sbl">SBL</a></li>
<li class="level3"><a href="#design_wdg_desc_cfg_dependency_esm">ESM</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_desc_dbg">Debug Information</a></li>
<li class="level2"><a href="#design_wdg_desc_error">Error Classification</a><ul><li class="level3"><a href="#design_wdg_desc_error_dev">Development Errors</a></li>
<li class="level3"><a href="#design_wdg_desc_error_dev_detect">Error Detection</a></li>
<li class="level3"><a href="#design_wdg_desc_error_dev_notify">Error notification (DET)</a></li>
<li class="level3"><a href="#design_wdg_desc_error_runtime">Runtime Errors</a></li>
<li class="level3"><a href="#design_wdg_desc_error_dev_notify_dem">Error notification (DEM)</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_desc_res_behave">Resource Behavior</a></li>
<li class="level2"><a href="#design_wdg_desc_upgrade_431">Supporting WDG for AUTOSAR versioned 4.3.1</a></li>
</ul>
</li>
<li class="level1"><a href="#design_wdg_low_level">Low Level Definitions</a><ul><li class="level2"><a href="#design_wdg_low_level_dtypes">MACROS, Data Types &amp; Structures</a><ul><li class="level3"><a href="#design_wdg_low_level_modeinfo_cfg">Wdg_ModeInfoType</a></li>
<li class="level3"><a href="#design_wdg_low_level_cfg">Wdg_ConfigType</a></li>
<li class="level3"><a href="#design_wdg_low_level_readback_type">Wdg_RegisterReadbackType</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_low_level_api">API&#39;s</a><ul><li class="level3"><a href="#design_wdg_low_level_api_init">Wdg_Init</a></li>
<li class="level3"><a href="#design_wdg_low_level_api_settriggercondition">Wdg_SetTriggerCondition</a></li>
<li class="level3"><a href="#design_wdg_low_level_api_getversioninfo">Wdg_GetVersionInfo</a></li>
<li class="level3"><a href="#design_wdg_low_level_api_trigger">Wdg_Trigger</a></li>
<li class="level3"><a href="#design_wdg_low_level_api_rb">Wdg_RegisterReadback</a></li>
</ul>
</li>
<li class="level2"><a href="#design_wdg_low_level_globals">Global Variables</a></li>
</ul>
</li>
<li class="level1"><a href="#design_wdg_dar_top">Decision Analysis &amp; Resolution (DAR)</a><ul><li class="level2"><a href="#design_wdg_dar_reset_functionality">Watchdog SOC Reset Functionality</a></li>
<li class="level2"><a href="#design_wdg_dar_criteria_reset_output">DAR Criteria</a></li>
<li class="level2"><a href="#design_wdg_dar_alternatives_reset_output">Available Alternatives</a></li>
<li class="level2"><a href="#design_wdg_dar_decision_reset_output">Decision</a></li>
<li class="level2"><a href="#design_wdg_dar_service_routine">Watchdog Service Routine</a></li>
<li class="level2"><a href="#design_wdg_dar_criteria_service_routine">DAR Criteria</a></li>
<li class="level2"><a href="#design_wdg_dar_alternatives_service_routine">Available Alternatives</a></li>
<li class="level2"><a href="#design_wdg_dar_decision_service_routine">Decision</a></li>
</ul>
</li>
<li class="level1"><a href="#design_wdg_test_top">Test Criteria</a></li>
<li class="level1"><a href="#design_wdg_rev_hist">Document Revision History</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="design_wdg_intro"></a>
Introduction</h1>
<hr/>
<h2><a class="anchor" id="design_wdg_intro_overview"></a>
Overview</h2>
<p>The figure below depicts the AUTOSAR layered architecture as 3 distinct layers, Application, Runtime Environment (RTE) and Basic Software (BSW). The BSW is further divided into 4 layers, Services, Electronic Control Unit Abstraction, MicroController Abstraction (MCAL) and Complex Drivers.</p>
<div class="image">
<img src="autosar_acrhitecture_common.png" alt="autosar_acrhitecture_common.png"/>
<div class="caption">
AUTOSAR Architecture</div></div>
<p> MCAL is the lowest abstraction layer of the Basic Software. It contains software modules that interact with the Microcontroller and its internal peripherals directly. Wdg driver is part of the Microcontroller Drivers (block, shown above). Below shows the position of the Wdg driver in the AUTOSAR Architecture.</p>
<div class="image">
<img src="autosar_acrhitecture_wdg.png" alt="autosar_acrhitecture_wdg.png"/>
<div class="caption">
AUTOSAR Architecture – WDG MCAL</div></div>
 <hr/>
 <h2><a class="anchor" id="design_wdg_wdg_overview"></a>
WDG Overview</h2>
<p>RTI(Real Time Interrupt) module supports three functional modes Counter mode, Capture mode &amp; Windowed watchdog timer mode. Only Windowed watchdog timer mode is used to meet AUTOSAR WDG requirements.</p>
<p>The digital windowed watchdog generates an interrupt after a programmable period, if trigger is not serviced in the allowed time frame. TDA4x, DRA80x class of devices supports windowed watchdog timer where key can be only written in the configured window programmed through software. The watchdog opens a configurable time window in which it must be serviced. Any attempt to service the watchdog outside this time window, or a failure to service the watchdog in this time window, will cause the watchdog to generate a NMI interrupt.</p>
<p>Refer section (<a class="el" href="design_wdg_top.html#design_wdg_references">References</a>) for more details on watchdog operation.</p>
<hr/>
 <h2><a class="anchor" id="design_wdg_references"></a>
References</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.2.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for WDG Driver <a href="http://www-open.india.ti.com/~pspcm/data_pspdocs/PDP/MCAL/Documents/Autosar/V4.2/SW_Architecture_Peripherals/Standard_Specifications/AUTOSAR_SWS_WatchdogDriver.pdf">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">DRA80x and TDA4x TRM  </td><td class="markdownTableBodyNone">Technical Reference Manual, <a href="http://www.ti.com/product/DRA80M/technicaldocuments">DRA80X</a>, <a href="http://www.ti.com/product/TDA4VM/technicaldocuments">TDA4X</a> Watchdog modules is detailed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">BSW General Requirements / Coding guidelines  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/Coding+Guidelines">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Software Product Specification (SPS)  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/MCUSW+Software+Product+Specification">Intranet Link</a> Requirements are derived from <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>   </td></tr>
</table>
<hr/>
 <h1><a class="anchor" id="design_wdg_req"></a>
Requirements</h1>
<p>The Wdg driver shall implement as per requirements detailed in <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>, <a class="el" href="design_wdg_top.html#design_wdg_references">3</a> and <a class="el" href="design_wdg_top.html#design_wdg_references">4</a>. It’s recommended to refer <a class="el" href="design_wdg_top.html#design_wdg_references">1</a> for clarification.</p>
<hr/>
 <h2><a class="anchor" id="design_wdg_features_supported"></a>
Features Supported</h2>
<p>Below listed are some of the key features that are supported</p>
<ul>
<li>Initialization and configuration of WDG (configure window size, timeout value etc.)</li>
<li>Setting default mode(FAST/SLOW)</li>
<li>Service trigger via Wdg_Trigger API if called within the allowed time window.</li>
<li>Supports all instances of RTI present in MCU domain.</li>
<li>Supports additional configuration parameters, refer section (<a class="el" href="design_wdg_top.html#design_wdg_desc_cfg_ti_compute">Implementation specific parameters (computed)</a>) &amp; (<a class="el" href="design_wdg_top.html#design_wdg_low_level_api_rb">Wdg_RegisterReadback</a>)</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_001   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-955, MCAL-920, MCAL-921, MCAL-922, MCAL-923, MCAL-925, MCAL-929, MCAL-930, MCAL-932, MCAL-933, MCAL-937, MCAL-938, MCAL-939, MCAL-942, MCAL-947, MCAL-980, MCAL-945, MCAL-1056, MCAL-2572   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <div class="image">
<img src="caution.png" alt="caution.png"/>
</div>
 <h2><a class="anchor" id="design_wdg_features_not_supported"></a>
Features Not Supported / NON Compliance</h2>
<ul>
<li><b>[NON Compliance]</b> Wdg_SetMode API is not supported. Due to hardware limitations, Mode and Timeout can’t be modified if watchdog is already running i.e only during initialization Mode and Timeout can be set.</li>
<li>OFF-Mode is not supported.</li>
<li>External Wdg driver : This driver is an internal, belongs to the Microcontroller Abstraction Layer whereas external watchdog driver belongs to the Onboard Device Abstraction Layer. So requirements w.r.o external watchdog are not implemented.</li>
<li>Standard AUTOSAR WDG specification <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>, categorizes few BSW General Requirements as non-requirements, please refer MCAL-2634 for details</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_002   </td></tr>
<tr>
<td><em><b>Non Requirements</b></em> </td><td>MCAL-2566, MCAL-2568, MCAL-2570, MCAL-2574, MCAL-2583, MCAL-2584, MCAL-2585, MCAL-2586, MCAL-2588, MCAL-2599, MCAL-2600, MCAL-2611, MCAL-2612, MCAL-2613, MCAL-2614, MCAL-2615, MCAL-2616, MCAL-2617, MCAL-2618, MCAL-2619, MCAL-2620, MCAL-2621, MCAL-2634   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_wdg_key_notes"></a>
Key Notes</h2>
<ol type="1">
<li>The trigger API Wdg_Trigger is non re-entrant as trigger API is expected to be called in only one thread context.</li>
<li>The user has to take into account that the write to the RTIWDKEY register takes 3 RTI Interface CLK cycles. This needs to be considered for the WDG expiration calculation.</li>
<li>If start time defined by the windowed watchdog configuration has been violated also causes interrupt. Start time violation indicates that the WDG is serviced before the service window was opened. Please refer (<a class="el" href="design_wdg_top.html#design_wdg_desc_funda">Fundamental Operation</a>) and TRM, item 2 of (<a class="el" href="design_wdg_top.html#design_wdg_references">References</a>) for more details.</li>
</ol>
<hr/>
 <h2><a class="anchor" id="design_wdg_assumptions"></a>
Assumptions</h2>
<p>Below listed are assumed to be valid for this design/implementation, exceptions and other deviations are listed for each explicitly. Care should be taken to ensure these assumptions are addressed.</p>
<ol type="1">
<li>The functional clock to the WDG module is expected to be enabled before calling any WDG module API.</li>
<li>The WDG driver as such doesn’t perform any PRCM programming to get the functional clock.</li>
<li><b> The clock-source selection for WDG is not performed by the WDG driver, other entities such as SBL, MCAL module MCU shall perform the same. </b></li>
<li><b> Assumed that only one of the RTI instance is initiated per core at which driver is running. </b></li>
</ol>
<p>Note that assumption 1 and 2 are specified by AUTOSAR WDG specification and 3 and 4 are device specific assumption.</p>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_wdg_constraints"></a>
Constraints</h2>
<p>Some of the critical constraints of this design are listed below</p>
<ul>
<li>In case where MCU module is not employed (supported) to configure the clock source for WDG module, refer <a class="el" href="design_wdg_top.html#design_wdg_assumptions">Assumptions</a> sub-item 3. Clock sources are listed in TRM refer sub-item 2 (<a class="el" href="design_wdg_top.html#design_wdg_references">References</a>).</li>
<li>Also refer section features not supported. (<a class="el" href="design_wdg_top.html#design_wdg_features_not_supported">Features Not Supported / NON Compliance</a>)</li>
</ul>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h1><a class="anchor" id="design_wdg_description"></a>
Design Description</h1>
<hr/>
 <h2><a class="anchor" id="design_wdg_desc_funda"></a>
Fundamental Operation</h2>
<p>The Digital Watchdog Timer(DWT) generates reset after a programmable period, if not serviced within that period. In DWT, time-out boundary is configurable.In DWWD, along with configurable time-out boundary, the start time boundary is also configurable. The DWWD can generate Reset or Interrupt, if not serviced within window(Open Window) defined by start time and time-out boundary. Also the DWWD can generate Reset or Interrupt if serviced outside Open Window (i.e within Closed Window). Generation of Reset or Interrupt depends on the DWWD Reaction configuration. </p><pre class="fragment">    DWWD Down Counter Overview :
    Upper 12 bit part of the down counter is configurable and
    remaining 13 bit are always 1.
    Minimum possible time-out value is 2^13 RTI clock cycles.
    Maximum possible time-out value is 2^25 RTI clock cycles.
    Example :
    The expiration time of the DWD Down Counter can be determined with following equation:
    texp= (RTI_DWDPRLD + 1) x 2^13 / RTI_FCLK
    where RTI_DWDPRLD(12 bit) = 0...4095 and RTI_FCLK is RTI functional frequency.
    RTI_FCLK : 32kHz
    12 bit preload value : 0x004
    25 bit preload value : 0x0009FFF
    time-out value(in RTI clock cycles) : 40959.
    time-out value(in seconds) : (40959 + 1) / 32000 = 1.28 seconds.

     DWWD Window Sizes Overview :
     (timeout value),(timeout value - 1),(timeout value - 2),........................3 2 1 0
   (100%)|___________________________Open Window_________________________|
    (50%)|         Closed Window         |_________________Open Window__ |
    (25%)|            Closed Window                        |___OW________|
  (12.5%)|                 Closed Window                          |__OW__|
  (6.25%)|                     Closed Window                        |_OW_|
 (3.125%)|                         Closed Window                      |OW|
</pre><h2><a class="anchor" id="design_wdg_desc_Sequence"></a>
WDG Configuration Sequence</h2>
<div class="image">
<img src="wdg_design_driver_configuration_sequence.png" alt="wdg_design_driver_configuration_sequence.png"/>
<div class="caption">
WatchDog Timer Configuration Sequence</div></div>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_wdg_desc_dynamic"></a>
Dynamic Behavior</h2>
<h3><a class="anchor" id="design_wdg_desc_dynamic_state"></a>
States</h3>
<p>As detailed in specification of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>, Driver will be in one of the following states.</p><ul>
<li>WDG_UNINIT : Default state indicating a non-initialized module.</li>
<li>WDG_IDLE : Indicating initialization is successful.</li>
<li>WDG_BUSY : Indicating module is busy(during execution).</li>
</ul>
<div class="image">
<img src="wdg_design_driver_state.png" alt="wdg_design_driver_state.png"/>
<div class="caption">
Driver States</div></div>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_desc_deter_dir"></a>
Directory Structure</h2>
<p>The directory structure is as depicted in figures below, the source files can be categorized under “Driver Implementation” and “Example Application”</p>
<p><b>Driver Implemented by </b></p><ul>
<li><a class="el" href="Wdg_8h.html" title="This file contains interface header for WDG MCAL driver. ">Wdg.h</a> and Wdg_Priv.h: Shall implement the interface provided by the AUTOSAR</li>
<li>Wdg_Priv.c and Wdg_Priv.h: Shall implement the driver functionality</li>
<li><a class="el" href="Wdg__Dbg_8h.html" title="This file contains debug variable declaration for WDG MCAL driver. ">Wdg_Dbg.h</a>: Shall contain debug variable declarations of the driver.</li>
</ul>
<p><b>Example Application</b></p><ul>
<li><a class="el" href="Wdg__Cfg_8h.html" title="This file contains generated pre compile configuration file for WDG MCAL driver. ">Wdg_Cfg.h</a> and Wdg_Cfg.c: Shall implement the generated configuration for pre-compile variant</li>
<li>Wdg_Lcfg.c: Shall implement the generated configuration for link-time variant</li>
<li>Wdg_PBcfg.c: Shall implement the generated configuration for post-build variant</li>
<li>WdgApp.c and WdgApp.h: Shall implement the example application that demonstrates the use of the driver</li>
</ul>
<div class="image">
<img src="wdg_design_dir.png" alt="wdg_design_dir.png"/>
<div class="caption">
Directory Structure</div></div>
 <div class="image">
<img src="wdg_design_dir_detailed.png" alt="wdg_design_dir_detailed.png"/>
<div class="caption">
Detailed Directory Structure</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_003   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2567, MCAL-2569   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_desc_cfg"></a>
Configurator</h2>
<p>The AUTOSAR WDG Driver Specification details mandatory parameters that shall be configurable via the configurator. Please refer section 10 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_004   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2544, MCAL-2545, MCAL-2546, MCAL-2547, MCAL-2548, MCAL-2549, MCAL-2550, MCAL-2552, MCAL-2553, MCAL-2554, MCAL-2555, MCAL-2556, MCAL-2558, MCAL-2559, MCAL-2560, MCAL-2561, MCAL-2562, MCAL-2563, MCAL-2564, MCAL-2565, MCAL-2557, MCAL-2551, MCAL-2571   </td></tr>
</table>
<hr/>
 <h3><a class="anchor" id="design_wdg_desc_cfg_ti"></a>
NON Standard configurable parameters</h3>
<p>Following lists this design’s specific configurable parameters</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Usage comment -&mdash;   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WdgReaction  </td><td class="markdownTableBodyNone">Watchdog reaction for timer expiration or incorrect service.0x5 = This is the default value. The windowed watchdog will cause a reset if the watchdog is serviced outside the time window defined by the configuration, or if the watchdog is not serviced at all. 0xA = The windowed watchdog will generate a non-maskable interrupt to the CPU if the watchdog is serviced outside the time window defined by the configuration, or if the watchdog is not serviced at all. Writing any other value will cause a system reset if the watchdog is serviced outside the time window.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">WdgWindowSize  </td><td class="markdownTableBodyNone">Digital Windowed Watchdog Window Size. Selecting 100% enables standard watchdog (not windowed). WWDSIZE: 0x00000050 = 50%, WWDSIZE: 0x00000500 = 25%, WWDSIZE: 0x00005000 = 12.5%, WWDSIZE: 0x00050000 = 6.25%, WWDSIZE: 0x00500000 = 3.125%, WWDSIZE: Any other value = 3.125%   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WdgTimeoutValue  </td><td class="markdownTableBodyNone">Watchdog timeout period in milli seconds.Watchdog generates a non-maskable interrupt to the CPU if the watchdog is serviced after this timeout period.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">WdgDeviceVariant  </td><td class="markdownTableBodyNone">Select SOC (DRA80X) variant.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WdgInstanceId  </td><td class="markdownTableBodyNone">Selects Watchdog HW instance id.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">WdgRtiFrequency  </td><td class="markdownTableBodyNone">RTI Clock Frequency (Hz) used to calculate preload value during init time.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WdgRegisterReadbackApi  </td><td class="markdownTableBodyNone">Compile switch to enable / disable the Critical Registers Readback API   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_desc_cfg_ti_compute"></a>
Implementation specific parameters (computed)</h3>
<h3><a class="anchor" id="design_wdg_desc_cfg_variant"></a>
Variant Support</h3>
<p>The driver shall support all variants VARIANT-PRE-COMPILE, VARIANT-LINK-TIME and VARIANT-POST-BUILD</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_005   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2635, MCAL-2636, MCAL-2637, MCAL-2638, MCAL-2639, MCAL-2640, MCAL-2642, MCAL-2631, MCAL-2632, MCAL-2633   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_desc_cfg_dependency"></a>
Dependency on other modules</h2>
<p>In addition to dependencies listed in section 5 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>, WDG driver shall depend on these modules to meet the required functionality. WDG uses RTI module present in the device to meet the required functionality.</p>
<p>This peripheral also requires 2 different clock to be operational, namely ICLK and FCLK. </p>
<h3><a class="anchor" id="design_wdg_desc_cfg_dependency_sbl"></a>
SBL</h3>
<ul>
<li><b>ICLK</b>: Is interface clock required for internal read/write registers of the peripheral. This is not expected to change and typically programmed by SBL, please refer the device specific manual for details and valid value.</li>
<li><b>FCLK</b>: Is functional clock, used to operate the module. As detailed in section (<a class="el" href="design_wdg_top.html#design_wdg_constraints">Constraints</a>), other entity would require to select the right clock source for the peripheral.</li>
</ul>
<h3><a class="anchor" id="design_wdg_desc_cfg_dependency_esm"></a>
ESM</h3>
<p>There is no direct reset signal generation from watchdog when it expires instead it generates an ESM interrupt. ESM module will signal ESM pin error and then external controller resets the SOC.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_006   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2651, MCAL-2653   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_desc_dbg"></a>
Debug Information</h2>
<p>The internal driver state and the watchdog timeout counter value of WDG shall be visible to applications. This is achieved by</p><ul>
<li>Defining a header file <a class="el" href="Wdg__Dbg_8h.html" title="This file contains debug variable declaration for WDG MCAL driver. ">Wdg_Dbg.h</a>, as depicted in (<a class="el" href="design_wdg_top.html#design_wdg_desc_deter_dir">Directory Structure</a>) <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_007   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2597, MCAL-2598   </td></tr>
</table>
</li>
</ul>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_desc_error"></a>
Error Classification</h2>
<p>Errors are classified in two categories, development error and runtime / production error.</p>
<hr/>
 <h3><a class="anchor" id="design_wdg_desc_error_dev"></a>
Development Errors</h3>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>API service used in wrong context (e.g. module not initialized).  </td><td>WDG_E_DRIVER_STATE  </td><td>0x10   </td></tr>
<tr>
<td>API service called with wrong / inconsistent parameter(s)  </td><td>WDG_E_PARAM_MODE  </td><td>0x11   </td></tr>
<tr>
<td>API service called with wrong / inconsistent parameter(s)  </td><td>WDG_E_PARAM_CONFIG  </td><td>0x12   </td></tr>
<tr>
<td>The passed timeout value is higher than the maximum timeout value  </td><td>WDG_E_PARAM_TIMEOUT  </td><td>0x13   </td></tr>
<tr>
<td>API is called with wrong pointer value (e.g. NULL pointer)  </td><td>WDG_E_PARAM_POINTER  </td><td>0x14   </td></tr>
<tr>
<td>Invalid configuration set selection  </td><td>WDG_E_INIT_FAILED  </td><td>0x15   </td></tr>
</table>
<h3><a class="anchor" id="design_wdg_desc_error_dev_detect"></a>
Error Detection</h3>
<p>The detection of development errors is configurable (ON / OFF) at pre-compile time. The switch WdgDevErrorDetect will enable or disable the detection of all development errors.</p>
<h3><a class="anchor" id="design_wdg_desc_error_dev_notify"></a>
Error notification (DET)</h3>
<p>All detected development errors are reported via Det_ReportError service of the Development Error Tracer (DET).</p>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_desc_error_runtime"></a>
Runtime Errors</h3>
<p>The following runtime/production errors shall be detectable by Wdg driver.</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>Setting a watchdog mode failed (during initialization or mode switch).  </td><td>WDG_E_MODE_FAILED  </td><td>Defined By Integrator   </td></tr>
<tr>
<td>Initialization or watchdog mode switch failed because it would disable the watchdog though this is not allowed in this configuration  </td><td>WDG_E_DISABLE_REJECTED  </td><td>Defined By Integrator   </td></tr>
</table>
<h3><a class="anchor" id="design_wdg_desc_error_dev_notify_dem"></a>
Error notification (DEM)</h3>
<p>All detected run time errors shall be reported via Dem_ReportErrorStatus() service of the Diagnostic Event Manager (DEM).</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_008   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2630, MCAL-2576, MCAL-2577, MCAL-2578, MCAL-2579, MCAL-2580, MCAL-2581, MCAL-2582   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
<h2><a class="anchor" id="design_wdg_desc_res_behave"></a>
Resource Behavior</h2>
<ul>
<li><b> Code Size </b>: WDG Implmentation shall not consume more than 30 Kilobytes for .text section and 2Kilobytes for .const section.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_009   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2645   </td></tr>
</table>
<ul>
<li><b> Stack Size </b>: WDG Service AP'sI shall not consume more than 2 kilo-bytes of stack memory.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_010   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2646   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
<h2><a class="anchor" id="design_wdg_desc_upgrade_431"></a>
Supporting WDG for AUTOSAR versioned 4.3.1</h2>
<p>This WDG design is based on the requirements specification for AUTOSAR versioned 4.2.1 and sections below highlight some of the critical changes that would be required between these two versions.</p>
<p>Note that this design doesn’t comprehend or account for other versions of AUTOSAR.</p>
<h3>Removed</h3>
<ul>
<li>The design detailed in <a class="el" href="design_wdg_top.html#design_wdg_desc_dbg">Debug</a> shall not be implemented. Also, note that <a class="el" href="design_wdg_top.html#design_wdg_desc_deter_dir">Directory structure</a> would require an update. (Remove <a class="el" href="Wdg__Dbg_8h.html" title="This file contains debug variable declaration for WDG MCAL driver. ">Wdg_Dbg.h</a>)</li>
<li>Removed requirements MCAL-2631, MCAL-2632 and MCAL-2633 and merged these into MCAL-2544. Apart from requirements mapping there is no code change required.</li>
</ul>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
<h1><a class="anchor" id="design_wdg_low_level"></a>
Low Level Definitions</h1>
<hr/>
<p> The detailed API and interface description is available as part of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a> &amp; <a class="el" href="design_wdg_top.html#design_wdg_references">4</a>. This section describes the API supported by the MCAL driver and the requirements covered by each of the API.</p>
<h2><a class="anchor" id="design_wdg_low_level_dtypes"></a>
MACROS, Data Types &amp; Structures</h2>
<p>The sections below lists some of key data structures that shall be implemented and used in driver implementation</p>
<hr/>
<h3><a class="anchor" id="design_wdg_low_level_modeinfo_cfg"></a>
Wdg_ModeInfoType</h3>
<p>Used to define watchdog hardware specific parameters per instance and the values of these are expected to be populated by configurator.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">reaction  </td><td class="markdownTableBodyNone">Reaction type: 0x5 - This value causes a reset if the watchdog is serviced outside the time window defined by the configuration, or if the watchdog is not serviced at all. 0xA - The windowed watchdog will generate a non-maskable interrupt to the CPU if the watchdog is serviced outside the time window defined by the configuration, or if the watchdog is not serviced at all.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">windowSize  </td><td class="markdownTableBodyNone">Digital Windowed Watchdog Window Size. Selecting 100% enables standard watchdog (not windowed). WWDSIZE: 0x00000050 = 50%, WWDSIZE: 0x00000500 = 25%, WWDSIZE: 0x00005000 = 12.5%, WWDSIZE: 0x00050000 = 6.25%, WWDSIZE: 0x00500000 = 3.125%, WWDSIZE: Any other value = 3.125%   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">timeOutVal  </td><td class="markdownTableBodyNone">Watchdog timeout period in milli seconds.Watchdog generates a non-maskable interrupt or reset to the CPU if the watchdog is serviced after this timeout period.   </td></tr>
</table>
<hr/>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_011   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2601, MCAL-2635, MCAL-2636, MCAL-2637   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_low_level_cfg"></a>
Wdg_ConfigType</h3>
<p>Refer section 8.2.1 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a> Used for pointers to structures holding configuration data provided to the Wdg module initialization routine for configuration of the module and watchdog hardware.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">WdgIf_ModeType  </td><td class="markdownTableBodyNone">defaultMode  </td><td class="markdownTableBodyNone">Default watchdog mode(WDGIF_FAST_MODE/WDGIF_SLOW_MODE)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="structWdg__ModeInfoType.html" title="Mode info type. ">Wdg_ModeInfoType</a>  </td><td class="markdownTableBodyNone">fastModeCfg  </td><td class="markdownTableBodyNone">Contains fast mode hardware specific configuration.(<a class="el" href="design_wdg_top.html#design_wdg_low_level_modeinfo_cfg">Wdg_ModeInfoType</a>)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structWdg__ModeInfoType.html" title="Mode info type. ">Wdg_ModeInfoType</a>  </td><td class="markdownTableBodyNone">slowModeCfg  </td><td class="markdownTableBodyNone">Contains slow mode hardware specific configuration.(<a class="el" href="design_wdg_top.html#design_wdg_low_level_modeinfo_cfg">Wdg_ModeInfoType</a>)   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_012   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2602   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="el" href="structWdg__ConfigType__PC.html" title="WDG pre-compile config structure. ">Wdg_ConfigType_PC</a></h3>
<p>Used to define Pre-Compile parameters populated by configurator.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Variable Name  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16  </td><td class="markdownTableBodyNone">instanceId  </td><td class="markdownTableBodyNone">Hardware Instance Id   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">initialTimeOut  </td><td class="markdownTableBodyNone">The initial timeout (seconds) for the trigger condition to be initialized during Init function. It shall be not larger than WdgMaxTimeout.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_013   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2639, MCAL-2552   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_wdg_low_level_readback_type"></a>
Wdg_RegisterReadbackType</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Range  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rtiDwdCtrl  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Watchdog Control, To Enable DWD   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">rtiDwdprld  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Watchdog Preload Value   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rtiWdStatus  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Watchdog Status Register   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">rtiWdKey  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Watchdog Key Register   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">rtiWwdRxnCtrl  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Windowed Watchdog Reaction   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">rtiWwdSizeCtrl  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">0 to 0xFFFFFFFF  </td><td class="markdownTableBodyNone">Digital Windowed Watchdog Window Size   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_wdg_low_level_api"></a>
API's</h2>
<p>For the standard API's please refer 8.3 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>. Sections below also highlight other design considerations for the implementation.</p>
<hr/>
 <h3><a class="anchor" id="design_wdg_low_level_api_init"></a>
Wdg_Init</h3>
<p>Refer section 8.3.1 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_014   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2603, MCAL-2604, MCAL-2605, MCAL-2606, MCAL-2607 MCAL-2608, MCAL-2609, MCAL-2610   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_wdg_low_level_api_settriggercondition"></a>
Wdg_SetTriggerCondition</h3>
<p>Refer section 8.3.3 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_015   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2622, MCAL-2623, MCAL-2624, MCAL-2625, MCAL-2626, MCAL-2627   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_low_level_api_getversioninfo"></a>
Wdg_GetVersionInfo</h3>
<p>Refer section 8.3.4 of <a class="el" href="design_wdg_top.html#design_wdg_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_016   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2628, MCAL-2629   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_low_level_api_trigger"></a>
Wdg_Trigger</h3>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_017   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2593, MCAL-2587, MCAL-2589, MCAL-2590, MCAL-2591, MCAL-2592, MCAL-2594, MCAL-2595, MCAL-2596, MCAL-2644, MCAL-2647, MCAL-2573, MCAL-2575   </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Wdg_Trigger  </td></tr>
<tr>
<td><em><b>Description</b></em> </td><td>Trigger routine which should be called by application periodically   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>void <a class="el" href="group__MCAL__WDG__API.html#ga0f9af1b4d2a64f12655ae56d45ba33d6" title="This function triggers the servicing of the watchdog. ">Wdg_Trigger(void)</a>   </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>0x05  </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_wdg_low_level_api_rb"></a>
Wdg_RegisterReadback</h3>
<p>As noted from previous implementation, the wdg configuration registers could be potentially corrupted by other entities (s/w or h/w). One of the recommended detection methods would be to periodically read-back the configuration and confirm configuration is consistent. The service API defined below shall be implemented to enable this detection. Constraint: Should be called only after module initialization</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Wdg_RegisterReadback </td><td>Can potentially be turned OFF  </td></tr>
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_018  </td><td></td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2643  </td><td></td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>Std_ReturnType Wdg_RegisterReadback(P2VAR(<a class="el" href="structWdg__RegisterReadbackType.html">Wdg_RegisterReadbackType</a>, AUTOMATIC, WDG_APPL_DATA) regRbPtr)  </td><td><a class="el" href="structWdg__RegisterReadbackType.html">Wdg_RegisterReadbackType</a> defines the type, that holds critical values, refer below  </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>0x06 </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Non Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>None </td><td>None  </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>regRbPtr </td><td>A pointer of type <a class="el" href="structWdg__RegisterReadbackType.html">Wdg_RegisterReadbackType</a>, which holds the read back values   </td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Standard return type </td><td>E_OK or E_NOT_OK in case of DET error  </td></tr>
</table>
<p>The critical register listed is a recommendation and implementation shall determine appropriate registers.</p>
<p>This service could potentially be turned OFF in the configurator.</p>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_wdg_low_level_globals"></a>
Global Variables</h2>
<p>This design expects that implementation require to use following global variables.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Default Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Wdg_DrvStatus  </td><td class="markdownTableBodyNone">Wdg_StatusType  </td><td class="markdownTableBodyNone">Initialization status of the driver is maintained  </td><td class="markdownTableBodyNone">WDG_UNINIT   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Wdg_DrvObj  </td><td class="markdownTableBodyNone">Wdg_DriverObjType  </td><td class="markdownTableBodyNone">WDG driver object, local to the implementation and scope shall NOT be limited to Wdg.c  </td><td class="markdownTableBodyNone">Undefined   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_WDG_019   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>SWS_BSW_00130   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_wdg_dar_top"></a>
Decision Analysis &amp; Resolution (DAR)</h1>
<p>Sections below list some of the important design decisions and rationale behind those decision.</p>
<h2><a class="anchor" id="design_wdg_dar_reset_functionality"></a>
Watchdog SOC Reset Functionality</h2>
<p>The watchdog hardware generates a violation interrupt or ESM interrupt after a programmable period, if no correct key sequence is written to the RTI watchdog key register.</p>
<h2><a class="anchor" id="design_wdg_dar_criteria_reset_output"></a>
DAR Criteria</h2>
<p>Guarantee reset on watchdog expiry and minimal software load on CPU.</p>
<h2><a class="anchor" id="design_wdg_dar_alternatives_reset_output"></a>
Available Alternatives</h2>
<ul>
<li><b> CPU Interrupt Mode. </b> RTI expires (AUTOSAR Core) -&gt; R5F Interrupt -&gt; Safety R5F -&gt; DMSC -&gt; Reset Core<ul>
<li><b> Advantages: </b><ul>
<li>Simple to implement.</li>
<li>No dependency on external modules</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>If CPU is not able to execute the ISR(eg DDR,OCMC Failure) reset may not occur.</li>
</ul>
</li>
</ul>
</li>
<li><b> ESM Interrupt Mode </b> RTI expires (AUTOSAR Core) -&gt; ESM Interrupt -&gt; ESM pin Error -&gt; External controller resets the whole SoC<ul>
<li><b> Advantages: </b><ul>
<li>No overhead to CPU.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Dependency on external module to reset the core.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="design_wdg_dar_decision_reset_output"></a>
Decision</h2>
<p>Recommended to use ESM interrupt mode. ESM will make sure to signal the severe device failure if interrupt occurs.</p>
<h2><a class="anchor" id="design_wdg_dar_service_routine"></a>
Watchdog Service Routine</h2>
<p>The routine servicing a watchdog shall be implemented as an interrupt routine driven by a hardware timer/GPT.Refer SWS_Wdg_00166 AUTOSAR WDG specification <a class="el" href="design_wdg_top.html#design_wdg_references">1</a>.</p>
<h2><a class="anchor" id="design_wdg_dar_criteria_service_routine"></a>
DAR Criteria</h2>
<p>There should be no dependency on external module.</p>
<h2><a class="anchor" id="design_wdg_dar_alternatives_service_routine"></a>
Available Alternatives</h2>
<ul>
<li><b> Driven by Hardware Timer. </b><ul>
<li><b> Advantages: </b><ul>
<li>Guarantees timing constraints required for windowed watchdog conditions.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Dependency on external module.</li>
</ul>
</li>
</ul>
</li>
<li><b> Driven by Application Periodically </b><ul>
<li><b> Advantages: </b><ul>
<li>No dependency on external module.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Application need to take care of the latency by calling service API within the time window.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="design_wdg_dar_decision_service_routine"></a>
Decision</h2>
<p>To avoid dependency on the external module Wdg_Trigger API is provided which should be called by application periodically.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID </b></em> </td><td>DES_WDG_020   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2651, MCAL-2652, MCAL-2653   </td></tr>
</table>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_wdg_test_top"></a>
Test Criteria</h1>
<p>The sections below identify some of the aspects of design that would require emphasis during testing of this design implementation</p>
<ul>
<li><b> Timeout </b><ul>
<li>Test cases shall ensure watchdog generates ESM interrupts and thereby reset occurs for the configured timeout value.</li>
<li>Also test with different set of timeout values(Equivalence partition test).</li>
</ul>
</li>
<li><b> State Transitions </b><ul>
<li>Test cases shall exercise all state transitions as detailed in section (<a class="el" href="design_wdg_top.html#design_wdg_desc_dynamic_state">States</a>)</li>
</ul>
</li>
<li><b> Modes </b><ul>
<li>Test cases shall ensure watchdog support both fast/slow modes.</li>
</ul>
</li>
<li><b> Trigger Condition </b><ul>
<li>Test cases shall ensure driver test with different set of trigger condition timeout values(Equivalence partition test).</li>
</ul>
</li>
<li><b> Window Sizes </b><ul>
<li>Test cases shall ensure watchdog operation test with all window sizes that hardware supports.</li>
</ul>
</li>
<li><b> Window Violation Test </b><ul>
<li>Test cases shall ensure watchdog start time violation test.</li>
</ul>
</li>
<li><b> Test for all instances </b><ul>
<li>Test cases shall ensure watchdog operation for all the RTI instances supported.</li>
</ul>
</li>
<li><b> Test for different clock sources </b><ul>
<li>Test cases shall ensure watchdog operation for all the RTI clock sources supported.</li>
</ul>
</li>
</ul>
<p><a class="el" href="design_wdg_top.html#design_wdg_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_wdg_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">30th Nov 2018  </td><td class="markdownTableBodyNone">Sunil M S  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending Review   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">1.0  </td><td class="markdownTableBodyNone">6th Dec 2018  </td><td class="markdownTableBodyNone">Sunil M S  </td><td class="markdownTableBodyNone">Addressed Review Comments <a href="https://confluence.itg.ti.com/display/MCAL/MCUSW+WDG+Design+Review+Minutes+of+Meeting+2018-11-30">Intranet Link</a>  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="design_top.html">MCAL Module Design</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
