<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>MCUSW Datasheet: Can Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW Datasheet
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('design_can_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Can Design Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#design_can_intro">Introduction</a><ul><li class="level2"><a href="#design_can_intro_overview">Overview</a></li>
<li class="level2"><a href="#design_can_fd_overview">Can (FD) Overview</a></li>
<li class="level2"><a href="#design_can_references">References</a></li>
</ul>
</li>
<li class="level1"><a href="#design_can_req">Requirements</a><ul><li class="level2"><a href="#design_can_features_supported">Features Supported</a></li>
<li class="level2"><a href="#design_can_features_not_supported">Features Not Supported / NON Compliance</a></li>
<li class="level2"><a href="#design_can_assumptions">Assumptions</a></li>
<li class="level2"><a href="#design_can_constraints">Constraints</a></li>
</ul>
</li>
<li class="level1"><a href="#design_can_description">Design Description</a><ul><li class="level2"><a href="#design_can_desc_funda">Fundamental Operation</a><ul><li class="level3"><a href="#design_can_desc_funda_classic_op">Classic Can (Normal Operation)</a></li>
<li class="level3"><a href="#design_can_desc_funda_fd_op">CAN FD</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_desc_dynamic">Dynamic Behavior</a><ul><li class="level3"><a href="#design_can_desc_dynamic_state">States</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_desc_deter_dir">Directory Structure</a></li>
<li class="level2"><a href="#design_can_desc_int">Interrupt Service Routine</a></li>
<li class="level2"><a href="#design_can_desc_cfg">Configurator</a><ul><li class="level3"><a href="#design_can_desc_cfg_ti">NON Standard configurable parameters</a></li>
<li class="level3"><a href="#design_can_desc_cfg_ti_compute">Implementation specific parameters (computed)</a></li>
<li class="level3"><a href="#design_can_desc_cfg_variant">Variant Support</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_desc_cfg_dependency">Dependency on other modules</a><ul><li class="level3"><a href="#design_can_desc_cfg_dependency_sbl">SBL</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_desc_error">Error Classification</a><ul><li class="level3"><a href="#design_can_desc_error_dev">Development Errors</a></li>
<li class="level3"><a href="#design_can_desc_error_dev_detect">Error Detection</a></li>
<li class="level3"><a href="#design_can_desc_error_dev_notify">Error notification (DET)</a></li>
<li class="level3"><a href="#design_can_desc_error_runtime">Runtime Errors</a></li>
<li class="level3"><a href="#design_can_desc_error_dev_notify_dem">Error notification (DEM)</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#design_can_low_level">Low Level Definitions</a><ul><li class="level2"><a href="#design_can_low_level_dtypes">MACROS, Data Types &amp; Structures</a><ul><li class="level3"><a href="#design_can_low_c_type">Can Controller Pre-Compile Configuration(Can_ControllerType_PC)</a></li>
<li class="level3"><a href="#design_can_low_mb_cfg_type">Mailbox Configuration(Can_MailboxType)</a></li>
<li class="level3"><a href="#design_can_low_mb_cfg_pc_type">Can Mailbox Pre-Compile Configuration(Can_MailboxType_PC)</a></li>
<li class="level3"><a href="#design_can_low_can_cfg_type">Can Configuration(Can_ConfigType)</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_low_level_api">API&#39;s</a><ul><li class="level3"><a href="#design_can_low_level_api_init">Can_Init</a></li>
<li class="level3"><a href="#design_can_low_level_api_set_mode">Can_SetControllerMode</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_write">Can_Write</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_dis_ctrl_int">Can_DisableControllerInterrupts</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_en_ctrl_int">Can_EnableControllerInterrupts</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_main_write">Can_MainFunction_Write</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_main_busoff">Can_MainFunction_BusOff</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_main_read">Can_MainFunction_Read</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_main_wakeup">Can_MainFunction_Wakeup</a></li>
<li class="level3"><a href="#design_can_low_level_api_can_get_ver">Can_GetVersionInfo</a></li>
<li class="level3"><a href="#design_can_low_level_api_main_fun_mode">Can_MainFunction_Mode</a></li>
<li class="level3"><a href="#design_can_low_level_api_change_baud">Can_ChangeBaudrate</a></li>
<li class="level3"><a href="#design_can_low_level_api_check_baud">Can_CheckBaudrate</a></li>
<li class="level3"><a href="#design_can_low_level_api_en_loopback">Can_TestLoopBackModeEnable</a></li>
<li class="level3"><a href="#design_can_low_level_api_dis_loopback">Can_TestLoopBackModeDisable</a></li>
<li class="level3"><a href="#design_can_low_level_api_rb">Can_RegisterReadback</a></li>
<li class="level3"><a href="#design_can_low_level_api_isr_rx">Can_mcanProcessISRRx</a></li>
<li class="level3"><a href="#design_can_low_level_api_main_isr">Can_X_IntXISR OR Can_X_IntXISR_Fun</a></li>
<li class="level3"><a href="#design_can_low_level_api_set_baud">Can_SetBaudrate</a></li>
<li class="level3"><a href="#design_can_low_level_api_de_init">Can_DeInit</a></li>
</ul>
</li>
<li class="level2"><a href="#design_can_low_level_globals">Global Variables</a></li>
<li class="level2"><a href="#design_can_desc_res_behave">Resource Behavior</a></li>
</ul>
</li>
<li class="level1"><a href="#design_can_dar_top">Decision Analysis &amp; Resolution (DAR)</a><ul><li class="level2"><a href="#design_can_dar_criteria_1">DAR Criteria</a></li>
<li class="level2"><a href="#design_can_dar_alternatives_1">Available Alternatives</a></li>
<li class="level2"><a href="#design_can_dar_decision_1">Decision</a></li>
<li class="level2"><a href="#design_can_dar_criteria_2">DAR Criteria</a></li>
<li class="level2"><a href="#design_can_dar_alternatives_2">Available Alternatives</a></li>
<li class="level2"><a href="#design_can_dar_decision_2">Decision</a></li>
</ul>
</li>
<li class="level1"><a href="#design_can_test_top">Test Criteria</a></li>
<li class="level1"><a href="#design_can_rev_hist">Document Revision History</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="design_can_intro"></a>
Introduction</h1>
<hr/>
<h2><a class="anchor" id="design_can_intro_overview"></a>
Overview</h2>
<p>The figure below depicts the AUTOSAR layered architecture as 3 distinct layers, Application, Runtime Environment (RTE) and Basic Software (BSW). The BSW is further divided into 4 layers, Services, Electronic Control Unit Abstraction, MicroController Abstraction (MCAL) and Complex Drivers.</p>
<div class="image">
<img src="autosar_acrhitecture_common.png" alt="autosar_acrhitecture_common.png"/>
<div class="caption">
AUTOSAR Architecture</div></div>
<p> MCAL is the lowest abstraction layer of the Basic Software. It contains software modules that interact with the Microcontroller and its internal peripherals directly. Can driver is part of the Microcontroller Drivers (block, show above). Below shows the position of the Can driver in the AUTOSAR Architecture.</p>
<div class="image">
<img src="autosar_acrhitecture_can.png" alt="autosar_acrhitecture_can.png"/>
<div class="caption">
AUTOSAR Architecture – CAN MCAL</div></div>
<p> Can module offers following services.</p><ul>
<li>On L-PDU transmission, the Can module writes the L-PDU in an appropriate buffer inside the CAN controller hardware.</li>
<li>On L-PDU reception, the Can module calls the RX indication callback function with ID, DLC and pointer to L-SDU as parameter.</li>
<li>The Can module provides an interface that serves as periodical processing function, and which must be called by the Basic Software Scheduler module periodically.</li>
<li>The Can module provides services to control the state of the CAN controllers. Bus-off and Wake-up events are notified by means of callback functions</li>
</ul>
<p>The figure below shows Can driver interaction with other modules of AUTOSAR stack.</p>
<div class="image">
<img src="autosar_acrhitecture_can_1.png" alt="autosar_acrhitecture_can_1.png"/>
<div class="caption">
Can dependent modules</div></div>
<p> <a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_can_fd_overview"></a>
Can (FD) Overview</h2>
<p>The figure below shows the block diagram of CAN-FD module.</p>
<div class="image">
<img src="autosar_acrhitecture_can_fd.png" alt="autosar_acrhitecture_can_fd.png"/>
<div class="caption">
CAN FD Block Diagram</div></div>
<p> The Controller Area Network (CAN) is a serial communications protocol which efficiently supports distributed real-time control. CAN has high immunity to electrical interference. In a CAN network, many short messages are broadcast to the entire network, which provides for data consistency in every node of the system.</p>
<p>The CAN module (also known as MCAN) supports both classic CAN and CAN FD (CAN with Flexible Data-Rate) specifications. CAN FD feature allows high throughput and increased payload per data frame. The classic CAN and CAN FD devices can coexist on the same network without any conflict.</p>
<p>SoC can support multiple instances of the CAN module, please refer the device TRM for accurate count. Each MCAN module supports flexible bit rates greater than 1 Mbps and is compliant to ISO 11898-1:2015.</p>
<p>The main features of the CAN are</p>
<ul>
<li>Conforms with CAN Protocol 2.0 A, B and ISO 11898-1</li>
<li>Full CAN FD support (up to 64 data bytes)</li>
<li>AUTOSAR and SAE J1939 support</li>
<li>Up to 32 dedicated Transmit Buffers</li>
<li>Configurable Transmit FIFO, up to 32 elements</li>
<li>Configurable Transmit Queue, up to 32 elements</li>
<li>Configurable Transmit Event FIFO, up to 32 elements</li>
<li>Up to 64 dedicated Receive Buffers</li>
<li>Two configurable Receive FIFOs, up to 64 elements each</li>
<li>Up to 128 standard filter elements supported</li>
<li>Up to 64 extended filter elements supported</li>
<li>Internal Loopback mode for self-test</li>
<li>Timestamp Counter</li>
</ul>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_can_references"></a>
References</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.2.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for CAN Driver <a href="http://www-open.india.ti.com/~pspcm/data_pspdocs/PDP/MCAL/Documents/Autosar/V4.2/SW_Architecture_Communication_Stack/Standard_Specifications/AUTOSAR_SWS_CANDriver.pdf">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">DRA80x and TDA4x TRM  </td><td class="markdownTableBodyNone">Technical Reference Manual, <a href="http://www.ti.com/product/DRA80M/technicaldocuments">DRA80X</a>, <a href="http://www.ti.com/product/TDA4VM/technicaldocuments">TDA4X</a> CAN module is detailed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">BSW General Requirements / Coding guidelines  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/Coding+Guidelines">Intranet Link</a>   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Software Product Specification (SPS)  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/Coding+Guidelines">Intranet Link</a> Requirements are derived from <a class="el" href="design_can_top.html#design_can_references">1</a>   </td></tr>
</table>
<hr/>
 <h1><a class="anchor" id="design_can_req"></a>
Requirements</h1>
<p>The Can driver shall implement as per requirements detailed in <a class="el" href="design_can_top.html#design_can_references">4</a>, <a class="el" href="design_can_top.html#design_can_references">1</a> and <a class="el" href="design_can_top.html#design_can_references">3</a>. It’s recommended to refer <a class="el" href="design_can_top.html#design_can_references">1</a> for clarification.</p>
<hr/>
 <h2><a class="anchor" id="design_can_features_supported"></a>
Features Supported</h2>
<p>Below listed are some of the key features that are expected to be supported</p>
<ul>
<li>Initialization and de-initialization of all CAN/MCAN controllers on SoC</li>
<li>Transmission of CAN frames and confirmation</li>
<li>Reception of CAN frames</li>
<li>Polling mode for Read and Write confirmation</li>
<li>Support for CAN error detection and reporting</li>
<li>Mailbox objects – Full CAN for both Tx and Rx (32 Tx and 64 Rx)</li>
<li>The requirement id’s listed below shall be supported</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_001  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2330, MCAL-2221, MCAL-2222, MCAL-2223, MCAL-2269, MCAL-2240, MCAL-2241, MCAL-2242, MCAL-2233, MCAL-2282, MCAL-2335, MCAL-2336, MCAL-2339, MCAL-2337, MCAL-2229, MCAL-2332, MCAL-2333, MCAL-2331, MCAL-2304, MCAL-200, MCAL-207, MCAL-213, MCAL-237, MCAL-244, MCAL-225, MCAL-245   </td></tr>
</table>
<p>Other general requirements that shall be implemented</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_002  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2284, MCAL-2285, MCAL-2250, MCAL-2246, MCAL-2247, MCAL-2251, MCAL-2265, MCAL-2225, MCAL-2287, MCAL-2234, MCAL-2254, MCAL-2294, MCAL-2295, MCAL-2296, MCAL-2248, MCAL-2252, MCAL-2353, MCAL-2354, MCAL-2355, MCAL-2356, MCAL-2357, MCAL-2388, MCAL-2303, MCAL-2360, MCAL-2361, MCAL-2362, MCAL-2302,MCAL-2405, MCAL-2400, MCAL-2401, MCAL-2403   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <div class="image">
<img src="caution.png" alt="caution.png"/>
</div>
 <h2><a class="anchor" id="design_can_features_not_supported"></a>
Features Not Supported / NON Compliance</h2>
<ul>
<li><b>[NON Compliance]</b> Hardware wakeup is not supported</li>
<li><b>[NON Compliance]</b> No support for pretended networking</li>
<li><b>[NON Compliance]</b> Support for TTCAN</li>
<li><b>[AUTOSAR Optional]</b> Support for trigger transmit API</li>
<li><b>[AUTOSAR Optional]</b> L-PDU callouts is not supported</li>
<li>Supports additional/device specific configuration parameters, refer section (<a class="el" href="design_can_top.html#design_can_desc_cfg_ti_compute">Implementation specific parameters (computed)</a>) &amp; (<a class="el" href="design_can_top.html#design_can_low_level_api_rb">Can_RegisterReadback</a>)</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_037  </td></tr>
<tr>
<td><em><b>Non Requirements</b></em> </td><td><p class="starttd">MCAL-2293, MCAL-2262, MCAL-2266, MCAL-2267, MCAL-2406, MCAL-2407, MCAL-2408, MCAL-2409, MCAL-2410, MCAL-2358, MCAL-2313, MCAL-2314, MCAL-2315, MCAL-2316, MCAL-2317, MCAL-2319, MCAL-2320, MCAL-2321, MCAL-2438, MCAL-2323, MCAL-2324, MCAL-2325, MCAL-2435, MCAL-2436, MCAL-2359, MCAL-2437, MCAL-2338, MCAL-2312, MCAL-2318, MCAL-2322, MCAL-2443, MCAL-2274, MCAL-2272, MCAL-2273, MCAL-2386, MCAL-2387, MCAL-2389, MCAL-2390,MCAL-2388</p>
<p class="endtd"></p>
</td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_can_assumptions"></a>
Assumptions</h2>
<p>Below listed are assumed to valid for this design/implementation, exceptions and other deviations are listed for each explicitly. Care should be taken to ensure these assumptions are addressed.</p>
<ol type="1">
<li>The functional clock to the CAN module is expected to be on before calling any CAN module API. The CAN driver as such doesn’t perform any PRCM programming to get the functional clock.</li>
<li>The clock-source selection for CAN is not performed by the CAN driver, other entities such as SBL or MCAL module MCU shall perform the same.</li>
<li>The pin configuration used for CAN is not performed by the CAN driver, other entities such as SBL or MCAL module PORT shall perform the same.</li>
</ol>
<p>Note that assumption 1, 2 &amp; 3 are specified by AUTOSAR CAN specification.</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_can_constraints"></a>
Constraints</h2>
<p>Some of the critical constraints of this design are listed below</p>
<ul>
<li><p class="startli">HTH’s and HRH’s shall be grouped into 2 groups, i.e. a group where a HTH/HRH is mapped to only one hardware mailbox (1:1 mapping) and another group where a HTH/HRH is mapped to a group of hardware mailboxes (1:n mapping). Number of hardware mailboxes assigned to a HTH/HRH ‘n’, can be configured through ‘CanHwObjectCount’ variable.</p>
<p class="startli">Please note that if we are using FIFO we cannot guarantee exact number of messages received for particular message id since it is going to common FIFO pool.</p>
</li>
<li>In cases where MCU module is not employed (supported) to configure the clock source for CAN module (<a class="el" href="design_can_top.html#design_can_assumptions">Assumptions</a> #2).</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_003  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2221   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h1><a class="anchor" id="design_can_description"></a>
Design Description</h1>
<hr/>
 <h2><a class="anchor" id="design_can_desc_funda"></a>
Fundamental Operation</h2>
<p>The MCAN module performs CAN protocol communication as per ISO 11898-1:2015. The bit rate can be programmed to values greater than 1 Mbps. Additional transceiver hardware is required for the connection to the physical layer (CAN bus).</p>
<p>For communication on a CAN network, individual message frames can be configured. The message frames and identifier masks are stored in the Message RAM. All functions concerning the handling of messages are implemented in the Message Handler. The register set of the MCAN module can be accessed directly via the module interface. These registers are used to control and configure the CAN core and the Message Handler, and to access the Message RAM.</p>
<div class="image">
<img src="autosar_acrhitecture_can_1.png" alt="autosar_acrhitecture_can_1.png"/>
<div class="caption">
Can dependent modules</div></div>
<ul>
<li><b>CAN Core:</b> The CAN core consists of the CAN protocol controller and the Rx/Tx shift register. It handles all ISO 11898-1:2015 protocol functions and supports 11-bit and 29-bit identifiers.</li>
<li><b>Message Handler:</b> The Message Handler (Rx Handler and Tx Handler) is a state machine that controls the data transfer between the single-ported Message RAM and the CAN core's Rx/Tx shift register. It also handles the acceptance filtering.</li>
<li><b>Message RAM:</b> The main purpose of the Message RAM is to store Rx/Tx messages, Tx Event elements, and Message ID Filter elements.</li>
<li><b>Message RAM Interface:</b> Enables connection between the Message RAM and the other blocks in the MCAN module.</li>
<li><b>Registers and Message Object Access:</b> Data consistency is ensured by indirect accesses to the message objects. During normal operation, all software and DMA accesses to the Message RAM are done through interface registers. The interface registers have the same word-length as the Message RAM.</li>
<li><b>Module Interface:</b> The MCAN module registers are accessed by the user software through a 32-bit peripheral bus interface.</li>
<li><b>Clocking:</b> Two clocks are provided to the MCAN module, the peripheral synchronous clock (interface clock - MCANx_ICLK) and the peripheral asynchronous clock (functional clock - MCANx_FCLK). An entity outside CAN driver shall provide/configure such as SBL, MCAL module MCU shall perform the same.</li>
</ul>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
<h3><a class="anchor" id="design_can_desc_funda_classic_op"></a>
Classic Can (Normal Operation)</h3>
<p>Once the MCAN module is initialized and the INIT bit is reset to zero, the MCAN module synchronizes itself to the CAN bus and is ready for communication. After passing the acceptance filtering, received messages including Message Identifier (ID) and Data Length Code (DLC) are stored into a dedicated Rx Buffer or into Rx FIFO 0/Rx FIFO 1. For messages to be transmitted dedicated Tx Buffers and/or a Tx FIFO or a Tx Queue can be initialized or updated.</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
<h3><a class="anchor" id="design_can_desc_funda_fd_op"></a>
CAN FD</h3>
<p>The CAN FD standard allows extended frames to be transmitted, up to 64 data bytes in a single frame and at a higher bit rate for the data phase of a frame, up to 8 Mbps. The CAN FD standard introduces the ability to switch from one bit rate to another. Extended Data Length (EDL), as shown in Figure, sets a data length of up to 8 or up to 64 data bytes. Bit Rate Switching (BRS) indicates whether two bit rates (the data phase is transmitted at a different bit rate to the arbitration phase) are enabled.</p>
<div class="image">
<img src="can_design_fd_frame.png" alt="can_design_fd_frame.png"/>
<div class="caption">
Can FD Frame</div></div>
<p> There are two variants of CAN FD frame transmission</p><ul>
<li>CAN FD frame transmission without bit rate switching</li>
<li>CAN FD frame transmission where control field, data field, and CRC field are transmitted with a higher bit rate than the beginning and the end of the frame</li>
</ul>
<p>Some of the important fields of this packet are detailed below, for other refer <a class="el" href="design_can_top.html#design_can_references">2</a></p>
<p>In the CAN frames FDF = recessive (logical 1) signifies a CAN FD frame, FDF = dominant (logical 0) signifies a Classic CAN frame. In a CAN FD frame, the two bits following FDF - res and BRS, decide whether the bit rate inside of this CAN FD frame is switched. A CAN FD bit rate switch is signified by res =dominant and BRS = recessive. Note that the coding of res = recessive is reserved for future expansion of the protocol.</p>
<p>In case the MCAN module receives a frame with FDF = recessive and res = recessive, it will signal a Protocol Exception Event. When Protocol Exception Handling is enabled, this causes the operation state to change from Receiver to Integrating at the next sample point. In case Protocol Exception Handling is disabled the MCAN will treat a recessive res bit as an form error and will respond with an error frame.</p>
<p>CAN FD operation is enabled by programming the FDOE bit. In case FDOE = 1, transmission and reception of CAN FD frames is enabled. Transmission and reception of Classic CAN frames is always possible. Whether a CAN FD frame or a Classic CAN frame is transmitted can be configured via the FDF bit in the respective Tx Buffer element.</p>
<p>A mode change during CAN operation is only recommended under the following conditions</p>
<ul>
<li>The failure rate in the CAN FD data phase is significant higher than in the CAN FD arbitration phase. In this case disable the CAN FD bit rate switching option for transmissions.</li>
<li>During system startup all nodes are transmitting Classic CAN messages until it is verified that they are able to communicate in CAN FD format. If this is true, all nodes switch to CAN FD operation.</li>
<li>Wakeup messages in CAN Partial Networking have to be transmitted in Classic CAN format.</li>
<li>End-of-line programming in case not all nodes are CAN FD capable. Non CAN FD nodes are held in silent mode until programming has completed. Then all nodes switch back to Classic CAN communication.</li>
</ul>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_can_desc_dynamic"></a>
Dynamic Behavior</h2>
<h3><a class="anchor" id="design_can_desc_dynamic_state"></a>
States</h3>
<p>As detailed in section 7.3 of <a class="el" href="design_can_top.html#design_can_references">1</a>, Can would be in one of the following states. Un Initialized, Initialized, started, stopped, sleep and wakeup. Please note that "wakeup" is not supported, refer (<a class="el" href="design_can_top.html#design_can_features_not_supported">Features Not Supported / NON Compliance</a>)</p>
<p>A variable shall be maintained on per channel basis to track and maintain the state. The diagram below shows transitions of states and it’s associated service API’s.</p>
<div class="image">
<img src="can_design_dynamic_state.png" alt="can_design_dynamic_state.png"/>
<div class="caption">
CAN Controller State : Sourced from AUTOSAR Spec</div></div>
<p> States are</p><ul>
<li><b>STATE_UNINT:</b> This is the state when the Hardware is just started.</li>
<li><b>STATE_STOPPED:</b> This is the state in which Hardware is in when after the initialization routine is called. Can controller is fully initialized but does not participate in the bus transactions.</li>
<li><b>STATE_START</b>: This is the state in which hardware is in when it is fully operational ie., it is sending and receive messages from the bus on CAN network</li>
<li><b>STATE_SLEEP:</b> This is the state in which the hardware is in when the controller is sleeping.</li>
<li><b>STATE_WAKEUP:</b> this is the State in which the hardware is in when it detects a message on the CAN BUS when it is sleeping. In this state the Can controller is waking up from the sleep</li>
</ul>
<p>Serive API <a class="el" href="group__MCAL__CAN__API.html#ga1c8e70fe36350b79fb780514e98c6bca" title="This function performs software triggered state transitions of the CAN controller State machine...">Can_SetControllerMode()</a> can be used to transition into following states CAN_T_START, CAN_T_STOP, CAN_T_SLEEP and CAN_T_WAKEUP</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_deter_dir"></a>
Directory Structure</h2>
<p>The directory structure is as depicted in figures below, the source files can be categorized under “Driver Implementation” and “Example Application”</p>
<p><b>Driver Implemented by </b></p><ul>
<li><a class="el" href="Can_8h.html" title="This file contains interface header for CAN MCAL driver. ">Can.h</a> and <a class="el" href="Can__Irq_8h.html" title="This file contains cover page for generating doxygen API documentation. ">Can_Irq.h</a>: Shall implement the interface provided by the driver</li>
<li>Can.c, Can_Irq.c, Can_Priv.h, Can_Priv.c, Can_Mcan.c, mcan.c: Shall implement the driver functionality</li>
</ul>
<p><b>Example Application</b></p><ul>
<li><a class="el" href="Can__Cfg_8h.html" title="This file contains generated pre compile configuration file for CAN MCAL driver. ">Can_Cfg.h</a> and Can_Cfg.c: Shall implement the generated configuration for pre-compile variant</li>
<li>Can_PBcfg.c: Shall implement the generated configuration for post-build variant</li>
<li>CanApp.c: Shall implement the example application that demonstrates the use of the driver</li>
</ul>
<div class="image">
<img src="can_design_dir_spec.png" alt="can_design_dir_spec.png"/>
<div class="caption">
Directory Structure</div></div>
 <div class="image">
<img src="can_design_dir_2.png" alt="can_design_dir_2.png"/>
<div class="caption">
Detailed Directory Structure</div></div>
<p> Refer 5.5 of <a class="el" href="design_can_top.html#design_can_references">1</a> </p><table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_004  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2227, MCAL-2231, MCAL-2230, MCAL-2232, MCAL-2228   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_int"></a>
Interrupt Service Routine</h2>
<p>Section 7 of <a class="el" href="design_can_top.html#design_can_references">1</a>, details the expected behavior and control flow for ISR implementation, please refer the same.</p>
<p>An separate interrupt handler shall be provided for each instance of the Can controller. e.g. If the SoC has 2 instances of Can controller, two ISR</p><ul>
<li>Can_0_Int0ISR : ISR for Can controller 1</li>
<li>Can_1_Int0ISR : ISR for Can controller 2</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_005  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2235   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_cfg"></a>
Configurator</h2>
<p>The AUTOSAR CAN Driver Specification details mandatory parameters that shall be configurable via the configurator. Please refer section 10 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_006  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2168, MCAL-2141, MCAL-2186, MCAL-2170, MCAL-2171, MCAL-2172, MCAL-2147, MCAL-2151, MCAL-2150, MCAL-2165, MCAL-2155, MCAL-2156, MCAL-2158, MCAL-2159, MCAL-2160, MCAL-2162, MCAL-2142, MCAL-2190, MCAL-2184, MCAL-2182, MCAL-2187, MCAL-2188, MCAL-2140, MCAL-2163, MCAL-2195, MCAL-2154, MCAL-2144, MCAL-2146, MCAL-2166, MCAL-2145, MCAL-2157, MCAL-2173, MCAL-2167, MCAL-2153, MCAL-2152, MCAL-2143, MCAL-2164, MCAL-2196, MCAL-2191, MCAL-2198, MCAL-2200, MCAL-2201, MCAL-2216, MCAL-2202, MCAL-2203, MCAL-2204, MCAL-2205, MCAL-2206, MCAL-2207, MCAL-2209, MCAL-2210, MCAL-2211, MCAL-2215, MCAL-2199, MCAL-2213, MCAL-2208, MCAL-2161, MCAL-2185, MCAL-2192, MCAL-2193, MCAL-2194, MCAL-2169, MCAL-2174, MCAL-2181, MCAL-2176, MCAL-2177, MCAL-2178, MCAL-2179, MCAL-2180, MCAL-2175, MCAL-2149, MCAL-2148, MCAL-2197, MCAL-2183, MCAL-2189, MCAL-2212, MCAL-2214, MCAL-2439 , MCAL-2440, MCAL-2441, MCAL-2442, MCAL-2334   </td></tr>
</table>
<p>Please note that ECUC requirements associated with non-supported features (<a class="el" href="design_can_top.html#design_can_features_not_supported">Features Not Supported / NON Compliance</a>) shall not be supported.</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_desc_cfg_ti"></a>
NON Standard configurable parameters</h3>
<p>Following lists this design’s specific configurable parameters</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Usage comment -&mdash;   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CanControllerInstance  </td><td class="markdownTableBodyNone">Selects Can Controller Instance configured i.e MCAN0 or MCAN1   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">CanDeInitApi  </td><td class="markdownTableBodyNone">Adds / removes the service <a class="el" href="group__MCAL__CAN__API.html#ga89cdbca147f98fdf2f2262bb42262ba7" title="This service is only used for UT testing and not for app use. ">Can_DeInit()</a> from the code. <a class="el" href="group__MCAL__CAN__API.html#ga89cdbca147f98fdf2f2262bb42262ba7" title="This service is only used for UT testing and not for app use. ">Can_DeInit()</a> is vendor specific API implemented for testing purpose.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CanDefaultOSCounterId  </td><td class="markdownTableBodyNone">Default Os Counter Id if node reference to OsCounter ref CanOsCounterRef is not set. The driver shall implement timed-wait for all waits (e.g. waiting for reset to complete). This timed wait shall use OS API GetCounterValue ()   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">CanTypeofInterruptFunction  </td><td class="markdownTableBodyNone">Type of ISR function CAT1 : interrupt void func(void) CAT2 : ISR(func)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CanRegisterReadbackAPI  </td><td class="markdownTableBodyNone">Enable/Disable configuration readback safe TI API.If this parameter is set to true the readback API shall be supported. Otherwise the API is not supported.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">CanDemEventParameterRefs  </td><td class="markdownTableBodyNone">Reference to the DemEventParameter which shall be issued when the error timeout on blocking API call occurs.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CanDeviceVariant  </td><td class="markdownTableBodyNone">Select SOC being used. This parameter shall be used by driver to impose device specific constraints. The user guide shall detail the device specific constraints (if any)   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">CANFDCLK  </td><td class="markdownTableBodyNone">Clock frequency that is provided to the Can FD module in Mhz. This clock is required to calculate BRP(Baud Rate Prescaler) value.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CanLoopBackTest_Enable  </td><td class="markdownTableBodyNone">Enable/Disable LoopBack test API.If this parameter is set to true the LoopBack mode shall be supported which is used for internal testing. Otherwise the API is not supported.   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_desc_cfg_ti_compute"></a>
Implementation specific parameters (computed)</h3>
<p>The configurator shall determine the maximum number of mailboxes and controllers that are configured and generate macros to define the same. This shall be used to perform range checks on controller and mailbox configurations provided at driver initialization time. Refer section Refer section (<a class="el" href="design_can_top.html#design_can_low_level_api">API's</a>)</p>
<h3><a class="anchor" id="design_can_desc_cfg_variant"></a>
Variant Support</h3>
<p>The driver shall support both VARIANT-POST-BUILD &amp; VARIANT-PRE-COMPILE</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_036   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2441, MCAL-2442   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_cfg_dependency"></a>
Dependency on other modules</h2>
<p>In addition to dependencies listed in section 5 of <a class="el" href="design_can_top.html#design_can_references">1</a>, CAN driver shall depend on these modules to realize the required functionality, two clocks are provided to the MCAN module: the peripheral synchronous clock (interface clock - MCANx_ICLK) and the peripheral asynchronous clock (functional clock - MCANx_FCLK).</p>
<h3><a class="anchor" id="design_can_desc_cfg_dependency_sbl"></a>
SBL</h3>
<p>An entity such as SBL (or GEL files) will setup the required clocks for CAN modules</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_037   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2165   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_error"></a>
Error Classification</h2>
<p>Errors are classified in two categories, development error and runtime / production error.</p>
<hr/>
 <h3><a class="anchor" id="design_can_desc_error_dev"></a>
Development Errors</h3>
<div class="image">
<img src="can_design_dev_error.png" alt="can_design_dev_error.png"/>
<div class="caption">
Development Error</div></div>
 <h3><a class="anchor" id="design_can_desc_error_dev_detect"></a>
Error Detection</h3>
<p>The detection of development errors is configurable (ON / OFF) at pre-compile time. The switch CanDevErrorDetection will activate or deactivate the detection of all development errors.</p>
<h3><a class="anchor" id="design_can_desc_error_dev_notify"></a>
Error notification (DET)</h3>
<p>All detected development errors are reported to Det_ReportError service of the Development Error Tracer (DET).</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_007   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2327, MCAL-2329, MCAL-2326   </td></tr>
</table>
<hr/>
 <h3><a class="anchor" id="design_can_desc_error_runtime"></a>
Runtime Errors</h3>
<p>The following runtime/production errors are detectable by Can driver.</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>This error is reported if any hardware read/write event failure occurs  </td><td>CAN_E_HARDWARE_ERROR  </td><td>Defined By Integrator   </td></tr>
</table>
<h3><a class="anchor" id="design_can_desc_error_dev_notify_dem"></a>
Error notification (DEM)</h3>
<p>All detected run time errors shall be reported to Dem_ReportErrorStatus () service of the Diagnostic Event Manager (DEM).</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
<h1><a class="anchor" id="design_can_low_level"></a>
Low Level Definitions</h1>
<hr/>
<p> The detailed API and interface description is available in section 8 of <a class="el" href="design_can_top.html#design_can_references">1</a> &amp; <a class="el" href="design_can_top.html#design_can_references">4</a>. This section describes the API supported by the MCAL driver and the requirements covered by each of the API.</p>
<h2><a class="anchor" id="design_can_low_level_dtypes"></a>
MACROS, Data Types &amp; Structures</h2>
<p>The sections below lists some of key data structures that shall be implemented and used in driver implementation</p>
<h3>Maximum number of controller and mailboxes.</h3>
<p>These values depends on the SoC and integrators shall not modify the same. </p><table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">CAN_MAX_CONTROLLER  </td><td class="markdownTableBodyNone">Defines the maximum number of controllers that are configured. It’s used internally by the driver object as size parameter to allocate can controller object type structures.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">CAN_MAX_MAILBOXES  </td><td class="markdownTableBodyNone">Defines the maximum number of mailboxes that are configured. It’s used internally by the driver object as a size parameter to allocate can controller mailbox arrays.   </td></tr>
</table>
<h3><a class="el" href="structCan__ControllerType.html" title="Can Controller Configuration definition. ">Can_ControllerType</a></h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structCan__BaudConfigType.html" title="Structure defining the CAN baud rate configuration. ">Can_BaudConfigType</a>  </td><td class="markdownTableBodyNone">*DefaultBaud  </td><td class="markdownTableBodyNone">Pointer to the default Baud structure   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a class="el" href="structCan__BaudConfigType.html" title="Structure defining the CAN baud rate configuration. ">Can_BaudConfigType</a>  </td><td class="markdownTableBodyNone">**BaudRateConfigList  </td><td class="markdownTableBodyNone">List of available Baud rate structures   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_009   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2444   </td></tr>
</table>
<h3><a class="anchor" id="design_can_low_c_type"></a>
Can Controller Pre-Compile Configuration(Can_ControllerType_PC)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">ControllerId  </td><td class="markdownTableBodyNone">This parameter provides the controller ID which is unique in a given CAN Driver.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">CntrActive  </td><td class="markdownTableBodyNone">Defines if a CAN controller is used in the configuration   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">CntrAddr  </td><td class="markdownTableBodyNone">Specifies the CAN controller base address.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">RxInterrupt  </td><td class="markdownTableBodyNone">TRUE = Interrupt mode enabled FALSE = Polling mode   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">TxInterrupt  </td><td class="markdownTableBodyNone">TRUE = Interrupt mode enabled FALSE = Polling mode   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">BusOffProcessingInterrupt  </td><td class="markdownTableBodyNone">TRUE = Interrupt mode enabled FALSE = Polling mode   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Can_ControllerInstance  </td><td class="markdownTableBodyNone">CanControllerInst  </td><td class="markdownTableBodyNone">Specifies theCan controller Instance selected.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_010   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2465   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_low_mb_cfg_type"></a>
Mailbox Configuration(Can_MailboxType)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">CanHandleType  </td><td class="markdownTableBodyNone">Specifies the type (Full-CAN or Basic-CAN) of a hardware object. .   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">MBIdType  </td><td class="markdownTableBodyNone">CanIdType 0=standard 1=Extended 2= Mixed   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Can_HwHandleType  </td><td class="markdownTableBodyNone">HwHandle  </td><td class="markdownTableBodyNone">Actual HW Mailbox object in the controller.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint16  </td><td class="markdownTableBodyNone">CanHwObjectCount  </td><td class="markdownTableBodyNone">Number of hardware objects used to implement one HOH   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Can_MailBoxDirectionType  </td><td class="markdownTableBodyNone">MBDir  </td><td class="markdownTableBodyNone">Direction of Mailbox whether TRANSMIT or RECEIVE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">const <a class="el" href="structCan__ControllerType__PC.html" title="Can Controller Pre Compile Configuration definition. ">Can_ControllerType_PC</a>  </td><td class="markdownTableBodyNone">*Controller  </td><td class="markdownTableBodyNone">Reference to CAN Controller to which the HOH is associated to.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structCan__HwFilterType.html" title="Structure defining the HW filter to be used. ">Can_HwFilterType</a>  </td><td class="markdownTableBodyNone">**HwFilterList  </td><td class="markdownTableBodyNone">List of HW Filter structure of this mailbox.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">HwFilterCnt  </td><td class="markdownTableBodyNone">HW filter count   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">CanFdPaddingValue  </td><td class="markdownTableBodyNone">If PduInfo-&gt;SduLength does not match possible DLC values CanDrv will use the next higher valid DLC for transmission with initialization of unused bytes to the value of the corresponding CanFdPaddingValue.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_011   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2183,MCAL-2184,MCAL-2185,MCAL-2193   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_low_mb_cfg_pc_type"></a>
Can Mailbox Pre-Compile Configuration(Can_MailboxType_PC)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16  </td><td class="markdownTableBodyNone">CanObjectId  </td><td class="markdownTableBodyNone">Holds the handle ID of HRH or HTH.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_012   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2187   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_low_can_cfg_type"></a>
Can Configuration(Can_ConfigType)</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Identifier  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structCan__ControllerType.html" title="Can Controller Configuration definition. ">Can_ControllerType</a>  </td><td class="markdownTableBodyNone">**CanControllerList  </td><td class="markdownTableBodyNone">List of enabled Controllers.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">uint8  </td><td class="markdownTableBodyNone">CanMaxControllerCount  </td><td class="markdownTableBodyNone">MaxCount of Controller in Controller List   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="structCan__MailboxType.html" title="Can mailox configuration definition. ">Can_MailboxType</a>  </td><td class="markdownTableBodyNone">**MailBoxList  </td><td class="markdownTableBodyNone">MailBox array for all controllers.   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">MaxMbCnt  </td><td class="markdownTableBodyNone">Max MailBox Count in MB list in all controller   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">MaxBaudConfigID  </td><td class="markdownTableBodyNone">Max Baud Config Index in BaudRateConfigList in all controller   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_013   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2334   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_low_level_api"></a>
API's</h2>
<p>For the standard API's please refer 8.3 of <a class="el" href="design_can_top.html#design_can_references">1</a>. Sections below highlight other design considerations for the implementation.</p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_init"></a>
Can_Init</h3>
<p>Refer section 8.3.1.1 of <a class="el" href="design_can_top.html#design_can_references">1</a> Below flow chart highlight key steps</p>
<div class="image">
<img src="Can_Init_FC.png" alt="Can_Init_FC.png"/>
<div class="caption">
Can_Init Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_014  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>Requirements Covered: MCAL-2286, MCAL-2281, MCAL-2283, MCAL-2342, MCAL-2341, MCAL-2218, MCAL-2217, MCAL-2220, MCAL-2245, MCAL-2244, MCAL-2280, MCAL-2249, MCAL-2279, MCAL-2343, MCAL-2236 <br />
   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_low_level_api_set_mode"></a>
Can_SetControllerMode</h3>
<p>Refer section 8.3.2.3 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_SetControllerMode_FC.png" alt="Can_SetControllerMode_FC.png"/>
<div class="caption">
Can_SetControllerMode Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_015  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2365, MCAL-2275, MCAL-2368, MCAL-2370, MCAL-2372, MCAL-2373, MCAL-2374, MCAL-2364, MCAL-2257,MCAL-2258, MCAL-2260, MCAL-2261, MCAL-2264, MCAL-2270,MCAL-2367, MCAL-2255, MCAL-2366, MCAL-2259, MCAL-2263, MCAL-2268, MCAL-2271, MCAL-2276   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_write"></a>
Can_Write</h3>
<p>Refer section 8.3.3.1 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_Write_FC.png" alt="Can_Write_FC.png"/>
<div class="caption">
Can_Write Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_016  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2297, MCAL-2292, MCAL-2288, MCAL-2290, MCAL-2392, MCAL-2393, MCAL-2394, MCAL-2396, MCAL-2397, MCAL-2398, MCAL-2399, MCAL-2391, MCAL-2395, MCAL-2291, MCAL-2404, MCAL-2402   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h3><a class="anchor" id="design_can_low_level_api_can_dis_ctrl_int"></a>
Can_DisableControllerInterrupts</h3>
<p>Refer section 8.3.2.4 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_DisableControllerInterrupts_FC.png" alt="Can_DisableControllerInterrupts_FC.png"/>
<div class="caption">
Can_DisableControllerInterrupts Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_017  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2376, MCAL-2377, MCAL-2379, MCAL-2380, MCAL-2375, MCAL-2369, MCAL-2371   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_en_ctrl_int"></a>
Can_EnableControllerInterrupts</h3>
<p>Refer section 8.3.2.5 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_EnableControllerInterrupts_FC.png" alt="Can_EnableControllerInterrupts_FC.png"/>
<div class="caption">
Can_EnableControllerInterrupts Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_018  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2382, MCAL-2377, MCAL-2378, MCAL-2383, MCAL-2384, MCAL-2385, MCAL-2381   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_main_write"></a>
Can_MainFunction_Write</h3>
<p>Refer section 8.5.1.1 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_MainFunction_Write_FC.png" alt="Can_MainFunction_Write_FC.png"/>
<div class="caption">
Can_MainFunction_Write Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_019  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2311, MCAL-2292, MCAL-2413, MCAL-2290, MCAL-2414, MCAL-2415, MCAL-2412, MCAL-2416   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_main_busoff"></a>
Can_MainFunction_BusOff</h3>
<p>Refer section 8.5.1.3 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_MainFunction_BusOff_FC.png" title="Can_MainFunction_BusOff Flow Chart"/>
</div>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_020  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2311, MCAL-2310, MCAL-2423, MCAL-2411, MCAL-2424, MCAL-2425, MCAL-2422, MCAL-2277, MCAL-2278   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_main_read"></a>
Can_MainFunction_Read</h3>
<p>Refer section 8.5.1.2 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_MainFunction_Read_FC.png" alt="Can_MainFunction_Read_FC.png"/>
<div class="caption">
Can_MainFunction_Read Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_021  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2311, MCAL-2307, MCAL-2301, MCAL-2418, MCAL-2411, MCAL-2419, MCAL-2420, MCAL-2417, MCAL-2298, MCAL-2305, MCAL-2306, MCAL-2300, MCAL-2299, MCAL-2289, MCAL-2421   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_main_wakeup"></a>
Can_MainFunction_Wakeup</h3>
<p>Refer section 8.5.1.4 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_MainFunction_Wakeup_FC.png" alt="Can_MainFunction_Wakeup_FC.png"/>
<div class="caption">
Can_MainFunction_Wakeup Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_022  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2311, MCAL-2310, MCAL-2411, MCAL-2427, MCAL-2428, MCAL-2429, MCAL-2426   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_can_get_ver"></a>
Can_GetVersionInfo</h3>
<p>Refer section 8.3.1.2 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_GetVersionInfo_FC.png" alt="Can_GetVersionInfo_FC.png"/>
<div class="caption">
Can_GetVersionInfo Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_023  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2345, MCAL-2344   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_main_fun_mode"></a>
Can_MainFunction_Mode</h3>
<p>Refer section 8.5.1.5 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_MainFunction_Mode_FC.png" alt="Can_MainFunction_Mode_FC.png"/>
<div class="caption">
Can_MainFunction_Mode Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_024  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2311, MCAL-2310, MCAL-2411, MCAL-2224, MCAL-2430, MCAL-2431, MCAL-2253, MCAL-2256, MCAL-2432   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_change_baud"></a>
Can_ChangeBaudrate</h3>
<p>Refer section 8.3.2.1 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_ChangeBaudrate_FC.png" alt="Can_ChangeBaudrate_FC.png"/>
<div class="caption">
Can_ChangeBaudrate Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_025  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2363   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_check_baud"></a>
Can_CheckBaudrate</h3>
<p>Refer section 8.3.1.3 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<div class="image">
<img src="Can_CheckBaudrate_FC.png" alt="Can_CheckBaudrate_FC.png"/>
<div class="caption">
Can_CheckBaudrate Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_026  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2346, MCAL-2347, MCAL-2348, MCAL-2349, MCAL-2350, MCAL-2351, MCAL-2352   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_en_loopback"></a>
Can_TestLoopBackModeEnable</h3>
<div class="image">
<img src="Can_TestLoopBackModeEnable_FC.png" alt="Can_TestLoopBackModeEnable_FC.png"/>
<div class="caption">
Can_TestLoopBackModeEnable Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_027  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2459   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_dis_loopback"></a>
Can_TestLoopBackModeDisable</h3>
<div class="image">
<img src="Can_TestLoopBackModeDisable_FC.png" alt="Can_TestLoopBackModeDisable_FC.png"/>
<div class="caption">
Can_TestLoopBackModeEnable Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_028  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2459   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_rb"></a>
Can_RegisterReadback</h3>
<p>As noted from previous implementation, the can configuration registers could potentially be corrupted by other entities (s/w or h/w). One of the recommended detection methods would be to periodically read-back the configuration and confirm configuration is consistent. The service API defined below shall be implemented to enable this detection.</p>
<table class="doxtable">
<tr>
<td><em><b> </b></em> </td><td><em><b>Description</b></em> </td><td><em><b> Comments</b></em>  </td></tr>
<tr>
<td><em><b>Service Name</b></em> </td><td>Can_RegisterReadback </td><td>Can potentially be turned OFF, refer (<a class="el" href="design_can_top.html#design_can_desc_cfg_ti">NON Standard configurable parameters</a>)   </td></tr>
<tr>
<td><em><b>Syntax</b></em> </td><td>Std_ReturnType Can_RegisterReadback(uint8 Controller, <a class="el" href="structCan__RegisterReadbackType.html" title="Register Readback Structure. ">Can_RegisterReadbackType</a> *RegRbPtr)  </td><td><a class="el" href="structCan__RegisterReadbackType.html" title="Register Readback Structure. ">Can_RegisterReadbackType</a> defines the type, that holds critical values   </td></tr>
<tr>
<td><em><b>Service ID </b></em> </td><td>NA  </td><td></td></tr>
<tr>
<td><em><b>Sync / Async </b></em> </td><td>Sync </td><td></td></tr>
<tr>
<td><em><b>Reentrancy</b></em> </td><td>Non Reentrant </td><td></td></tr>
<tr>
<td><em><b>Parameter in</b></em> </td><td>Controller </td><td>Identifies a unique valid controller   </td></tr>
<tr>
<td><em><b>Parameters out</b></em> </td><td>RegRbPtr </td><td>Pointer of type <a class="el" href="structCan__RegisterReadbackType.html" title="Register Readback Structure. ">Can_RegisterReadbackType</a>, which holds read values  </td></tr>
<tr>
<td><em><b>Return Value</b></em> </td><td>Standard return type </td><td>E_OK or E_NOT_OK in case of invalid channel id  </td></tr>
</table>
<p>The critical register listed is a recommendation and implementation shall determine appropriate registers.</p>
<p>This service could potentially be turned OFF in the configurator. (<a class="el" href="design_can_top.html#design_can_desc_cfg_ti">NON Standard configurable parameters</a>)</p>
<div class="image">
<img src="Can_RegisterReadback_FC.png" alt="Can_RegisterReadback_FC.png"/>
<div class="caption">
Can_RegisterReadback Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_029  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2452   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_isr_rx"></a>
Can_mcanProcessISRRx</h3>
<table class="doxtable">
<tr>
<td><em><b>Prototype</b></em> </td><td>Void Can_mcanProcessISRRx (Can_ControllerObjType *controllerObj, const Can_MailboxObjType *canMailbox, uint32 maxMbCnt)   </td></tr>
<tr>
<td><em><b>Parameter</b></em> </td><td>Mailbox number   </td></tr>
<tr>
<td><em><b>Return Code </b></em> </td><td>None   </td></tr>
<tr>
<td><em><b>Functional Description </b></em> </td><td>This is an internal function which is used for processing of received CAN messages  </td></tr>
</table>
<div class="image">
<img src="Can_mcanProcessISRRx_FC.png" alt="Can_mcanProcessISRRx_FC.png"/>
<div class="caption">
Can_mcanProcessISRRx Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_030  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2226, MCAL-2288, MCAL-2299, MCAL-2302   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_can_low_level_api_main_isr"></a>
Can_X_IntXISR OR Can_X_IntXISR_Fun</h3>
<ol type="1">
<li>ISR ‘Can_X_IntXISR’ shall be registered to respective CAN Controller Interrupt line as per mapping provided below.</li>
<li>Function ‘Can_X_IntXFunc’ is called when ISR ‘Can_X_IntXISR’ for CAN is called. Only the CAN Interrupt is used.</li>
<li>Following is the mapping for ISRs to CAN controller interrupt lines<ul>
<li>Can_0_Int0ISR are associated with Interrupt Line 0 of the MCAN0 Controller respectively.</li>
<li>Can_1_Int0ISR are associated with Interrupt Line 0 of the MCAN1 Controller respectively.</li>
</ul>
</li>
<li>Only TX and RX Mail box interrupts &amp; Error interrupt will be enabled to begin. If there are 2 controllers, implementation shall have 2 instances of the ISR’s</li>
</ol>
<table class="doxtable">
<tr>
<td><em><b>Prototype</b></em> </td><td>Void Can_1_Int0ISR_Fun( void )   </td></tr>
<tr>
<td><em><b>Parameter</b></em> </td><td>Void   </td></tr>
<tr>
<td><em><b>Return Code </b></em> </td><td>None   </td></tr>
<tr>
<td><em><b>Functional Description </b></em> </td><td>This the ISR for the CAN Interrupts. Interrupts IE0 is used for the triggering the interrupt. There are 2 interrupts for 2 controllers. All of them perform the same type of operation.  </td></tr>
</table>
<div class="image">
<img src="Can_X_IntXISR_Can_X_IntXISR_Fun_FC.png" alt="Can_X_IntXISR_Can_X_IntXISR_Fun_FC.png"/>
<div class="caption">
CAN Main ISR Flow Chart</div></div>
 <table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_031  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2273, MCAL-2298, MCAL-2309, MCAL-2308, MCAL-2300, MCAL-2237   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
<h3><a class="anchor" id="design_can_low_level_api_set_baud"></a>
Can_SetBaudrate</h3>
<p>Refer section 8.3.2.2 of <a class="el" href="design_can_top.html#design_can_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Prototype</b></em> </td><td>Std_ReturnType Can_SetBaudrate(Controller BaudRateConfigID)   </td></tr>
<tr>
<td><em><b>Parameter In </b></em> </td><td>Controller - CAN Controller ID   </td></tr>
<tr>
<td><em><b>Parameter In </b></em> </td><td>BaudRateConfigID - Baud rate config List Index which should be used for Baudrate configuration   </td></tr>
<tr>
<td><em><b>Return Code </b></em> </td><td>E_OK/E_NOTOK   </td></tr>
<tr>
<td><em><b>Functional Description </b></em> </td><td>This service shall set the baud rate configuration of the CAN controller.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_032  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2361, MCAL-2363, MCAL-2250, MCAL-2284, MCAL-2251, MCAL-2252   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
<h3><a class="anchor" id="design_can_low_level_api_de_init"></a>
Can_DeInit</h3>
<table class="doxtable">
<tr>
<td><em><b>Prototype</b></em> </td><td>Void <a class="el" href="group__MCAL__CAN__API.html#ga89cdbca147f98fdf2f2262bb42262ba7" title="This service is only used for UT testing and not for app use. ">Can_DeInit(void)</a>   </td></tr>
<tr>
<td><em><b>Parameter In </b></em> </td><td>None   </td></tr>
<tr>
<td><em><b>Return Code </b></em> </td><td>None   </td></tr>
<tr>
<td><em><b>Functional Description </b></em> </td><td>This API is not standard AUTOSAR API. This service sets the internal Can Controller state to UNINIT state so that Can_Init can be invoked again and also disables Interrupts. This is required for UT test cases with different Config.   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_033  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2447   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h2><a class="anchor" id="design_can_low_level_globals"></a>
Global Variables</h2>
<p>This design expects that implementation will require to use following global variables.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Default Value   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Can_DriverObj  </td><td class="markdownTableBodyNone">Can_DriverObjType  </td><td class="markdownTableBodyNone">Can Driver object  </td><td class="markdownTableBodyNone">Not defined   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">Can_InitDone  </td><td class="markdownTableBodyNone">boolean  </td><td class="markdownTableBodyNone">Can driver Init status flag  </td><td class="markdownTableBodyNone">FALSE   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Can_HtrhMbMapping  </td><td class="markdownTableBodyNone">uint32  </td><td class="markdownTableBodyNone">Mapping of CAN HW mailbox id to logical xmit/recv handle passed by upper layer to CAN API  </td><td class="markdownTableBodyNone">Not defined   </td></tr>
</table>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_038   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>SWS_BSW_00130   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_can_desc_res_behave"></a>
Resource Behavior</h2>
<ul>
<li><b> Code Size </b>: Implementation of this driver shall not exceed 30 kilo lines of code and 4 KB of data section.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_034  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2455   </td></tr>
</table>
<ul>
<li><b> Stack Size </b>: Worst case stack utilization shall not exceed 2 kilo bytes.</li>
</ul>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_CAN_035  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-2456   </td></tr>
</table>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a> </p><hr/>
 <h1><a class="anchor" id="design_can_dar_top"></a>
Decision Analysis &amp; Resolution (DAR)</h1>
<p>Sections below list some of the important design decisions and rational behind those decision.</p>
<h2>CAN Dma mode</h2>
<p>The Can Receive message can be processed either through CPU or via DMA. The method chosen will impact receive throughput.</p>
<h2><a class="anchor" id="design_can_dar_criteria_1"></a>
DAR Criteria</h2>
<p>Minimal restrictions on the system and guaranteed “no receive message drop” in the system.</p>
<h2><a class="anchor" id="design_can_dar_alternatives_1"></a>
Available Alternatives</h2>
<ul>
<li><b> DMA Mode </b> DMA Mode – The can controller will generate a DMA events to the system EDMA.CAN message will be copied from CAN mailbox to destination address by DMA<ul>
<li><b> Advantages: </b><ul>
<li>CPU loading is low and constant irrespective of the number of CAN messages received.</li>
<li>Less probability of mailbox overflow as the DMA copy happens without CPU intervention</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Complexity involved in designing the EDMA parameters.</li>
<li>Cache coherency needs to be taken care. This will result in Cache module dependency in driver or in the AUTOSAR stack</li>
<li>Need of a common DMA complex driver with resource management as the EDMA is at system level and is common across SoC</li>
</ul>
</li>
</ul>
</li>
<li><b> CPU Mode </b> The Can controller will raise an interrupt. The CPU needs to copy the message and invoke the CanIfRxIndication callback.<ul>
<li><b> Advantages: </b><ul>
<li>Simple implementation</li>
<li>No cache coherency is needed and no dependency on cache APIs</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>CPU load is function of rate of CAN messages.</li>
<li>High probability of mailbox overflow during high receive message rate as the CPU is involved in reading the FIFO</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="design_can_dar_decision_1"></a>
Decision</h2>
<p>In case of ADAS use case, the CPU loading is low and there is no chance of CAN mailbox overflow in case Thus in all respect (complexity, efficiency), CPU mode is sufficient for the ADAS use case. So it is recommended to employ cpu mode.</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h2>MCAN Tx Buffer Mode</h2>
<p>Along with dedicated Tx Buffers, MCAN also supports Tx FIFO/Queue. This buffer mode is configurable and can be used in one those configurations. The mode selected will affect the priority in which will messages will go out on bus. Support of any of these modes is necessary in order to support multiplexed transmission.</p>
<h2><a class="anchor" id="design_can_dar_criteria_2"></a>
DAR Criteria</h2>
<p>Minimal restrictions on the system and support multiplexed transmission in order to avoid priority inversion.</p>
<h2><a class="anchor" id="design_can_dar_alternatives_2"></a>
Available Alternatives</h2>
<ul>
<li><b> FIFO Mode </b> In this mode, messages are stored into memory in First In First Out(FIFO) manner<ul>
<li><b> Advantages: </b><ul>
<li>Less software overhead as FIFO management is done by MCAN controller</li>
<li>Messages are sent in the order in which they are being stored into FIFO</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Since messages are being sent in the orders which are stored into FIFO, priority inversion can happen if message with higher priority are stored at later location in the FIFO.</li>
<li>Messages should be carefully written into FIFO in order to avoid priority inversion.</li>
</ul>
</li>
</ul>
</li>
<li><b> QUEUE Mode </b> In this mode, messages will be stored into first free location in the memory allocated for Queue<ul>
<li><b> Advantages: </b><ul>
<li>Messages are sent in the order of their priority hence priority inversion will not happen.</li>
<li>Can be treated as Tx Buffer.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Messages are written into first free location in Tx Queue, hence leads more software overhead.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="design_can_dar_decision_2"></a>
Decision</h2>
<p>In case of ADAS use case, the CPU loading is low and priority inversion cannot occur. Thus in all respect (complexity, efficiency), Queue mode is recommended.</p>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_can_test_top"></a>
Test Criteria</h1>
<p>The sections below identify some of the aspects of design that would require emphasis during testing of this design implementation</p>
<ul>
<li><b> Internal Loopback </b> : Internal loopback could be used for enhancements (or development)<ul>
<li>Configure CAN controller to operate in internal loopback mode and check for transmission and reception of the message.</li>
</ul>
</li>
<li><b> Board to Board Loopback </b><ul>
<li>Connect two CAN controllers through CAN bus. Send message from first controller and check for reception of the same message on the other controller.</li>
</ul>
</li>
<li><b> Multiplexed Transmission </b><ul>
<li>Configure message RAM in mixed configuration i.e. to have both buffers as well as FIFO in case of DCAN or Queue in case MCAN. Check if message is getting properly configured as well as check for Multiplexed transmission (priority inversion).</li>
</ul>
</li>
<li><b> Different Baud-Rates </b><ul>
<li>Check for transmission and reception at different baud rates.</li>
</ul>
</li>
<li><b> Inter-packet delay </b><ul>
<li>Include tests cases where inter-packet delay is 0 (i.e. ST_MIN = 0)</li>
</ul>
</li>
</ul>
<p><a class="el" href="design_can_top.html#design_can_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_can_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">21 Aug 2018  </td><td class="markdownTableBodyNone">Sunil MS  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableBody" class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">03 Oct 2018  </td><td class="markdownTableBodyNone">Sujith S  </td><td class="markdownTableBodyNone">Converted to HTML and reorganized  </td><td class="markdownTableBodyNone">Approved   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="design_top.html">MCAL Module Design</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
