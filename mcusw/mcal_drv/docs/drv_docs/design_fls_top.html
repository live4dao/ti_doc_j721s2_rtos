<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<title>MCUSW: Fls Design Document</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MCUSW
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('design_fls_top.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Fls Design Document </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="design_fls_intro"></a>
Introduction</h1>
<hr/>
<p> This document describes the functionality, API and configuration of the AUTOSAR BSW module Flash.</p><ul>
<li>Supported AUTOSAR Release <b>: 4.3.1</b></li>
<li>Supported Configuration Variants <b>: Pre-Compile &amp; Post Build</b></li>
<li>Vendor ID <b>: FLS_VENDOR_ID (44)</b></li>
<li>Module ID <b>: FLS_MODULE_ID (92)</b></li>
</ul>
<h2><a class="anchor" id="design_fls_intro_overview"></a>
Overview</h2>
<p>The figure below depicts the AUTOSAR layered architecture as 3 distinct layers,</p><ul>
<li>Application</li>
<li>Runtime Environment (RTE) and</li>
<li>Basic Software (BSW).</li>
</ul>
<p>The BSW is further divided into 4 layers:</p><ul>
<li>Services</li>
<li>Electronic Control Unit Abstraction</li>
<li>MicroController Abstraction (MCAL) and</li>
<li>Complex Drivers.</li>
</ul>
<div class="image">
<img src="autosar_acrhitecture_common.png" alt="autosar_acrhitecture_common.png"/>
<div class="caption">
AUTOSAR Architecture</div></div>
<p>MCAL is the lowest abstraction layer of the Basic Software. It contains internal drivers that are software modules that interact with the Microcontroller and its internal peripherals directly. Flash Driver is part of the Memory Drivers module, which is part of the Basic Software. The Flash Driver provides services for reading, writing, erasing flash memory and Execute-in-Place (XIP) mode for external Flash Device. The driver supports MT35XU512ABA1G12 and S28HS512T OSPI Flash Devices. The main tasks of the FLS driver are:</p><ul>
<li>Perform storage mode applications:<ul>
<li>Read from flash.</li>
<li>Write to flash.</li>
<li>Erase Flash.</li>
<li>Compare and Blank Check flash memory location.</li>
</ul>
</li>
<li>Execute application using XIP Mode (only XIP read supported).</li>
</ul>
<div class="image">
<img src="autosar_architecture_fls.png" alt="autosar_architecture_fls.png"/>
<div class="caption">
AUTOSAR Architecture – Fls MCAL</div></div>
<hr/>
<h3><a class="anchor" id="design_fls_intro_fls_overview"></a>
Fls Overview</h3>
<p>This Flash driver uses OSPI module to transfer data between the system and flash device. Below diagram shows the integration between the two hardware IPs that are used by the Flash Driver: FSS and OSPI. J721-EVM has one Flash device support - MT35XU512ABA1G12, and J7200-EVM has s28HS512T. Please note that this is for just reference purpose, for other details please refer to technical reference manual.</p>
<p>Diagrams are from device TRM.</p>
<p><b> Fls </b> </p><div class="image">
<img src="fls_design_blockdiagram.png" alt="fls_design_blockdiagram.png"/>
<div class="caption">
FLS Block Diagram </div></div>
<p>The Flash Driver module includes the following main features:</p><ul>
<li>Storage Mode support to Write, Read, Erase for flash memory.</li>
<li>Direct Access Mode (DAC) for Memory Mapped Flash accesses.</li>
<li>Indirect Access Mode (INDAC) to make use of internal SRAM for data transfers.</li>
<li>Poll Mode implementation for DAC and INDAC mode, and Interrupt Mode implementation for INDAC mode.</li>
<li>Serial clock with programmable frequency.</li>
<li>Single (STR/SDR) and Double Transfer Rate protocol (DTR/DDR) support.</li>
<li>Execute-in-Place (XIP) Read support.</li>
<li>PHY Module integration for optimized performance.</li>
</ul>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h3><a class="anchor" id="design_fls_references"></a>
References</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sl No  </th><th class="markdownTableHeadNone">Specification  </th><th class="markdownTableHeadNone">Comment / Link   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1  </td><td class="markdownTableBodyNone">AUTOSAR 4.3.1  </td><td class="markdownTableBodyNone">AUTOSAR Specification for Flash Driver <a href="https://www.autosar.org/fileadmin/user_upload/standards/classic/4-3/AUTOSAR_SWS_FlashDriver.pdf">Internet Link</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2  </td><td class="markdownTableBodyNone">TDA4x TRM  </td><td class="markdownTableBodyNone">Technical Reference Manual, <a href="http://www.ti.com/product/TDA4VM/technicaldocuments">TDA4X</a>, FSS and OSPI module is detailed   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3  </td><td class="markdownTableBodyNone">BSW General Requirements / Coding guidelines  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/Coding+Guidelines">Intranet Link</a>   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4  </td><td class="markdownTableBodyNone">Software Product Specification (SPS)  </td><td class="markdownTableBodyNone"><a href="https://confluence.itg.ti.com/display/MCAL/MCUSW+Software+Product+Specification">Intranet Link</a> Requirements are derived from <a class="el" href="design_fls_top.html#design_fls_references">1</a>   </td></tr>
</table>
<hr/>
<h1><a class="anchor" id="design_fls_req"></a>
Requirements</h1>
<p>The Flash Driver implements a standardized interface specified in the AUTOSAR_SWS_FlashDriver document, specified in: <a class="el" href="design_fls_top.html#design_fls_references">4</a>, <a class="el" href="design_fls_top.html#design_fls_references">1</a> and <a class="el" href="design_fls_top.html#design_fls_references">3</a>. It’s recommended to refer <a class="el" href="design_fls_top.html#design_fls_references">1</a> for clarification.</p>
<hr/>
 <h2><a class="anchor" id="design_fls_features_supported"></a>
Features Supported</h2>
<ul>
<li>Configuration of Flash Device<ul>
<li>External flash device - MT35XU512ABA1G12</li>
</ul>
</li>
<li>Initialization of OSPI Module.</li>
<li>Enabling of Development Error Detection (DET).</li>
<li>Configuration of implementation features like:<ul>
<li>Fls DDR vs SDR</li>
<li>Fls DAC vs INDAC</li>
<li>Fls OSPI Clk Speed</li>
<li>Fls XIP Enable</li>
</ul>
</li>
<li>Asynchronous Write, Read, Erase, BlankCheck, and Compare APIs</li>
<li>Interrupt based implementation with INDAC using non-blocking/callback design.</li>
</ul>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <div class="image">
<img src="caution.png" alt="caution.png"/>
</div>
   <h2><a class="anchor" id="design_fls_features_not_supported"></a>
Features Not Supported / NON Compliance</h2>
<p><b> API features not supported </b></p><ul>
<li>BlankCheck and Compare API functionality not available in Interrupt mode.</li>
<li>Timeout Supervision not supported.</li>
<li>Erase and Write Verification not supported.</li>
<li>Only one instance of Fls module supported at one time.</li>
<li>Cancel API not supported.</li>
</ul>
<p><b> HW features not supported </b></p><ul>
<li>Supports only XIP Read mode.</li>
<li>Implementation compliant with only MCU1_0 and MCU2_1.</li>
</ul>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_fls_assumptions"></a>
Assumptions</h2>
<p>Below listed points are assumed to be valid for this design/implementation, exceptions and other deviations are listed for each explicitly. Care should be taken to ensure these assumptions are addressed.</p>
<ol type="1">
<li>The functional clock to the Fls module is expected to be ON before calling any Fls service APIs. The Fls driver doesn’t perform any programming to enable the module functional clock.</li>
<li>Interrupt configuration for Fls interrupt registration should be done by application. Refer to example application for reference.</li>
<li>Flash base addresses, register offsets and SOC specific defines are defined by CSL header files.</li>
</ol>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_fls_description"></a>
Design Description</h1>
<h2><a class="anchor" id="design_fls_fundamental_operation"></a>
Fundamental Operation</h2>
<p>Fls module uses OSPI interface to transfer data between the system and the flash device. To be able to write to the flash, the flash has to be erased first. The erase operation internally programs 0xFF to all memory cells.</p>
<h3>DAC Mode:</h3>
<ul>
<li>Direct Access Mode allows data interface accesses directly trigger read or write to flash memory. It is memory-mapped, and can be used to both access and directly execute code from external flash.</li>
</ul>
<h3>INDAC Mode:</h3>
<ul>
<li>Indirect Access Mode used the internal OSPI SRAM to make data transfers. Indirect trigger access address does not have any relationship with flash address. It should take the SRAM as source (instead of Flash memory).</li>
</ul>
<h3>STIG:</h3>
<ul>
<li>Software Triggered Instruction Generator - While DAC and INDAC are used for data transfer, STIG is used to access the volatile and non-volatile configuration registers, status registers, and for erase functions.</li>
</ul>
<p>This Flash Driver Module Write, Read, Erase, BlankCheck and Compare APIs are asynchronous such that control will return to the application after the job from one of the APIs has been accepted. A "job" describes the action that will perform actual transactions to the hardware. The driver's Fls_MainFunction () API will do the job processing internally, after the APIs have been called and the job has been accepted. During job processing, the module will perform the programming of the flash device, and will make data transfers between system and flash device.</p>
<div class="image">
<img src="fls_OSPI_blk_diag.png" alt="fls_OSPI_blk_diag.png"/>
</div>
   <h3>External Flash Device Hardware:</h3>
<ul>
<li>Flash is composed of Sectors and Pages. Sectors are subdivided into Pages.</li>
<li>Writes happen in complete page blocks, erases happen in complete sectors.</li>
<li>Write Enable command sent before a write or erase operation.</li>
<li>Read ID command sent to detect the connected flash device.</li>
<li>MT35XU512ABA1G12 NOR Flash Device:<ol type="1">
<li>Micron Tech, 64MB density</li>
<li>Sector Size: 4k Bytes</li>
<li>Page Size: 256 Bytes</li>
</ol>
</li>
<li>S28HS512T NOR Flash Device:<ol type="1">
<li>Cypress, 64MB density</li>
<li>Sector Size: 256K Bytes</li>
<li>Page Size: 256 Bytes</li>
</ol>
</li>
</ul>
<hr/>
 <h2><a class="anchor" id="design_fls_desc_seq"></a>
Sequence Diagrams</h2>
<p>The Flash driver follows the code sequence outlined by the Autosar Spec for FLASH Module. Please refer to <a class="el" href="design_fls_top.html#design_fls_references">1</a> for more details.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_fls_desc_resource"></a>
Resource Behavior</h2>
<p>There are no hard requirements for resource allocation for Flash driver. Average Stack Size of FLS Driver is around 5 kilo bytes.</p>
<p>In terms of CPU load, there is not target defined for Flash Driver. We will measure and report this analysis post development.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_fls_desc_ISR"></a>
Interrupt Service Routines</h2>
<p>For the Flash module instance, one interrupt service routine has been mapped. Note that Interrupt mode is only available when operating in INDAC mode. BlankCheck and Compare API are not functional with interrupt mode. The supported ISR is part of the <a class="el" href="Fls__Irq_8h.html" title="This file contains ISR function declaration for FLS MCAL driver.">Fls_Irq.h</a> and Fls_Irq.c files.</p>
<p><b>Handling Flash OSPI FIFO Interrupt:</b> OSPI Hardware Behavior: The hardware uses SRAM Watermark levels to trigger interrupts. There are two interrupts generated for every write/read call from SRAM to/from Flash memory. One interrupt notifies driver that the SRAM FIFO fill level is below a watermark level, which allows more data to be transferred into the SRAM. Another interrupt occurs when the transfer from SRAM into Flash memory, or to system memory, completes. Both these interrupts trigger the same ISR, and are handled accordingly within the ISR.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_fls_dynamic_behaviour"></a>
Dynamic Behavior</h2>
<p>The Flash driver at any time will be in one of the following states. The state transition will depend on the APIs invoked by the application</p><ul>
<li>MEMIF_UNINIT: The Flash Driver is not initialized. This is the state before starting driver initialization.</li>
<li>MEMIF_IDLE: The Flash Driver is not currently transferring any Job. This is the state before the transfer is started or after the transfer is completed.</li>
<li>MEMIF_BUSY: This is the state after a transfer has started i.e. Job execution is on going.</li>
</ul>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_desc_deter_dir"></a>
Directory Structure</h2>
<p>The diagram below shows the overall files structure for the Flash driver. The Fls.c and <a class="el" href="Fls_8h.html" title="This file contains interface header for Fls MCAL driver.">Fls.h</a> are the 2 files that contain the Flash driver’s APIs.</p>
<div class="image">
<img src="fls_design_dir_standard.png" alt="fls_design_dir_standard.png"/>
<div class="caption">
Directory Structure</div></div>
<div class="image">
<img src="fls_design_dir_structure_main0.png" alt="fls_design_dir_structure_main0.png"/>
<div class="caption">
Detailed Directory Structure</div></div>
<p><b>Driver Implemented by </b></p><ul>
<li><a class="el" href="Fls_8h.html" title="This file contains interface header for Fls MCAL driver.">Fls.h</a> : Shall implement the interface provided by the Fls driver</li>
<li><a class="el" href="Fls__Irq_8h.html" title="This file contains ISR function declaration for FLS MCAL driver.">Fls_Irq.h</a> Contains ISR function declaration.</li>
<li>Fls.c, Fls_Irq.c : Shall implement the driver functionality</li>
<li>Fls_Brd_Nor_Ospi.c, Fls_Brd_Nor_Xspi.c and Fls_Brd_Nor.h : shall have the internal functions and data structures for board level APIs. J721E-EVM board will include Fls_Brd_Nor_Ospi.c, while J7200-EVM will include Fls_Brd_Nor_Xspi.c.</li>
<li>Fls_Ospi.c, Fls_Ospi.h, Fls_Spi_Intf.c, Fls_Spi_Intf.h : Shall have the OSPI interface APIs, functions and data structures.</li>
<li>Fls_Soc.c, Fls_Soc.h, Fls_NOR_s28hs512t.h and Fls_NOR_m35xu512.h : Shall contain the SOC and Flash device specific data structures.</li>
<li>nor_spi_patterns.c, nor_spi_patterns.h, nor_spi_phy_tune.c and nor_spi_phy_tune.h are PHY tune algorithm files.</li>
</ul>
<p><b>Example Application</b></p><ul>
<li><a class="el" href="Fls__Cfg_8h.html" title="This file contains generated pre compile configuration file for FLS MCAL driver.">Fls_Cfg.h</a>: Shall implement the generated configuration for Pre-Compile variant</li>
<li>FlsApp.c: Shall implement the example application that demonstrates the use of the driver</li>
<li>Please note the below configuration and test application associations:</li>
</ul>
<ol type="1">
<li>fls_app uses Fls_Cfg.c, <a class="el" href="Fls__Cfg_8h.html" title="This file contains generated pre compile configuration file for FLS MCAL driver.">Fls_Cfg.h</a></li>
<li>fls_app_dac uses Fls_Cfg_dac.c, <a class="el" href="Fls__Cfg_8h.html" title="This file contains generated pre compile configuration file for FLS MCAL driver.">Fls_Cfg.h</a></li>
<li>fls_app_indac uses Fls_Cfg_indac.c, <a class="el" href="Fls__Cfg_8h.html" title="This file contains generated pre compile configuration file for FLS MCAL driver.">Fls_Cfg.h</a></li>
<li>fls_app_xip uses Fls_Cfg_xip.c, <a class="el" href="Fls__Cfg_8h.html" title="This file contains generated pre compile configuration file for FLS MCAL driver.">Fls_Cfg.h</a></li>
<li>fls_app for Intr Mode uses Fls_Cfg_indac.c, Fls_Cfg_Intr_Sample.h</li>
</ol>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_002  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4169, MCAL-4179   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_desc_cfg"></a>
Configurator</h2>
<p>The AUTOSAR Flash Driver Specification details mandatory parameters that shall be configurable via the configurator. Please refer section 10 <a class="el" href="design_fls_top.html#design_fls_references">1</a> Error Checks are common for variants of devices and we can do this in xdm or generator code. </p><table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_025  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4821, MCAL-4820, MCAL-4819, MCAL-4818, MCAL-4824, MCAL-4822, MCAL-4416, MCAL-4415, MCAL-4414, MCAL-4413, MCAL-4412, MCAL-4411, MCAL-4408, MCAL-4406, MCAL-4404, MCAL-4403, MCAL-4398, MCAL-4396, MCAL-4395, MCAL-4394, MCAL-4391, MCAL-4390, MCAL-4388, MCAL-4387, MCAL-4386, MCAL-4384, MCAL-4383, MCAL-4381, MCAL-4380   </td></tr>
</table>
<hr/>
 <h3><a class="anchor" id="design_fls_desc_cfg_ti"></a>
NON Standard configurable parameters</h3>
<p>The design's specific configurable parameters are as follows:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Usage comment   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FlsDacEnable  </td><td class="markdownTableBodyNone">Switch between INDAC and DAC mode.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FlsDtrEnable  </td><td class="markdownTableBodyNone">Switch between DTR and STR mode.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FlsOspiClkSpeed  </td><td class="markdownTableBodyNone">Clock Speed Freq Input (133MHz or 166MHz)   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FlsXipEnable  </td><td class="markdownTableBodyNone">Switch to turn on and off XIP mode.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FlsPhyEnable  </td><td class="markdownTableBodyNone">Switch to turn on and off PHY mode.   </td></tr>
</table>
<p>Please note that: The supported clock speeds are as follows:</p><ol type="1">
<li>133Mhz (133333333U) - This Clock freq works with all modes of the Flash Driver.</li>
<li>166Mhz (166666666U) - This Clock freq is fully supported in INDAC mode of operations. In DAC mode, only read operation is supported.</li>
</ol>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h3><a class="anchor" id="design_fls_desc_cfg_variant"></a>
Variant Support</h3>
<p>The driver shall support both VARIANT-PRE-COMPILE &amp; VARIANT-POST-BUILD.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_desc_error"></a>
Error Classification</h2>
<p>Errors are classified in two categories, development error and Transient Faults.</p>
<p>The reported service IDs identify the services which are described earlier. The following table presents the service IDs and the related services:</p>
<table class="doxtable">
<tr>
<td><em><b> Service ID </b></em> </td><td><em><b> Service</b></em>  </td></tr>
<tr>
<td>0x00  </td><td>FLS_SID_INIT   </td></tr>
<tr>
<td>0x01  </td><td>FLS_SID_ERASE   </td></tr>
<tr>
<td>0x02  </td><td>FLS_SID_WRITE   </td></tr>
<tr>
<td>0x03  </td><td>FLS_SID_CANCEL   </td></tr>
<tr>
<td>0x04  </td><td>FLS_SID_GET_STATUS   </td></tr>
<tr>
<td>0x05  </td><td>FLS_SID_GET_JOB_RESULT   </td></tr>
<tr>
<td>0x06  </td><td>FLS_SID_MAIN_FUNCTION   </td></tr>
<tr>
<td>0x07  </td><td>FLS_SID_READ   </td></tr>
<tr>
<td>0x08  </td><td>FLS_SID_COMPARE   </td></tr>
<tr>
<td>0x09  </td><td>FLS_SID_SET_MODE   </td></tr>
<tr>
<td>0x10  </td><td>FLS_SID_GET_VERSION_INFO   </td></tr>
<tr>
<td>0x0A  </td><td>FLS_SID_BLANK_CHECK   </td></tr>
</table>
<hr/>
<h3><a class="anchor" id="design_fls_desc_error_dev"></a>
Development Errors</h3>
<p>AUTOSAR requires that API functions check the validity of their parameters and module status. The checks in table are internal parameter checks of the API functions. These checks are for development error reporting and can be enabled or disabled.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_006  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4192, MCAL-4198, MCAL-4200, MCAL-4199, MCAL-4197, MCAL-4196, MCAL-4190, MCAL-4191, MCAL-4190   </td></tr>
</table>
<p><b> Development Error Reporting </b></p>
<p>The detection of development errors is configurable (ON / OFF) at pre-compile time. The switch FLS_DEV_ERROR_DETECT will activate or deactivate the detection of all development errors.</p>
<p>By default, development errors are reported to the DET using the service Det_ReportError(), if development error detection and reporting are enabled (i.e. checkboxes Development Mode and Development Error Reporting are checked).</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>API service called with wrong parameter  </td><td>FLS_E_PARAM_CONFIG  </td><td>0x01   </td></tr>
<tr>
<td>API service called with wrong parameter  </td><td>FLS_E_PARAM_ADDRESS  </td><td>0x02   </td></tr>
<tr>
<td>API service called with wrong parameter  </td><td>FLS_E_PARAM_LENGTH  </td><td>0x03   </td></tr>
<tr>
<td>API service called with wrong parameter  </td><td>FLS_E_PARAM_DATA  </td><td>0x04   </td></tr>
<tr>
<td>API service used without module initialization  </td><td>FLS_E_UNINIT  </td><td>0x05   </td></tr>
<tr>
<td>API called when module is busy  </td><td>FLS_E_BUSY  </td><td>0x06   </td></tr>
<tr>
<td>API called with a Null Pointer  </td><td>FLS_E_PARAM_POINTER  </td><td>0x0A   </td></tr>
</table>
<p><b> Transient Faults </b></p>
<p>Transient errors are reported to the DET using the service Det_reportDetTransientFault(). The driver interface (<a class="el" href="Fls_8h.html" title="This file contains interface header for Fls MCAL driver.">Fls.h</a> <a class="el" href="ug_fls_top.html#ug_fls_functional_filestruct_top">File Structure</a>) lists the SID.</p>
<table class="doxtable">
<tr>
<td><em><b> Type of Error </b></em> </td><td><em><b> Related Error code </b></em> </td><td><em><b> Value (Hex)</b></em>  </td></tr>
<tr>
<td>Flash Erase Failed in HW  </td><td>FLS_E_ERASE_FAILED  </td><td>0x01   </td></tr>
<tr>
<td>Flash Write Failed in HW  </td><td>FLS_E_WRITE_FAILED  </td><td>0x02   </td></tr>
<tr>
<td>Flash Read Failed in HW  </td><td>FLS_E_READ_FAILED  </td><td>0x03   </td></tr>
<tr>
<td>Flash Compare Failed in HW  </td><td>FLS_E_COMPARE_FAILED  </td><td>0x04   </td></tr>
<tr>
<td>Expected HW ID not matched  </td><td>FLS_E_UNEXPECTED_FLASH_ID  </td><td>0x05  </td></tr>
</table>
<h3>Debugging support</h3>
<p>Flash driver makes driver status available for debugging. The states MEMIF_UNINIT, MEMIF_IDLE, MEMIF_BUSY can be probed. Driver status variable is defined by the status element in the Fls_DrvObj.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_fls_low_level"></a>
Low Level Definitions</h1>
<hr/>
<p> The detailed API and interface description is available as part of <a class="el" href="design_fls_top.html#design_fls_references">1</a> &amp; <a class="el" href="design_fls_top.html#design_fls_references">4</a>. This section describes the API supported by the MCAL driver and the requirements covered by each of the API.</p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_009  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4415, MCAL-4412, MCAL-4416, MCAL-4414, MCAL-4413, MCAL-4403, MCAL-4404, MCAL-4406, MCAL-4408, MCAL-4411, MCAL-4818, MCAL-4819, MCAL-4821, MCAL-4820, MCAL-4212   </td></tr>
</table>
<h2><a class="anchor" id="design_fls_low_level_dtypes"></a>
MACROS, Data Types &amp; Structures</h2>
<p>The sections below lists some of key data structures that shall be implemented and used in driver implementation.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Macro  </th><th class="markdownTableHeadNone">Comments   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FLS_BASE_ADDRESS  </td><td class="markdownTableBodyNone">Flash Memory start address, defines lower boundary for read/writ/erase/compare jobs.   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">FLS_TOTAL_SIZE  </td><td class="markdownTableBodyNone">Total amount of flash memory in bytes.   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">FLS_DRIVER_INDEX  </td><td class="markdownTableBodyNone">Index of driver, used by FEE - 0 for driver   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<h3>Fls_AddressType and Fls_LengthType</h3>
<p>TypeDefs of address Type used by driver.</p>
<h3><a class="el" href="structFls__ConfigType.html" title="FLS Module Configuration Structure.">Fls_ConfigType</a></h3>
<p>This type of the external data structure contains the initialization data for the Flash Driver, please refer section 8.2.1 of <a class="el" href="design_fls_top.html#design_fls_references">1</a> <a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a> </p><h3><a class="el" href="structFls__SectorType.html" title="FLS Module Flashable Sectors and pages.">Fls_SectorType</a></h3>
<p>This structure contain information about the Flash Device in use. For this driver design, and internal structure is used instead. <a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h2><a class="anchor" id="design_fls_low_level_api"></a>
APIs</h2>
<p>For the standard APIs please refer 8.3 of <a class="el" href="design_fls_top.html#design_fls_references">1</a>. Sections below highlight other design considerations for the implementation.</p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_init"></a>
Fls_Init</h3>
<p>Refer section 8.3.1 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_010  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>Requirements : MCAL-4217, MCAL-4224, MCAL-4222, MCAL-4219, MCAL-4223, MCAL-4220, MCAL-4221, MCAL-4218, MCAL-4191, MCAL-4190, MCAL-4192   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_erase"></a>
Fls_Erase</h3>
<p>Refer section 8.3.2 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_011   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4231, MCAL-4236, MCAL-4226, MCAL-4227, MCAL-4237, MCAL-4232, MCAL-4228, MCAL-4230, MCAL-4229, MCAL-4235. MCAL-4234, MCAL-4190, MCAL-4191, MCAL-4192   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_write"></a>
Fls_Write</h3>
<p>Refer section 8.3.3 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_012   </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4244, MCAL-4239, MCAL-4249, MCAL-4250, MCAL-4243, MCAL-4242, MCAL-4245, MCAL-4251, MCAL-4248, MCAL-4247, MCAL-4190, MCAL-4191, MCAL-4192, MCAL-4241, MCAL_4252   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_getstatus"></a>
Fls_GetStatus</h3>
<p>Refer 8.3.5 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_016  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4262, MCAL-4391, MCAL-4263, MCAL-4264   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_getjobres"></a>
Fls_GetJobResult</h3>
<p>Refer section 8.3.6 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_013  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4269, MCAL-4390, MCAL-4265, MCAL-4268, MCAL-4266, MCAL-4267, MCAL-4191   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_read"></a>
Fls_Read</h3>
<p>Refer section 8.3.7 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_014  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4275, MCAL-4280, MCAL-4270, MCAL-4271, MCAL-4281, MCAL-4272, MCAL-4274, MCAL-4273, MCAL-4283, MCAL-4279, MCAL-4278, MCAL-4282, MCAL-4190, MCAL-4191, MCAL-4192   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_compare"></a>
Fls_Compare</h3>
<p>Refer section 8.3.8 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_015  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4289, MCAL-4286, MCAL-4284, MCAL-4287, MCAL-4285, MCAL-4294, MCAL-4295, MCAL-4290, MCAL-4288, MCAL-4297, MCAL-4293, MCAL-4292, MCAL-4296, MCAL-4190, MCAL-4191, MCAL-4192   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_getverinf"></a>
Fls_GetVersionInfo</h3>
<p>Refer section 8.3.10 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_017  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4302, MCAL-4303, MCAL-4190   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_blankcheck"></a>
Fls_BlankCheck</h3>
<p>Refer section 8.3.11 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_018  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MMCAL-4309, MCAL-4306, MCAL-4384, MCAL-4304, MCAL-4314, MCAL-4315, MCAL-4308, MCAL-4310, MCAL-4307, MCAL-4312, MCAL-4190, MCAL-4191, MCAL-4192   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h3><a class="anchor" id="design_fls_low_level_api_mainfunction"></a>
Fls_MainFunction</h3>
<p>Refer section 8.5.1 of <a class="el" href="design_fls_top.html#design_fls_references">1</a></p>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_019  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4318, MCAL-4342, MCAL-4322, MCAL-4337, MCAL-4321, MCAL-4343, MCAL-4328, MCAL-4191   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h3>Internal, Private Functions that aid FLS module in Job Processing</h3>
<h4><a class="anchor" id="design_fls_low_level_api_priv_processjobs"></a>
processJobs</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_020  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4326, MCAL-4324, MCAL-4323, MCAL-4325, MCAL-4332, MCAL-4333, MCAL-4328, MCAL-4196, MCAL-4197, MCAL-4198, MCAL-4199, MCAL-4349, MCAL-4350, MCAL-4353   </td></tr>
</table>
<h4><a class="anchor" id="design_fls_low_level_api_priv_norRead"></a>
Fls_norRead</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_021  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4277, MCAL-4271   </td></tr>
</table>
<h4><a class="anchor" id="design_fls_low_level_api_priv_norWrite"></a>
Fls_norWrite</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_022  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4240, MCAL-4246   </td></tr>
</table>
<h4><a class="anchor" id="design_fls_low_level_api_priv_norErase"></a>
Fls_norErase</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_023  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4227, MCAL-4232, MCAL-4233   </td></tr>
</table>
<h4><a class="anchor" id="design_fls_low_level_api_priv_norCompare"></a>
Fls_norCompare</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_024  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4291, MCAL-4286   </td></tr>
</table>
<h4><a class="anchor" id="design_fls_low_level_api_priv_norBlankcheck"></a>
Fls_norBlankCheck</h4>
<table class="doxtable">
<tr>
<td><em><b>Design ID</b></em> </td><td>DES_FLS_025  </td></tr>
<tr>
<td><em><b>Requirements Covered</b></em> </td><td>MCAL-4306, MCAL-4305, MCAL-4310, MCAL-4311   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_low_level_globals"></a>
Global Variables</h2>
<p>This design expects that implementation will require to use following global variables.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Variable  </th><th class="markdownTableHeadNone">Type  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Default Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Fls_NorOspiInfo  </td><td class="markdownTableBodyNone">Fls_NOR_InfoType  </td><td class="markdownTableBodyNone">Flash Device Struct  </td><td class="markdownTableBodyNone">-   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Fls_DrvObj  </td><td class="markdownTableBodyNone">Fls_DriverObjType  </td><td class="markdownTableBodyNone">Flash driver object  </td><td class="markdownTableBodyNone">-   </td></tr>
</table>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<h1><a class="anchor" id="design_fls_dar_top"></a>
Decision Analysis &amp; Resolution (DAR)</h1>
<p>Sections below list some of the important design decisions and rational behind those decision.</p>
<h2><a class="anchor" id="design_fls_dar_transfer_mode"></a>
Data Transfer Mode</h2>
<p>The OSPI hardware module provides a couple ways to transfer data: DAC mode and INDAC mode.</p>
<h3><a class="anchor" id="design_fls_dar_criteria_transfer_mode"></a>
DAR Criteria</h3>
<p>CPU must have minimal restrictions while the flash driver is processing. Polling vs Interrupt mode should be allowed in the implementation.</p>
<h3><a class="anchor" id="design_fls_dar_alternatives_transfer_mode"></a>
Available Alternatives</h3>
<ul>
<li><p class="startli"><b> DAC Mode </b></p>
<p class="startli">Direct Access Controller (or DAC) refers to the operation where data interface accesses directly trigger a read or write to Flash memory. It is memory mapped and can be used to both access and directly execute code from external Flash memory. Access that use DAC do not use the embedded SRAM within the OSPI module.</p><ul>
<li><b> Advantages: </b><ul>
<li>Flash memory is memory mapped, so Execute-in-place is supported.</li>
<li>Integration with the PHY Module gives optimized performance.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Needs a data interface access to trigger for any number of bytes transfer.</li>
<li>Only supports poll mode implementation as it does not use SRAM (which is used to trigger interrupts otherwise).</li>
<li>Design implementation is blocking, since in poll mode, control stays within the driver until all the data has been transfered.</li>
</ul>
</li>
</ul>
</li>
<li><p class="startli"><b> INDAC Mode </b></p>
<p class="startli">Indirect Access Controller (INDAC) uses the internal SRAM of the OSPI module. Data transfers then happen between the SRAM and Flash memory or SRAM and system memory, so no memory mapping is needed. The aim of the indirect mode of operation is to transfer significant numbers of bytes to/from Flash memory. Indirect operations are controlled and triggered by software via specific read/write transfer registers.</p><ul>
<li><b> Advantages: </b><ul>
<li>Bulk transfers take place between system and flash memory in the most efficient manner. Fewest possible write cycles carried out inside flash device to maximize life of device.</li>
<li>INDAC supports poll and interrupt based implementation. The embedded SRAM used by INDAC provides interrupt mechanism. Interrupts are triggered when SRAM levels fall below a watermark, and also when a write/read operation finishes from within the SRAM.</li>
<li>Design implementation is non-blocking and allows the control to return to the application (CPU) while the data is still transferring in hardware.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Execute-in-place not supported.</li>
<li>When using interrupt based INDAC mode, the FlsMaxWriteNormalMode has to be set to the page size of the flash device.</li>
<li>PHY module is not integrated.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="design_spi_dar_decision_transfer_mode"></a>
Decision</h3>
<p>In case of a execute-in-place/memory mapped use case, DAC Poll mode should be used. Since DAC mode enables the PHY Module, it gives higher performance results for read operations. For better performance for write operations, INDAC Interrupt mode should be used.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_dar_sectorstruct"></a>
Selecting Flash device information structure</h2>
<p>The Flash device information should be available to the Flash Driver. Information such as Flash device sector size, number of sectors, page size, etc. is needed.</p>
<h3><a class="anchor" id="design_fls_dar_criteria_sectorstruct"></a>
DAR Criteria</h3>
<p>Avoid user input errors.</p>
<h3><a class="anchor" id="design_fls_dar_alternatives_sectorstruct"></a>
Available Alternatives</h3>
<ul>
<li><p class="startli"><b> Use device specific, local structure </b></p>
<p class="startli">Only one Flash device is connected to the J7EVM, and this driver implementation only supported one device.</p><ul>
<li><b> Advantages: </b><ul>
<li>Simpler design.</li>
<li>The values of flash device are constant and are stored in local, internal structure. This information should not be changed by user.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Does not follow Autosar Spec.</li>
</ul>
</li>
</ul>
</li>
<li><p class="startli"><b> Use spec specific structure </b></p>
<p class="startli">Autosar Spec provide a specific structure that would come as input from user as a configuration parameter.</p><ul>
<li><b> Advantages: </b><ul>
<li>This would follow the Autosar Spec requirement.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Increased chance of user input error, and complexity, as only one Flash device is connected and supported for J7EVM.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="design_fls_dar_decision_sectorstructure"></a>
Decision</h3>
<p>Option 1 is selected. The configuration parameter for FlsSector is not editable by the user, to avoid any error. Option 2 is useful when there are various flash devices connect, with varied size details. Since this Flash device contains sectors with all same sizes, Option 1 makes a simpler and more efficient design.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h2><a class="anchor" id="design_fls_dar_spidriver"></a>
Selecting the SPI Driver</h2>
<p>The Flash driver module needs to use SPI protocol to perform the data transfers between system and Flash device. Specifically, this Flash driver requires OSPI interface and driver.</p>
<h3><a class="anchor" id="design_fls_dar_criteria_spidriver"></a>
DAR Criteria</h3>
<p>SPI driver should have least impact on the latency and performance of the Flash driver.</p>
<h3><a class="anchor" id="design_fls_dar_alternatives_spidriver"></a>
Available Alternatives</h3>
<ul>
<li><p class="startli"><b> Use PDK SPI Driver </b></p>
<p class="startli">TI's PDK package provides several different SPI drivers: OSPI, QSPI, NAND, or NOR. This driver could directly be used by MCAL Flash Driver.</p><ul>
<li><b> Advantages: </b><ul>
<li>Simpler design. PDK SPI driver APIs could be called by Flash driver for data transfers.</li>
<li>Reduced Flash Driver Size.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>The calls to PDK SPI driver would add latency and decrease overall performance of Flash Driver, since the driver is not completely integrated.</li>
<li>Adds dependency on separate TI provided package.</li>
<li>The PDK SPI driver design is not suitable for Autosar Spec Flash Driver.</li>
</ul>
</li>
</ul>
</li>
<li><p class="startli"><b> Use MCAL SPI Driver </b></p>
<p class="startli">Autosar Spec specific MCAL SPI Driver is already present in MCUSW package.</p><ul>
<li><b> Advantages: </b><ul>
<li>This would follow the Autosar Spec requirements.</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>OSPI driver has not been implemented, so would require additional steps to integrate into Flash Driver.</li>
<li>The calls to MCAL SPI driver would add latency and decrease overall performance of Flash Driver, since the driver is not completely integrated.</li>
</ul>
</li>
</ul>
</li>
<li><p class="startli"><b> Merge OSPI Driver </b></p>
<p class="startli">The required OSPI driver API and functions can be implemented inside the Flash driver itself. Therefore, the OSPI driver would be part of the Flash Driver module.</p><ul>
<li><b> Advantages: </b><ul>
<li>Reduced latency as the OSPI API are within the Flash Driver module.</li>
<li>Narrows dependency on other modules and packages (with the exception of CSL APIs).</li>
</ul>
</li>
<li><b> Disadvantages: </b><ul>
<li>Flash Driver code size increased.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="design_fls_dar_decision_spidriver"></a>
Decision</h3>
<p>Option 3 is selected as it reduces the latency and would give better performance. Also, this option decreases the dependency on other modules and packages.</p>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
 <h1><a class="anchor" id="design_fls_test_top"></a>
Test Criteria</h1>
<p>The sections below identify some of the aspects of design that would require emphasis during testing of this design implementation</p>
<ul>
<li><b> Validating ECUC parameters </b><ul>
<li>Validating ECUC Parameter: Configuration for each test case shall be generated by EB Tresos command line.</li>
</ul>
</li>
<li><b> Performance Testing </b><ul>
<li>While testing the Write, Read, Erase, BlankCheck and Compare APIs, care should be taken to check the return value to see if job is finished before sending the next job. This can be checked using the Fee_Cbk callback functions: Fls_JobEndNotification and Fls_JobErrorNotification.</li>
</ul>
</li>
<li><b> Test Verification </b><ul>
<li>To verify that the flash memory is correctly programmed, BlankCheck API should be used after performing Erase operation and Compare API should be used after a Write operation to ensure data integrity.</li>
</ul>
</li>
</ul>
<p><a class="el" href="design_fls_top.html#design_fls_intro">Back To Top</a></p>
<hr/>
<h1><a class="anchor" id="design_fls_rev_hist"></a>
Document Revision History</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Revision  </th><th class="markdownTableHeadNone">Date  </th><th class="markdownTableHeadNone">Author  </th><th class="markdownTableHeadNone">Description  </th><th class="markdownTableHeadNone">Status   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">26 May 2020  </td><td class="markdownTableBodyNone">Nikki Shah  </td><td class="markdownTableBodyNone">First version  </td><td class="markdownTableBodyNone">Pending   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0.1  </td><td class="markdownTableBodyNone">01 June 2020  </td><td class="markdownTableBodyNone">Nikki Shah  </td><td class="markdownTableBodyNone">Addressed Review Comments  </td><td class="markdownTableBodyNone">Approved   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0.2  </td><td class="markdownTableBodyNone">02 Nov 2020  </td><td class="markdownTableBodyNone">Nikki Shah  </td><td class="markdownTableBodyNone">MCUSW 01_03_00 Release Updates  </td><td class="markdownTableBodyNone">Pending   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="design_top.html">MCAL Module Design</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.15 </li>
  </ul>
</div>
</body>
</html>
