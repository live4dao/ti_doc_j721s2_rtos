<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>TI Deep Learning Product User Guide: Build Instruction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TI Deep Learning Product User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_tidl_build_instruction.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Build Instruction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#tidl_build_Intro">Build instructions for TIDL-RT</a><ul><li class="level2"><a href="#tidl_build_Dependencies">Validation Information</a></li>
<li class="level2"><a href="#tidl_build_deps">Build Dependencies</a><ul><li class="level3"><a href="#tidl_build_pdk">Building PDK</a></li>
<li class="level3"><a href="#tidl_build_opencv">Build OpenCV from source</a></li>
<li class="level3"><a href="#tidl_build_ProtoBuf">Build ProtoBuf from source</a></li>
<li class="level3"><a href="#tidl_build_flatBuffer">FlatBuffer</a></li>
<li class="level3"><a href="#osrt_build_tflrt">Tensorflow repository</a></li>
<li class="level3"><a href="#osrt_build_onnxrt">ONNX repository</a></li>
<li class="level3"><a href="#osrt_build_tvm">TVM repository</a></li>
<li class="level3"><a href="#tidl_build_windows">Windows Build for PDK</a></li>
<li class="level3"><a href="#tidl_build_ki">Known Issue</a></li>
</ul>
</li>
<li class="level2"><a href="#tidl_build_Environment">Environment Variables</a></li>
<li class="level2"><a href="#tidl_build_Commands">Build Commands to run TIDL-RT</a></li>
<li class="level2"><a href="#osrt_build_Commands">Additional Build commands for Open Source Runtimes</a><ul><li class="level3"><a href="#osrt_it_build">Import tool build</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="tidl_build_Intro"></a>
Build instructions for TIDL-RT</h1>
<p>By default, TIDL release includes all required pre-built libraries &amp; executables. If there is no code change, you don't need to rebuild it. If code is changed or you want to debug step by step, you can rebuild it by following instructions given in this user guide</p>
<ul>
<li>PC (Linux, x86_64)<ul>
<li>TIDL-RT Importer<ul>
<li>C++ code is located in ti_dl/utils/tidlModelImport)</li>
</ul>
</li>
<li>TIDL-RT Host Emulation - Sample application (test bench)<ul>
<li>C code for testbench is present in ti_dl/test/src/. TIDL-RT host emulation library is present in ti_dl/lib/PC/</li>
<li>This mode should produce the same result as TIDL-RT inference on development board.</li>
</ul>
</li>
</ul>
</li>
<li>TI_DEVICE<ul>
<li>TIDL-RT Inference - Sample application (test bench)<ul>
<li>This application ARM binary can be found inside ti_dl/rt/out/J7/A72/LINUX/&lt; TARGET_BUILD &gt;/TI_DEVICE_armv8_test_dl_algo_host_rt.out. Corresponding C7x firmware can be found inside &lt; PSDK_INSTALL_PATH &gt;/vision_apps/out/&lt; SOC &gt;/C7xx/FREERTOS/&lt; TARGET_BUILD &gt;/vx_app_rtos_linux_c7x_1.out</li>
<li>Source code for the testbench is present in ti_dl/test/src/</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="tidl_build_Dependencies"></a>
Validation Information</h2>
<p>Please refer <b>Validation Information</b> section in the TIDeepLearningProduct_ReleaseNotes.html.</p>
<h2><a class="anchor" id="tidl_build_deps"></a>
Build Dependencies</h2>
<p>Before proceeding, please download all the <a class="el" href="md_tidl_dependency_info.html">dependent software components</a></p>
<h3><a class="anchor" id="tidl_build_pdk"></a>
Building PDK</h3>
<p>Please note that PDK is a dependency for TIDL and it is available in SDK package. It is expected that user has already built PDK before building TIDL or using pre-built libraries. User should refer to SDK documentation for any issues with PDK build.</p>
<h3><a class="anchor" id="tidl_build_opencv"></a>
Build OpenCV from source</h3>
<p>Description here assumes Open CV 4.1.0, but user must make appropriate changes as per the mentioned version in <a class="el" href="md_tidl_dependency_info.html">dependent software components</a></p>
<p>run "unzip opencv-4.1.0.zip" Install cmake if it not available in the system"sudo apt install cmake"</p>
<p>Use below CMake options to in "opencv-4.1.0/cmake" folder. And run "make" from same folder</p>
<div class="fragment"><div class="line">cmake -DBUILD_opencv_highgui:BOOL=&quot;1&quot; -DBUILD_opencv_videoio:BOOL=&quot;0&quot; -DWITH_IPP:BOOL=&quot;0&quot; -DWITH_WEBP:BOOL=&quot;1&quot; -DWITH_OPENEXR:BOOL=&quot;1&quot; -DWITH_IPP_A:BOOL=&quot;0&quot; -DBUILD_WITH_DYNAMIC_IPP:BOOL=&quot;0&quot; -DBUILD_opencv_cudacodec:BOOL=&quot;0&quot; -DBUILD_PNG:BOOL=&quot;1&quot; -DBUILD_opencv_cudaobjdetect:BOOL=&quot;0&quot; -DBUILD_ZLIB:BOOL=&quot;1&quot; -DBUILD_TESTS:BOOL=&quot;0&quot; -DWITH_CUDA:BOOL=&quot;0&quot; -DBUILD_opencv_cudafeatures2d:BOOL=&quot;0&quot; -DBUILD_opencv_cudaoptflow:BOOL=&quot;0&quot; -DBUILD_opencv_cudawarping:BOOL=&quot;0&quot; -DINSTALL_TESTS:BOOL=&quot;0&quot; -DBUILD_TIFF:BOOL=&quot;1&quot; -DBUILD_JPEG:BOOL=&quot;1&quot; -DBUILD_opencv_cudaarithm:BOOL=&quot;0&quot; -DBUILD_PERF_TESTS:BOOL=&quot;0&quot; -DBUILD_opencv_cudalegacy:BOOL=&quot;0&quot; -DBUILD_opencv_cudaimgproc:BOOL=&quot;0&quot; -DBUILD_opencv_cudastereo:BOOL=&quot;0&quot; -DBUILD_opencv_cudafilters:BOOL=&quot;0&quot; -DBUILD_opencv_cudabgsegm:BOOL=&quot;0&quot; -DBUILD_SHARED_LIBS:BOOL=&quot;0&quot; -DWITH_ITT=OFF ../</div></div><!-- fragment --><h3><a class="anchor" id="tidl_build_ProtoBuf"></a>
Build ProtoBuf from source</h3>
<p>Description here assumes protobuf 3.11.3, but user must make appropriate changes as per the mentioned version in <a class="el" href="md_tidl_dependency_info.html">dependent software components</a>.</p>
<p>Extract the source "tar -xzvf protobuf-3.11.3.tar.gz"</p>
<p>Run below Configure command in "protobuf-3.11.3" folder and rum "make" from the same folder</p>
<div class="fragment"><div class="line">./configure CXXFLAGS=-fPIC --enable-shared=no LDFLAGS=&quot;-static&quot;</div></div><!-- fragment --><h3><a class="anchor" id="tidl_build_flatBuffer"></a>
FlatBuffer</h3>
<p>Description here assumes protobuf 1.12.0, but user must make appropriate changes as per the mentioned version in <a class="el" href="md_tidl_dependency_info.html">dependent software components</a>.</p>
<p>Run the following steps to build flatbuffers: </p><pre class="fragment">unzip v1.12.0.zip
cd flatbuffers-1.12.0
cmake -G "Unix Makefiles" -DCMAKE_POSITION_INDEPENDENT_CODE=ON 
make
</pre><h3><a class="anchor" id="osrt_build_tflrt"></a>
Tensorflow repository</h3>
<p>This dependency is needed for Tensorflow-lite runtime specific builds. </p><pre class="fragment">cd ${PSDKRA_PATH}
git clone --depth 1 --single-branch -b tidl-j7 https://github.com/TexasInstruments/tensorflow.git
</pre><h3><a class="anchor" id="osrt_build_onnxrt"></a>
ONNX repository</h3>
<p>This dependency is needed for ONNX runtime specific builds. </p><pre class="fragment">cd ${PSDKRA_PATH}
git clone --depth 1 --single-branch -b tidl-j7 https://github.com/TexasInstruments/onnxruntime.git
</pre><h3><a class="anchor" id="osrt_build_tvm"></a>
TVM repository</h3>
<p>This dependency is needed for TVM/Neo-AI-DLR specific builds. </p><pre class="fragment">cd ${PSDKRA_PATH}
git clone --single-branch -b tidl-j7 https://github.com/TexasInstruments/tvm
cd tvm
git submodule init
git submodule update --init --recursive
</pre><blockquote class="doxtable">
<p><b>Note</b><br />
Note : If you are building the OpenCV and ProtoBuf in Windows machine. Enable the corresponding flag from CMake wizard.. <br />
gmake can be used from CCS for windows building </p>
</blockquote>
<h3><a class="anchor" id="tidl_build_windows"></a>
Windows Build for PDK</h3>
<ul>
<li>TIDL depends on certain libraries from PDK and windows libraries for those are not available as part of default SDK package.</li>
<li>The same needs to be built by the user and following are the steps for the same :<ul>
<li>Download and install build tools from : <a href="https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019">https://visualstudio.microsoft.com/downloads/#build-tools-for-visual-studio-2019</a></li>
<li>Run below command from windows command prompt to set MSVC build environment</li>
</ul>
</li>
</ul>
<div class="fragment"><div class="line">&quot;C:\Program Files (x86)\Microsoft Visual Studio\2019\BuildTools\VC\Auxiliary\Build\vcvarsall.bat&quot; x86_amd64 -vcvars_ver=14.2</div></div><!-- fragment --><ul>
<li>This section is described for J721E development board and it may differ for other development board</li>
<li>PDK build needs XDC tools and this tool is different for windows and linux, so make sure you use the windows version of XDC tools and update the same in pdk_jacinto_xx_xx_xx_xx/packages/ti/build/pdk_tools_path.mk. Change the XDC_INSTALL_PATH in this file.<ul>
<li>gmake available in "ccs9xx\ccs\utils\bin" can be used for build. Add this path to PATH%</li>
<li>Run the below command from "pdk\packages\ti\build" to build PDK Host emulation libraries <div class="fragment"><div class="line">gmake osal_nonos ipc osal_tirtos csl sciclient udma dmautils BOARD=j721e_hostemu CORE=c7x-hostemu -s -j16 BUILD_PROFILE=release</div><div class="line">gmake osal_nonos ipc osal_tirtos csl sciclient udma dmautils BOARD=j721e_hostemu CORE=c7x-hostemu -s -j16 BUILD_PROFILE=debug</div></div><!-- fragment --> </li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="tidl_build_ki"></a>
Known Issue</h3>
<p>In some of the old machines, user many observe "Illegal Instruction" error while importing model or performing inference on PC. This is observed because of new x86_64 instruction used in the pre-built binaries. To overcome this, user would need to re-built the TIDL-RT host emulation executable by executing below command </p><div class="fragment"><div class="line">$ cd ${TIDL_INSTALL_PATH}</div><div class="line">$ make tidl TARGET_PLATFORM=PC</div></div><!-- fragment --><h2><a class="anchor" id="tidl_build_Environment"></a>
Environment Variables</h2>
<p>Build system of TIDL-RT software assumes below environment variables being available in the system. Set below environment variables or modify “makerules/config.mk”. Most of these components except described in <a class="el" href="md_tidl_dependency_info.html">dependent software components</a> are part of SDK.</p>
<table class="doxtable">
<tr>
<th>Environment Variable </th><th>Description  </th></tr>
<tr>
<td>IVISION_PATH </td><td>Directory pointing to ivision package in SDK </td></tr>
<tr>
<td>DSP_TOOLS </td><td>Directory pointing to C7x CG tool </td></tr>
<tr>
<td>MMALIB_PATH </td><td>Directory pointing to MMA LIB Package (Only needed for TI_DEVICE Build) </td></tr>
<tr>
<td>PDK_INSTALL_PATH </td><td>Directory pointing to PDK Package, Default Path refers to pdk in PSDK_INSTALL_PATH, create a symbolic link to pdk_xx_xx_xx_xx with pdk </td></tr>
<tr>
<td>TIDL_PROTOBUF_PATH </td><td>Directory pointing to Protobuf package (for Import tool only) </td></tr>
<tr>
<td>TIDL_FLATBUF_PATH </td><td>Directory pointing to Flatbuffers package (for Import tool only) </td></tr>
<tr>
<td>TIDL_OPENCV_PATH </td><td>Directory pointing to openCV package (for Test bench Only) </td></tr>
<tr>
<td>UTILS_PATH </td><td>Directory pointing to utils command like mkdir, rm (can be found inside CCS installation CCS_INSTALLATION_DIR/ccs/utils/cygwin. Required only for Windows builds </td></tr>
</table>
<h2><a class="anchor" id="tidl_build_Commands"></a>
Build Commands to run TIDL-RT</h2>
<p>Please note that user should use "make" utility for building on Linux whereas "gmake" should be used for Windows. Also executable for Linux have type .out whereas the one for Windows have added .exe in executable name. For simplicity make and .out is used in below section.</p>
<p>Run “make TARGET_PLATFORM=PC” from <code>${TIDL_INSTALL_PATH}</code> folder to build PC tools</p>
<div class="fragment"><div class="line">$ cd ${TIDL_INSTALL_PATH}</div><div class="line">$ make TARGET_PLATFORM=PC</div></div><!-- fragment --><ul>
<li>This step will generate all the binaries for PC<ul>
<li>tidl_model_import.out in "ti_dl/utils/tidlModelImport/out"</li>
<li>PC_dsp_test_dl_algo.out in "ti_dl/test"</li>
<li>ti_cnnperfsim.out in "ti_dl/utils/perfsim"</li>
</ul>
</li>
<li>If you are using a Linux PC, you can run "make" as <code>make gv all TARGET_PLATFORM=PC</code>. This will also generate the graph visulization tool<ul>
<li>tidl_graphVisualiser.out in "ti_dl/utils/tidlModelGraphviz/out/"</li>
</ul>
</li>
</ul>
<p>Run “make” from <code>${TIDL_INSTALL_PATH}</code> folder to build the test bench for target</p>
<div class="fragment"><div class="line">$ cd ${TIDL_INSTALL_PATH}</div><div class="line">$ make</div></div><!-- fragment --><ul>
<li>This Step will generate binary (./TI_DEVICE_dsp_test_dl_algo.out) in "ti_dl/test"</li>
</ul>
<p>Use "TARGET_BUILD=debug" to build debug binaries</p>
<h2><a class="anchor" id="osrt_build_Commands"></a>
Additional Build commands for Open Source Runtimes</h2>
<p>Pre-requisite : Above TIDL-RT build commands must be executed before running these commands. Note : These builds are supported only on LINUX platform, not supported for Windows.</p>
<h3><a class="anchor" id="osrt_it_build"></a>
Import tool build</h3>
<p>Following commands can be used to build import tool for open source runtimes.</p>
<p>Tensorflow-lite runtime: </p><div class="fragment"><div class="line">make it TIDL_BUILD_TFLITE_IMPORT_LIB=1</div></div><!-- fragment --><p>ONNX runtime: </p><div class="fragment"><div class="line">make it TIDL_BUILD_ONNX_IMPORT_LIB=1</div></div><!-- fragment --><p> TVM/Neo-AI-DLR: </p><div class="fragment"><div class="line">make it TIDL_BUILD_RELAY_IMPORT_LIB=1</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
