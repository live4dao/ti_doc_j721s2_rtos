<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>TI Deep Learning Product User Guide: TIDL-RT: Performance issues</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TI Deep Learning Product User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_tidl_fsg_steps_to_debug_performance.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TIDL-RT: Performance issues </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#did_tidl_Analyse_perf_intro">Steps to Analyze Performance</a><ul><li class="level2"><a href="#did_tidl_tips_improve_perf">Troubleshooting steps for performance issues</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="did_tidl_Analyse_perf_intro"></a>
Steps to Analyze Performance</h1>
<ul>
<li>User can set enableLayerPerfTraces = 1 in TIDL-RT inference configuration file to enable layer level performance.</li>
<li>Note that in order to get the performance traces, user should provide a valid callback function as part of <a class="el" href="structTIDL__CreateParams.html#ac8499d88f419b4c90ef5aa444d560613">TIDL_CreateParams.TIDLVprintf</a> and set debugTraceLevel = 1.</li>
<li>With this option, TIDL-RT prints the execution cycles for each layer on console out as shown in below figure:</li>
</ul>
<div class="fragment"><div class="line">Network Cycles 6294273</div><div class="line"></div><div class="line">Layer,   Layer Cycles,kernelOnlyCycles, coreLoopCycles,LayerSetupCycles,dmaPipeupCycles, dmaPipeDownCycles, PrefetchCycles,copyKerCoeffCycles</div><div class="line">  1,          81811,          48850,          49277,           7779,          14969,                18,           1007,                16,</div><div class="line">  2,          71051,          52722,          53246,           1473,           3290,                16,              0,                 0,</div><div class="line">  3,          34063,          16700,          17307,           7379,           3952,                18,             17,                16,</div><div class="line">  4,          60926,          45133,          45431,           6625,           4176,                18,            777,                 9,</div><div class="line">  5,          29990,           5996,           6040,            871,           3432,                 9,              0,                 0,</div><div class="line">  6,          30806,          14975,          15275,           6575,           4114,                61,             10,                 9,</div><div class="line">  7,          20355,           5508,           5810,           6360,           3480,                11,             10,                 9,</div><div class="line">  8,          34670,          20921,          21031,           6222,           2291,                18,            727,                 9,</div></div><!-- fragment --><ul>
<li>In the above figure "Network cycles" tells the total cycles consumed to execute a given network on C7x-MMA. This can be translated to time in ms by division of 10^6 (with C7x-MMA@1GHz)</li>
<li>The logs in above figure gives detailed information about various profile points but from end user point of view, data under column "Layer Cycles" shall be used to get layer cycles consumed by a particular layer. Rest all the columns are meant to be used by TI's internal team to debug performance issue.</li>
<li>These traces are printed in the same order as various layers gets executed on EVM and user can identify the layer by layerIdx identifier as defined in <a href="md_tidl_fsg_model_visualization.html#did_tidl_model_viz_example">model visualization output</a>.</li>
<li><b>Per layer execution traces are only applicable for target/EVM execution and are not applicable for host emulation mode of the inference execution</b></li>
</ul>
<h2><a class="anchor" id="did_tidl_tips_improve_perf"></a>
Troubleshooting steps for performance issues</h2>
<ul>
<li>Please make sure that the available MSMC SRAM on device is rightly provided to TIDL-RT, the same can be provided by TIDL-RT import configuration parameter "msmcSizeKB". Giving smaller MSMC SRAM may result in performance degradation if it results into more layers going into DDR hence user should carefully provide the best available MSMC size to TIDL-RT.</li>
<li>Try changing the value of parameter ENABLE_PERSIT_WT_ALLOC between 1 (default) and 0 in device_config file which in-turn is provided as "perfSimConfig" parameter in TIDL-RT import config file. By default device_config file is used from ti_dl/test/testvecs/config/import/device_config.cfg.</li>
<li>Please make sure that TIDL_deactivate function is called appropriately, user should call TIDL_deactivate function whenever they switch from one network to the other.</li>
<li>If users application can allow processing of multiple inputs together in a batch form, then set numBatches = val in TIDL-RT import config file. This option can give considerable performance improvements especially for small resolution network. User can try different values of batch size, and identify an optimal batch size( batch size of 4 has been identified as good size for 224x224 image sizes). For details about this option please refer <a href="md_tidl_fsg_batch_processing.html">here</a>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
