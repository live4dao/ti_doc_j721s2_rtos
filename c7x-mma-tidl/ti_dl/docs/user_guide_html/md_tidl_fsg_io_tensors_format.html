<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>TI Deep Learning Product User Guide: TIDL-RT: Input and Output Tensors Format</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ti_logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TI Deep Learning Product User Guide
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_tidl_fsg_io_tensors_format.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">TIDL-RT: Input and Output Tensors Format </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#did_tidl_io_format_intro">Introduction</a></li>
<li class="level1"><a href="#did_tidl_io_format_Types">Input and Output Tensor Formats for TIDL-RT inference</a><ul><li class="level2"><a href="#did_tidl_i_elementTypes">Supported data types for the input tensor</a></li>
<li class="level2"><a href="#did_tidl_o_elementTypes">Supported data types for the output tensor</a></li>
<li class="level2"><a href="#did_tidl_o_extra_points">Points to be noted</a></li>
</ul>
</li>
<li class="level1"><a href="#did_tidl_io_fles">IO File Formats of TIDL-RT Test Application and Import tool</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="did_tidl_io_format_intro"></a>
Introduction</h1>
<p>This section describes the following:</p>
<ul>
<li>Input and output tensor formats for TIDL-RT inference</li>
<li>Input and output file formats of TIDL-RT inference test application and import tool</li>
</ul>
<h1><a class="anchor" id="did_tidl_io_format_Types"></a>
Input and Output Tensor Formats for TIDL-RT inference</h1>
<ul>
<li>The input and output tensor format of a network to perform inference are described by the <a href="structsTIDL__IOBufDesc__t.html">sTIDL_IOBufDesc_t</a>.</li>
<li>Information for the structure mentioned in above statement is generated in a file by TIDL-RT import tool. The name of file can be provided by user in TIDL-RT import configuration file by setting parameter "outputParamsFile".</li>
<li>This information is expected to be used for the following purposes:<ul>
<li>To allocate the input and output buffers supplied to TIDL-RT library from higher level application.</li>
<li>To identify the order in which user is expected to provide the input to TIDL-RT inference engine in cases where network has more than one input. <a class="el" href="structsTIDL__IOBufDesc__t.html#a87606f83734a1bb8c8576d0856305077">sTIDL_IOBufDesc_t.inDataName</a> parameter contains the tensor names as in the original network which shall be used to provide the input in right order.</li>
<li>To read/de-quantize the final output of the network. A sample code is given as an example to understand how the final output can be read/de-quantize. In this sample code the data layout is assumed to be in NCHW format. <div class="fragment"><div class="line">/* Lets assume the outPtr is the output pointer for one of the output buffer whose index is outIdx for a given network. </div><div class="line">OutElemTemplateType is the type of the output and it can be read from sTIDL_IOBufDesc_t.outElementType, e.g. uint8_t, int16_t etc.</div><div class="line">All parameter are for a given output and can be accessed by sTIDL_IOBufDesc_t.&lt;parameter&gt;[outIdx]</div><div class="line">Following example is for the output but same format is also applicable for input</div><div class="line">*/</div><div class="line"></div><div class="line">OutElemTemplateType outPtrStart = &amp;outPtr[outPadT[outIdx] + outPadL[outIdx]];</div><div class="line">int32_t outLinePitch = outWidth[outIdx] + outPadL[outIdx] + outPadR[outIdx];</div><div class="line">int32_t outBatchPitch = outChannelPitch[outIdx] * outNumChannels[outIdx];</div><div class="line">float32_tidl outputVal;</div><div class="line"></div><div class="line">for ( batchIdx = 0; batchIdx &lt; outNumBatches[outIdx];batchIdx++)</div><div class="line">{</div><div class="line">    for ( channelIdx = 0; channelIdx &lt; outNumChannels[outIdx];channelIdx++)</div><div class="line">    {</div><div class="line">        for ( heightIdx = 0; heightIdx &lt; outHeight[outIdx];heightIdx++)</div><div class="line">        {</div><div class="line">            for ( widthIdx = 0; widthIdx &lt; outWidth[outIdx];widthIdx++)</div><div class="line">            {</div><div class="line">                int32_t outIdx = widthIdx + </div><div class="line">                                (heightIdx * outLinePitch) + </div><div class="line">                                (channelIdx * outChannelPitch[outIdx]) +</div><div class="line">                                (batchIdx * outBatchPitch);</div><div class="line">                /* Note that this is the final de-quantized output */</div><div class="line">                outputVal = outPtrStart[outIdx] / outTensorScale[outIdx];</div><div class="line">                printf(&quot;Output Element %f \n&quot;, outputVal);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --></li>
</ul>
</li>
<li>Below image describes properties of one channel in a tensor (This format is applicable for both input and output tensor of the network).</li>
</ul>
<div class="image">
<img src="IO_Tensor_channel_1.PNG" alt="IO_Tensor_channel_1.PNG"/>
<div class="caption">
TIDL Input Tensor - One 2D Channel</div></div>
<ul>
<li>If the input/output has more than one channel then these channels are stacked continuously in the memory.</li>
</ul>
<div class="image">
<img src="IO_Tensor_channel_2.PNG" alt="IO_Tensor_channel_2.PNG"/>
<div class="caption">
TIDL Input Tensor - 3 Channels</div></div>
<ul>
<li>The Padded region in the input buffer has to be filled with zero by application. This can be done once by application during buffer allocation during system boot time.</li>
</ul>
<h2><a class="anchor" id="did_tidl_i_elementTypes"></a>
Supported data types for the input tensor</h2>
<ul>
<li>TIDL_UnsignedChar</li>
<li>TIDL_SignedChar</li>
<li>TIDL_UnsignedShort</li>
<li>TIDL_SignedShort</li>
<li>TIDL_SinglePrecFloat (Only when data convert layer is added on input side and the same can be done using TIDL-RT import config parameter "addDataConvertToNet")</li>
</ul>
<h2><a class="anchor" id="did_tidl_o_elementTypes"></a>
Supported data types for the output tensor</h2>
<ul>
<li>TIDL_UnsignedChar</li>
<li>TIDL_SignedChar</li>
<li>TIDL_UnsignedShort</li>
<li>TIDL_SignedShort</li>
<li>TIDL_SinglePrecFloat (Only for Softmax and SSD Post Processing Layer)</li>
</ul>
<h2><a class="anchor" id="did_tidl_o_extra_points"></a>
Points to be noted</h2>
<ul>
<li>All the Input and output tensor follow the above described buffer format, including the SSD post processing layer. Additionally <a class="el" href="structTIDL__ODLayerHeaderInfo.html" title="This structure contains the header information of Objection detection layer. ">TIDL_ODLayerHeaderInfo</a> and <a class="el" href="structTIDL__ODLayerObjInfo.html" title="This structure contains the each object&#39;s information detected by Objection detection layer...">TIDL_ODLayerObjInfo</a> can be used to access the detected objects.</li>
<li>Refer the gParams.postProcType == 2 in ti_dl/test/src/tidl_image_postproc.c for more information OD-SSD output</li>
</ul>
<h1><a class="anchor" id="did_tidl_io_fles"></a>
IO File Formats of TIDL-RT Test Application and Import tool</h1>
<ul>
<li>TIDL-RT test application accepts input to be fed in a certain way and it is controlled by "inFileFormat" parameter as described <a href="md_tidl_sample_test.html#tidl_inference_2">here</a></li>
<li>TIDL-RT inference and import uses the same test application.</li>
<li>JPEG and PNG files are supported when running the import tool for host emulation mode. <b>For target (EVM) execution, only BMP file or raw inFileFormat is supported as input</b>.</li>
<li>Output is always stored in RAW format to file along with any post processing output as requested by the user. User can refer the <a class="el" href="md_tidl_fsg_output_post_processing.html">TIDL: Output Post Processing in Test Application</a> page to understand the various post processing options available.</li>
<li>In case of multiple input images, set inFileFormat = 2 in the import config file. Provide "inData" as a txt file which specifies the input file names separated by space e.g. "testvecs/inputs/input1.bmp testvecs/inputs/input2.bmp". The order of the inputs can be specified by providing the input tensor names using the "inDataNamesList" option in import config file as described <a class="el" href="md_tidl_model_import.html">here</a>.</li>
<li>If the input is not an image, then array of size "numBatches x numChannels x inHeight x inWidth x elementSize" can be provided as a raw binary file to the TIDL-RT test application and import tool. In this case user should set TIDL-RT import/infer config parameter as inFileFormat = 1.<ul>
<li>If more than one input tensor is used by network, then all the input array are sequentially read from the same input binary file.</li>
<li>Order in which the multiple tensors are sequentially provided in the input binary file can be specified using the "inDataNamesList" option in import config file as described <a class="el" href="md_tidl_model_import.html">here</a>.</li>
<li>If TIDL-RT inference or import is executed for more than one frame for a given network then all the input tensors can be appended to the same input raw binary file </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
